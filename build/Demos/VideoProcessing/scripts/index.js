!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="www/scripts/",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var i=function(){function e(){}return e.ALPHA_DISABLE=0,e.ALPHA_ADD=1,e.ALPHA_COMBINE=2,e.ALPHA_SUBTRACT=3,e.ALPHA_MULTIPLY=4,e.ALPHA_MAXIMIZED=5,e.ALPHA_ONEONE=6,e.ALPHA_PREMULTIPLIED=7,e.ALPHA_PREMULTIPLIED_PORTERDUFF=8,e.ALPHA_INTERPOLATE=9,e.ALPHA_SCREENMODE=10,e.ALPHA_ONEONE_ONEONE=11,e.ALPHA_ALPHATOCOLOR=12,e.ALPHA_REVERSEONEMINUS=13,e.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,e.ALPHA_ONEONE_ONEZERO=15,e.ALPHA_EQUATION_ADD=0,e.ALPHA_EQUATION_SUBSTRACT=1,e.ALPHA_EQUATION_REVERSE_SUBTRACT=2,e.ALPHA_EQUATION_MAX=3,e.ALPHA_EQUATION_MIN=4,e.ALPHA_EQUATION_DARKEN=5,e.DELAYLOADSTATE_NONE=0,e.DELAYLOADSTATE_LOADED=1,e.DELAYLOADSTATE_LOADING=2,e.DELAYLOADSTATE_NOTLOADED=4,e.NEVER=512,e.ALWAYS=519,e.LESS=513,e.EQUAL=514,e.LEQUAL=515,e.GREATER=516,e.GEQUAL=518,e.NOTEQUAL=517,e.KEEP=7680,e.REPLACE=7681,e.INCR=7682,e.DECR=7683,e.INVERT=5386,e.INCR_WRAP=34055,e.DECR_WRAP=34056,e.TEXTURE_CLAMP_ADDRESSMODE=0,e.TEXTURE_WRAP_ADDRESSMODE=1,e.TEXTURE_MIRROR_ADDRESSMODE=2,e.TEXTUREFORMAT_ALPHA=0,e.TEXTUREFORMAT_LUMINANCE=1,e.TEXTUREFORMAT_LUMINANCE_ALPHA=2,e.TEXTUREFORMAT_RGB=4,e.TEXTUREFORMAT_RGBA=5,e.TEXTUREFORMAT_RED=6,e.TEXTUREFORMAT_R=6,e.TEXTUREFORMAT_RG=7,e.TEXTUREFORMAT_RED_INTEGER=8,e.TEXTUREFORMAT_R_INTEGER=8,e.TEXTUREFORMAT_RG_INTEGER=9,e.TEXTUREFORMAT_RGB_INTEGER=10,e.TEXTUREFORMAT_RGBA_INTEGER=11,e.TEXTURETYPE_UNSIGNED_BYTE=0,e.TEXTURETYPE_UNSIGNED_INT=0,e.TEXTURETYPE_FLOAT=1,e.TEXTURETYPE_HALF_FLOAT=2,e.TEXTURETYPE_BYTE=3,e.TEXTURETYPE_SHORT=4,e.TEXTURETYPE_UNSIGNED_SHORT=5,e.TEXTURETYPE_INT=6,e.TEXTURETYPE_UNSIGNED_INTEGER=7,e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,e.TEXTURETYPE_UNSIGNED_INT_24_8=12,e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,e.TEXTURE_NEAREST_SAMPLINGMODE=1,e.TEXTURE_BILINEAR_SAMPLINGMODE=2,e.TEXTURE_TRILINEAR_SAMPLINGMODE=3,e.TEXTURE_NEAREST_NEAREST_MIPLINEAR=1,e.TEXTURE_LINEAR_LINEAR_MIPNEAREST=2,e.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,e.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,e.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,e.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,e.TEXTURE_NEAREST_LINEAR=7,e.TEXTURE_NEAREST_NEAREST=8,e.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,e.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,e.TEXTURE_LINEAR_LINEAR=11,e.TEXTURE_LINEAR_NEAREST=12,e.TEXTURE_EXPLICIT_MODE=0,e.TEXTURE_SPHERICAL_MODE=1,e.TEXTURE_PLANAR_MODE=2,e.TEXTURE_CUBIC_MODE=3,e.TEXTURE_PROJECTION_MODE=4,e.TEXTURE_SKYBOX_MODE=5,e.TEXTURE_INVCUBIC_MODE=6,e.TEXTURE_EQUIRECTANGULAR_MODE=7,e.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,e.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,e.SCALEMODE_FLOOR=1,e.SCALEMODE_NEAREST=2,e.SCALEMODE_CEILING=3,e.MATERIAL_TextureDirtyFlag=1,e.MATERIAL_LightDirtyFlag=2,e.MATERIAL_FresnelDirtyFlag=4,e.MATERIAL_AttributesDirtyFlag=8,e.MATERIAL_MiscDirtyFlag=16,e.MATERIAL_AllDirtyFlag=31,e.MATERIAL_TriangleFillMode=0,e.MATERIAL_WireFrameFillMode=1,e.MATERIAL_PointFillMode=2,e.MATERIAL_PointListDrawMode=3,e.MATERIAL_LineListDrawMode=4,e.MATERIAL_LineLoopDrawMode=5,e.MATERIAL_LineStripDrawMode=6,e.MATERIAL_TriangleStripDrawMode=7,e.MATERIAL_TriangleFanDrawMode=8,e.MATERIAL_ClockWiseSideOrientation=0,e.MATERIAL_CounterClockWiseSideOrientation=1,e.ACTION_NothingTrigger=0,e.ACTION_OnPickTrigger=1,e.ACTION_OnLeftPickTrigger=2,e.ACTION_OnRightPickTrigger=3,e.ACTION_OnCenterPickTrigger=4,e.ACTION_OnPickDownTrigger=5,e.ACTION_OnDoublePickTrigger=6,e.ACTION_OnPickUpTrigger=7,e.ACTION_OnPickOutTrigger=16,e.ACTION_OnLongPressTrigger=8,e.ACTION_OnPointerOverTrigger=9,e.ACTION_OnPointerOutTrigger=10,e.ACTION_OnEveryFrameTrigger=11,e.ACTION_OnIntersectionEnterTrigger=12,e.ACTION_OnIntersectionExitTrigger=13,e.ACTION_OnKeyDownTrigger=14,e.ACTION_OnKeyUpTrigger=15,e.PARTICLES_BILLBOARDMODE_Y=2,e.PARTICLES_BILLBOARDMODE_ALL=7,e.PARTICLES_BILLBOARDMODE_STRETCHED=8,e.PARTICLES_BaseAssetsUrl="https://assets.babylonjs.com/particles",e.MESHES_CULLINGSTRATEGY_STANDARD=0,e.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,e.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,e.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,e.SCENELOADER_NO_LOGGING=0,e.SCENELOADER_MINIMAL_LOGGING=1,e.SCENELOADER_SUMMARY_LOGGING=2,e.SCENELOADER_DETAILED_LOGGING=3,e}(),n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function s(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=function(){return(o=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function a(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}var u=function(){function e(){}return e.Eval=function(t,r){return"true"===(t=t.match(/\([^\(\)]*\)/g)?t.replace(/\([^\(\)]*\)/g,function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,r)}):e._HandleParenthesisContent(t,r))||"false"!==t&&e.Eval(t,r)},e._HandleParenthesisContent=function(t,r){var i;r=r||function(e){return"true"===e};var n=t.split("||");for(var s in n)if(n.hasOwnProperty(s)){var o=e._SimplifyNegation(n[s].trim()),a=o.split("&&");if(a.length>1)for(var u=0;u<a.length;++u){var h=e._SimplifyNegation(a[u].trim());if(!(i="true"!==h&&"false"!==h?"!"===h[0]?!r(h.substring(1)):r(h):"true"===h)){o="false";break}}if(i||"true"===o){i=!0;break}i="true"!==o&&"false"!==o?"!"===o[0]?!r(o.substring(1)):r(o):"true"===o}return i?"true":"false"},e._SimplifyNegation=function(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,function(e){return(e=e.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())?e="false":"!false"===e&&(e="true"),e},e}(),h=function(){function e(){}return e.EnableFor=function(t){t._tags=t._tags||{},t.hasTags=function(){return e.HasTags(t)},t.addTags=function(r){return e.AddTagsTo(t,r)},t.removeTags=function(r){return e.RemoveTagsFrom(t,r)},t.matchesTagsQuery=function(r){return e.MatchesQuery(t,r)}},e.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},e.HasTags=function(e){if(!e._tags)return!1;var t=e._tags;for(var r in t)if(t.hasOwnProperty(r))return!0;return!1},e.GetTags=function(e,t){if(void 0===t&&(t=!0),!e._tags)return null;if(t){var r=[];for(var i in e._tags)e._tags.hasOwnProperty(i)&&!0===e._tags[i]&&r.push(i);return r.join(" ")}return e._tags},e.AddTagsTo=function(t,r){r&&("string"==typeof r&&r.split(" ").forEach(function(r,i,n){e._AddTagTo(t,r)}))},e._AddTagTo=function(t,r){""!==(r=r.trim())&&"true"!==r&&"false"!==r&&(r.match(/[\s]/)||r.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(t),t._tags[r]=!0))},e.RemoveTagsFrom=function(t,r){if(e.HasTags(t)){var i=r.split(" ");for(var n in i)e._RemoveTagFrom(t,i[n])}},e._RemoveTagFrom=function(e,t){delete e._tags[t]},e.MatchesQuery=function(t,r){return void 0===r||(""===r?e.HasTags(t):u.Eval(r,function(r){return e.HasTags(t)&&t._tags[r]}))},e}(),l=function(){function e(){}return e.WithinEpsilon=function(e,t,r){void 0===r&&(r=1401298e-51);var i=e-t;return-r<=i&&i<=r},e.ToHex=function(e){var t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()},e.Sign=function(e){return 0===(e=+e)||isNaN(e)?e:e>0?1:-1},e.Clamp=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=1),Math.min(r,Math.max(t,e))},e.Log2=function(e){return Math.log(e)*Math.LOG2E},e.Repeat=function(e,t){return e-Math.floor(e/t)*t},e.Normalize=function(e,t,r){return(e-t)/(r-t)},e.Denormalize=function(e,t,r){return e*(r-t)+t},e.DeltaAngle=function(t,r){var i=e.Repeat(r-t,360);return i>180&&(i-=360),i},e.PingPong=function(t,r){var i=e.Repeat(t,2*r);return r-Math.abs(i-r)},e.SmoothStep=function(t,r,i){var n=e.Clamp(i);return r*(n=-2*n*n*n+3*n*n)+t*(1-n)},e.MoveTowards=function(t,r,i){return Math.abs(r-t)<=i?r:t+e.Sign(r-t)*i},e.MoveTowardsAngle=function(t,r,i){var n=e.DeltaAngle(t,r),s=0;return-i<n&&n<i?s=r:(r=t+n,s=e.MoveTowards(t,r,i)),s},e.Lerp=function(e,t,r){return e+(t-e)*r},e.LerpAngle=function(t,r,i){var n=e.Repeat(r-t,360);return n>180&&(n-=360),t+n*e.Clamp(i)},e.InverseLerp=function(t,r,i){return t!=r?e.Clamp((i-t)/(r-t)):0},e.Hermite=function(e,t,r,i,n){var s=n*n,o=n*s;return e*(2*o-3*s+1)+r*(-2*o+3*s)+t*(o-2*s+n)+i*(o-s)},e.RandomRange=function(e,t){return e===t?e:Math.random()*(t-e)+e},e.RangeToPercent=function(e,t,r){return(e-t)/(r-t)},e.PercentToRange=function(e,t,r){return(r-t)*e+t},e.NormalizeRadians=function(t){return t-=e.TwoPi*Math.floor((t+Math.PI)/e.TwoPi)},e.TwoPi=2*Math.PI,e}(),_=function(){function e(){}return e.BuildArray=function(e,t){for(var r=[],i=0;i<e;++i)r.push(t());return r},e}(),c=function(){function e(){}return e.GetClass=function(e){return this.RegisteredTypes&&this.RegisteredTypes[e]?this.RegisteredTypes[e]:null},e.RegisteredTypes={},e}(),f=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},e.prototype.getClassName=function(){return"Vector2"},e.prototype.getHashCode=function(){var e=0|this.x;return e=397*e^(0|this.y)},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,this},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},e.prototype.copyFromFloats=function(e,t){return this.x=e,this.y=t,this},e.prototype.set=function(e,t){return this.copyFromFloats(e,t)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,this},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.addVector3=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,this},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},e.prototype.multiplyByFloats=function(t,r){return new e(this.x*t,this.y*r)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.negate=function(){return new e(-this.x,-this.y)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},e.prototype.scale=function(t){var r=new e(0,0);return this.scaleToRef(t,r),r},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,this},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=.001),e&&l.WithinEpsilon(this.x,e.x,t)&&l.WithinEpsilon(this.y,e.y,t)},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},e.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this},e.prototype.clone=function(){return new e(this.x,this.y)},e.Zero=function(){return new e(0,0)},e.One=function(){return new e(1,1)},e.FromArray=function(t,r){return void 0===r&&(r=0),new e(t[r],t[r+1])},e.FromArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1]},e.CatmullRom=function(t,r,i,n,s){var o=s*s,a=s*o;return new e(.5*(2*r.x+(-t.x+i.x)*s+(2*t.x-5*r.x+4*i.x-n.x)*o+(-t.x+3*r.x-3*i.x+n.x)*a),.5*(2*r.y+(-t.y+i.y)*s+(2*t.y-5*r.y+4*i.y-n.y)*o+(-t.y+3*r.y-3*i.y+n.y)*a))},e.Clamp=function(t,r,i){var n=t.x;n=(n=n>i.x?i.x:n)<r.x?r.x:n;var s=t.y;return new e(n,s=(s=s>i.y?i.y:s)<r.y?r.y:s)},e.Hermite=function(t,r,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,l=a-2*o+s,_=a-o;return new e(t.x*u+i.x*h+r.x*l+n.x*_,t.y*u+i.y*h+r.y*l+n.y*_)},e.Lerp=function(t,r,i){return new e(t.x+(r.x-t.x)*i,t.y+(r.y-t.y)*i)},e.Dot=function(e,t){return e.x*t.x+e.y*t.y},e.Normalize=function(e){var t=e.clone();return t.normalize(),t},e.Minimize=function(t,r){return new e(t.x<r.x?t.x:r.x,t.y<r.y?t.y:r.y)},e.Maximize=function(t,r){return new e(t.x>r.x?t.x:r.x,t.y>r.y?t.y:r.y)},e.Transform=function(t,r){var i=e.Zero();return e.TransformToRef(t,r,i),i},e.TransformToRef=function(e,t,r){var i=t.m,n=e.x*i[0]+e.y*i[4]+i[12],s=e.x*i[1]+e.y*i[5]+i[13];r.x=n,r.y=s},e.PointInTriangle=function(e,t,r,i){var n=.5*(-r.y*i.x+t.y*(-r.x+i.x)+t.x*(r.y-i.y)+r.x*i.y),s=n<0?-1:1,o=(t.y*i.x-t.x*i.y+(i.y-t.y)*e.x+(t.x-i.x)*e.y)*s,a=(t.x*r.y-t.y*r.x+(t.y-r.y)*e.x+(r.x-t.x)*e.y)*s;return o>0&&a>0&&o+a<2*n*s},e.Distance=function(t,r){return Math.sqrt(e.DistanceSquared(t,r))},e.DistanceSquared=function(e,t){var r=e.x-t.x,i=e.y-t.y;return r*r+i*i},e.Center=function(e,t){var r=e.add(t);return r.scaleInPlace(.5),r},e.DistanceOfPointFromSegment=function(t,r,i){var n=e.DistanceSquared(r,i);if(0===n)return e.Distance(t,r);var s=i.subtract(r),o=Math.max(0,Math.min(1,e.Dot(t.subtract(r),s)/n)),a=r.add(s.multiplyByFloats(o,o));return e.Distance(t,a)},e}(),p=function(){function e(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),this.x=e,this.y=t,this.z=r}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},e.prototype.getClassName=function(){return"Vector3"},e.prototype.getHashCode=function(){var e=0|this.x;return e=397*(e=397*e^(0|this.y))^(0|this.z)},e.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,this},e.prototype.toQuaternion=function(){return E.RotationYawPitchRoll(this.y,this.x,this.z)},e.prototype.addInPlace=function(e){return this.addInPlaceFromFloats(e.x,e.y,e.z)},e.prototype.addInPlaceFromFloats=function(e,t,r){return this.x+=e,this.y+=t,this.z+=r,this},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)},e.prototype.addToRef=function(e,t){return t.copyFromFloats(this.x+e.x,this.y+e.y,this.z+e.z)},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)},e.prototype.subtractToRef=function(e,t){return this.subtractFromFloatsToRef(e.x,e.y,e.z,t)},e.prototype.subtractFromFloats=function(t,r,i){return new e(this.x-t,this.y-r,this.z-i)},e.prototype.subtractFromFloatsToRef=function(e,t,r,i){return i.copyFromFloats(this.x-e,this.y-t,this.z-r)},e.prototype.negate=function(){return new e(-this.x,-this.y,-this.z)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t)},e.prototype.scaleToRef=function(e,t){return t.copyFromFloats(this.x*e,this.y*e,this.z*e)},e.prototype.scaleAndAddToRef=function(e,t){return t.addInPlaceFromFloats(this.x*e,this.y*e,this.z*e)},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=.001),e&&l.WithinEpsilon(this.x,e.x,t)&&l.WithinEpsilon(this.y,e.y,t)&&l.WithinEpsilon(this.z,e.z,t)},e.prototype.equalsToFloats=function(e,t,r){return this.x===e&&this.y===t&&this.z===r},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},e.prototype.multiply=function(e){return this.multiplyByFloats(e.x,e.y,e.z)},e.prototype.multiplyToRef=function(e,t){return t.copyFromFloats(this.x*e.x,this.y*e.y,this.z*e.z)},e.prototype.multiplyByFloats=function(t,r,i){return new e(this.x*t,this.y*r,this.z*i)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z)},e.prototype.divideToRef=function(e,t){return t.copyFromFloats(this.x/e.x,this.y/e.y,this.z/e.z)},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.minimizeInPlace=function(e){return this.minimizeInPlaceFromFloats(e.x,e.y,e.z)},e.prototype.maximizeInPlace=function(e){return this.maximizeInPlaceFromFloats(e.x,e.y,e.z)},e.prototype.minimizeInPlaceFromFloats=function(e,t,r){return e<this.x&&(this.x=e),t<this.y&&(this.y=t),r<this.z&&(this.z=r),this},e.prototype.maximizeInPlaceFromFloats=function(e,t,r){return e>this.x&&(this.x=e),t>this.y&&(this.y=t),r>this.z&&(this.z=r),this},e.prototype.isNonUniformWithinEpsilon=function(e){var t=Math.abs(this.x),r=Math.abs(this.y);if(!l.WithinEpsilon(t,r,e))return!0;var i=Math.abs(this.z);return!l.WithinEpsilon(t,i,e)||!l.WithinEpsilon(r,i,e)},Object.defineProperty(e.prototype,"isNonUniform",{get:function(){var e=Math.abs(this.x),t=Math.abs(this.y);if(e!==t)return!0;var r=Math.abs(this.z);return e!==r||t!==r},enumerable:!0,configurable:!0}),e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.prototype.normalize=function(){return this.normalizeFromLength(this.length())},e.prototype.reorderInPlace=function(e){var t=this;return"xyz"===(e=e.toLowerCase())?this:(g.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(r,i){t[r]=g.Vector3[0][e[i]]}),this)},e.prototype.rotateByQuaternionToRef=function(t,r){return t.toRotationMatrix(g.Matrix[0]),e.TransformCoordinatesToRef(this,g.Matrix[0],r),r},e.prototype.rotateByQuaternionAroundPointToRef=function(e,t,r){return this.subtractToRef(t,g.Vector3[0]),g.Vector3[0].rotateByQuaternionToRef(e,g.Vector3[0]),t.addToRef(g.Vector3[0],r),r},e.prototype.cross=function(t){return e.Cross(this,t)},e.prototype.normalizeFromLength=function(e){return 0===e||1===e?this:this.scaleInPlace(1/e)},e.prototype.normalizeToNew=function(){var t=new e(0,0,0);return this.normalizeToRef(t),t},e.prototype.normalizeToRef=function(e){var t=this.length();return 0===t||1===t?e.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/t,e)},e.prototype.clone=function(){return new e(this.x,this.y,this.z)},e.prototype.copyFrom=function(e){return this.copyFromFloats(e.x,e.y,e.z)},e.prototype.copyFromFloats=function(e,t,r){return this.x=e,this.y=t,this.z=r,this},e.prototype.set=function(e,t,r){return this.copyFromFloats(e,t,r)},e.prototype.setAll=function(e){return this.x=this.y=this.z=e,this},e.GetClipFactor=function(t,r,i,n){var s=e.Dot(t,i)-n;return s/(s-(e.Dot(r,i)-n))},e.GetAngleBetweenVectors=function(t,r,i){var n=t.normalizeToRef(g.Vector3[1]),s=r.normalizeToRef(g.Vector3[2]),o=e.Dot(n,s),a=g.Vector3[3];return e.CrossToRef(n,s,a),e.Dot(a,i)>0?Math.acos(o):-Math.acos(o)},e.FromArray=function(t,r){return void 0===r&&(r=0),new e(t[r],t[r+1],t[r+2])},e.FromFloatArray=function(t,r){return e.FromArray(t,r)},e.FromArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1],r.z=e[t+2]},e.FromFloatArrayToRef=function(t,r,i){return e.FromArrayToRef(t,r,i)},e.FromFloatsToRef=function(e,t,r,i){i.copyFromFloats(e,t,r)},e.Zero=function(){return new e(0,0,0)},e.One=function(){return new e(1,1,1)},e.Up=function(){return new e(0,1,0)},Object.defineProperty(e,"UpReadOnly",{get:function(){return e._UpReadOnly},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ZeroReadOnly",{get:function(){return e._ZeroReadOnly},enumerable:!0,configurable:!0}),e.Down=function(){return new e(0,-1,0)},e.Forward=function(){return new e(0,0,1)},e.Backward=function(){return new e(0,0,-1)},e.Right=function(){return new e(1,0,0)},e.Left=function(){return new e(-1,0,0)},e.TransformCoordinates=function(t,r){var i=e.Zero();return e.TransformCoordinatesToRef(t,r,i),i},e.TransformCoordinatesToRef=function(t,r,i){e.TransformCoordinatesFromFloatsToRef(t.x,t.y,t.z,r,i)},e.TransformCoordinatesFromFloatsToRef=function(e,t,r,i,n){var s=i.m,o=e*s[0]+t*s[4]+r*s[8]+s[12],a=e*s[1]+t*s[5]+r*s[9]+s[13],u=e*s[2]+t*s[6]+r*s[10]+s[14],h=1/(e*s[3]+t*s[7]+r*s[11]+s[15]);n.x=o*h,n.y=a*h,n.z=u*h},e.TransformNormal=function(t,r){var i=e.Zero();return e.TransformNormalToRef(t,r,i),i},e.TransformNormalToRef=function(e,t,r){this.TransformNormalFromFloatsToRef(e.x,e.y,e.z,t,r)},e.TransformNormalFromFloatsToRef=function(e,t,r,i,n){var s=i.m;n.x=e*s[0]+t*s[4]+r*s[8],n.y=e*s[1]+t*s[5]+r*s[9],n.z=e*s[2]+t*s[6]+r*s[10]},e.CatmullRom=function(t,r,i,n,s){var o=s*s,a=s*o;return new e(.5*(2*r.x+(-t.x+i.x)*s+(2*t.x-5*r.x+4*i.x-n.x)*o+(-t.x+3*r.x-3*i.x+n.x)*a),.5*(2*r.y+(-t.y+i.y)*s+(2*t.y-5*r.y+4*i.y-n.y)*o+(-t.y+3*r.y-3*i.y+n.y)*a),.5*(2*r.z+(-t.z+i.z)*s+(2*t.z-5*r.z+4*i.z-n.z)*o+(-t.z+3*r.z-3*i.z+n.z)*a))},e.Clamp=function(t,r,i){var n=new e;return e.ClampToRef(t,r,i,n),n},e.ClampToRef=function(e,t,r,i){var n=e.x;n=(n=n>r.x?r.x:n)<t.x?t.x:n;var s=e.y;s=(s=s>r.y?r.y:s)<t.y?t.y:s;var o=e.z;o=(o=o>r.z?r.z:o)<t.z?t.z:o,i.copyFromFloats(n,s,o)},e.CheckExtends=function(e,t,r){t.minimizeInPlace(e),r.maximizeInPlace(e)},e.Hermite=function(t,r,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,l=a-2*o+s,_=a-o;return new e(t.x*u+i.x*h+r.x*l+n.x*_,t.y*u+i.y*h+r.y*l+n.y*_,t.z*u+i.z*h+r.z*l+n.z*_)},e.Lerp=function(t,r,i){var n=new e(0,0,0);return e.LerpToRef(t,r,i,n),n},e.LerpToRef=function(e,t,r,i){i.x=e.x+(t.x-e.x)*r,i.y=e.y+(t.y-e.y)*r,i.z=e.z+(t.z-e.z)*r},e.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},e.Cross=function(t,r){var i=e.Zero();return e.CrossToRef(t,r,i),i},e.CrossToRef=function(e,t,r){var i=e.y*t.z-e.z*t.y,n=e.z*t.x-e.x*t.z,s=e.x*t.y-e.y*t.x;r.copyFromFloats(i,n,s)},e.Normalize=function(t){var r=e.Zero();return e.NormalizeToRef(t,r),r},e.NormalizeToRef=function(e,t){e.normalizeToRef(t)},e.Project=function(t,r,i,n){var s=n.width,o=n.height,a=n.x,u=n.y,h=g.Matrix[1];T.FromValuesToRef(s/2,0,0,0,0,-o/2,0,0,0,0,.5,0,a+s/2,o/2+u,.5,1,h);var l=g.Matrix[0];return r.multiplyToRef(i,l),l.multiplyToRef(h,l),e.TransformCoordinates(t,l)},e._UnprojectFromInvertedMatrixToRef=function(t,r,i){e.TransformCoordinatesToRef(t,r,i);var n=r.m,s=t.x*n[3]+t.y*n[7]+t.z*n[11]+n[15];l.WithinEpsilon(s,1)&&i.scaleInPlace(1/s)},e.UnprojectFromTransform=function(t,r,i,n,s){var o=g.Matrix[0];n.multiplyToRef(s,o),o.invert(),t.x=t.x/r*2-1,t.y=-(t.y/i*2-1);var a=new e;return e._UnprojectFromInvertedMatrixToRef(t,o,a),a},e.Unproject=function(t,r,i,n,s,o){var a=e.Zero();return e.UnprojectToRef(t,r,i,n,s,o,a),a},e.UnprojectToRef=function(t,r,i,n,s,o,a){e.UnprojectFloatsToRef(t.x,t.y,t.z,r,i,n,s,o,a)},e.UnprojectFloatsToRef=function(t,r,i,n,s,o,a,u,h){var l=g.Matrix[0];o.multiplyToRef(a,l),l.multiplyToRef(u,l),l.invert();var _=g.Vector3[0];_.x=t/n*2-1,_.y=-(r/s*2-1),_.z=2*i-1,e._UnprojectFromInvertedMatrixToRef(_,l,h)},e.Minimize=function(e,t){var r=e.clone();return r.minimizeInPlace(t),r},e.Maximize=function(e,t){var r=e.clone();return r.maximizeInPlace(t),r},e.Distance=function(t,r){return Math.sqrt(e.DistanceSquared(t,r))},e.DistanceSquared=function(e,t){var r=e.x-t.x,i=e.y-t.y,n=e.z-t.z;return r*r+i*i+n*n},e.Center=function(e,t){var r=e.add(t);return r.scaleInPlace(.5),r},e.RotationFromAxis=function(t,r,i){var n=e.Zero();return e.RotationFromAxisToRef(t,r,i,n),n},e.RotationFromAxisToRef=function(e,t,r,i){var n=g.Quaternion[0];E.RotationQuaternionFromAxisToRef(e,t,r,n),n.toEulerAnglesToRef(i)},e._UpReadOnly=e.Up(),e._ZeroReadOnly=e.Zero(),e}(),d=function(){function e(e,t,r,i){this.x=e,this.y=t,this.z=r,this.w=i}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},e.prototype.getClassName=function(){return"Vector4"},e.prototype.getHashCode=function(){var e=0|this.x;return e=397*(e=397*(e=397*e^(0|this.y))^(0|this.z))^(0|this.w)},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},e.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},e.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},e.prototype.subtractFromFloats=function(t,r,i,n){return new e(this.x-t,this.y-r,this.z-i,this.w-n)},e.prototype.subtractFromFloatsToRef=function(e,t,r,i,n){return n.x=this.x-e,n.y=this.y-t,n.z=this.z-r,n.w=this.w-i,this},e.prototype.negate=function(){return new e(-this.x,-this.y,-this.z,-this.w)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=.001),e&&l.WithinEpsilon(this.x,e.x,t)&&l.WithinEpsilon(this.y,e.y,t)&&l.WithinEpsilon(this.z,e.z,t)&&l.WithinEpsilon(this.w,e.w,t)},e.prototype.equalsToFloats=function(e,t,r,i){return this.x===e&&this.y===t&&this.z===r&&this.w===i},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},e.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},e.prototype.multiplyByFloats=function(t,r,i,n){return new e(this.x*t,this.y*r,this.z*i,this.w*n)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},e.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.minimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},e.prototype.maximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.prototype.normalize=function(){var e=this.length();return 0===e?this:this.scaleInPlace(1/e)},e.prototype.toVector3=function(){return new p(this.x,this.y,this.z)},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.copyFromFloats=function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},e.prototype.set=function(e,t,r,i){return this.copyFromFloats(e,t,r,i)},e.prototype.setAll=function(e){return this.x=this.y=this.z=this.w=e,this},e.FromArray=function(t,r){return r||(r=0),new e(t[r],t[r+1],t[r+2],t[r+3])},e.FromArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1],r.z=e[t+2],r.w=e[t+3]},e.FromFloatArrayToRef=function(t,r,i){e.FromArrayToRef(t,r,i)},e.FromFloatsToRef=function(e,t,r,i,n){n.x=e,n.y=t,n.z=r,n.w=i},e.Zero=function(){return new e(0,0,0,0)},e.One=function(){return new e(1,1,1,1)},e.Normalize=function(t){var r=e.Zero();return e.NormalizeToRef(t,r),r},e.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},e.Minimize=function(e,t){var r=e.clone();return r.minimizeInPlace(t),r},e.Maximize=function(e,t){var r=e.clone();return r.maximizeInPlace(t),r},e.Distance=function(t,r){return Math.sqrt(e.DistanceSquared(t,r))},e.DistanceSquared=function(e,t){var r=e.x-t.x,i=e.y-t.y,n=e.z-t.z,s=e.w-t.w;return r*r+i*i+n*n+s*s},e.Center=function(e,t){var r=e.add(t);return r.scaleInPlace(.5),r},e.TransformNormal=function(t,r){var i=e.Zero();return e.TransformNormalToRef(t,r,i),i},e.TransformNormalToRef=function(e,t,r){var i=t.m,n=e.x*i[0]+e.y*i[4]+e.z*i[8],s=e.x*i[1]+e.y*i[5]+e.z*i[9],o=e.x*i[2]+e.y*i[6]+e.z*i[10];r.x=n,r.y=s,r.z=o,r.w=e.w},e.TransformNormalFromFloatsToRef=function(e,t,r,i,n,s){var o=n.m;s.x=e*o[0]+t*o[4]+r*o[8],s.y=e*o[1]+t*o[5]+r*o[9],s.z=e*o[2]+t*o[6]+r*o[10],s.w=i},e.FromVector3=function(t,r){return void 0===r&&(r=0),new e(t.x,t.y,t.z,r)},e}(),E=function(){function e(e,t,r,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=1),this.x=e,this.y=t,this.z=r,this.w=i}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},e.prototype.getClassName=function(){return"Quaternion"},e.prototype.getHashCode=function(){var e=0|this.x;return e=397*(e=397*(e=397*e^(0|this.y))^(0|this.z))^(0|this.w)},e.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.copyFromFloats=function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},e.prototype.set=function(e,t,r,i){return this.copyFromFloats(e,t,r,i)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},e.prototype.multiply=function(t){var r=new e(0,0,0,1);return this.multiplyToRef(t,r),r},e.prototype.multiplyToRef=function(e,t){var r=this.x*e.w+this.y*e.z-this.z*e.y+this.w*e.x,i=-this.x*e.z+this.y*e.w+this.z*e.x+this.w*e.y,n=this.x*e.y-this.y*e.x+this.z*e.w+this.w*e.z,s=-this.x*e.x-this.y*e.y-this.z*e.z+this.w*e.w;return t.copyFromFloats(r,i,n,s),this},e.prototype.multiplyInPlace=function(e){return this.multiplyToRef(e,this),this},e.prototype.conjugateToRef=function(e){return e.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},e.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},e.prototype.conjugate=function(){return new e(-this.x,-this.y,-this.z,this.w)},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.prototype.toEulerAngles=function(e){void 0===e&&(e="YZX");var t=p.Zero();return this.toEulerAnglesToRef(t),t},e.prototype.toEulerAnglesToRef=function(e){var t=this.z,r=this.x,i=this.y,n=this.w,s=n*n,o=t*t,a=r*r,u=i*i,h=i*t-r*n;return h<-.4999999?(e.y=2*Math.atan2(i,n),e.x=Math.PI/2,e.z=0):h>.4999999?(e.y=2*Math.atan2(i,n),e.x=-Math.PI/2,e.z=0):(e.z=Math.atan2(2*(r*i+t*n),-o-a+u+s),e.x=Math.asin(-2*(t*i-r*n)),e.y=Math.atan2(2*(t*r+i*n),o-a-u+s)),this},e.prototype.toRotationMatrix=function(e){return T.FromQuaternionToRef(this,e),this},e.prototype.fromRotationMatrix=function(t){return e.FromRotationMatrixToRef(t,this),this},e.FromRotationMatrix=function(t){var r=new e;return e.FromRotationMatrixToRef(t,r),r},e.FromRotationMatrixToRef=function(e,t){var r,i=e.m,n=i[0],s=i[4],o=i[8],a=i[1],u=i[5],h=i[9],l=i[2],_=i[6],c=i[10],f=n+u+c;f>0?(r=.5/Math.sqrt(f+1),t.w=.25/r,t.x=(_-h)*r,t.y=(o-l)*r,t.z=(a-s)*r):n>u&&n>c?(r=2*Math.sqrt(1+n-u-c),t.w=(_-h)/r,t.x=.25*r,t.y=(s+a)/r,t.z=(o+l)/r):u>c?(r=2*Math.sqrt(1+u-n-c),t.w=(o-l)/r,t.x=(s+a)/r,t.y=.25*r,t.z=(h+_)/r):(r=2*Math.sqrt(1+c-n-u),t.w=(a-s)/r,t.x=(o+l)/r,t.y=(h+_)/r,t.z=.25*r)},e.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},e.AreClose=function(t,r){return e.Dot(t,r)>=0},e.Zero=function(){return new e(0,0,0,0)},e.Inverse=function(t){return new e(-t.x,-t.y,-t.z,t.w)},e.InverseToRef=function(e,t){return t.set(-e.x,-e.y,-e.z,e.w),t},e.Identity=function(){return new e(0,0,0,1)},e.IsIdentity=function(e){return e&&0===e.x&&0===e.y&&0===e.z&&1===e.w},e.RotationAxis=function(t,r){return e.RotationAxisToRef(t,r,new e)},e.RotationAxisToRef=function(e,t,r){var i=Math.sin(t/2);return e.normalize(),r.w=Math.cos(t/2),r.x=e.x*i,r.y=e.y*i,r.z=e.z*i,r},e.FromArray=function(t,r){return r||(r=0),new e(t[r],t[r+1],t[r+2],t[r+3])},e.FromEulerAngles=function(t,r,i){var n=new e;return e.RotationYawPitchRollToRef(r,t,i,n),n},e.FromEulerAnglesToRef=function(t,r,i,n){return e.RotationYawPitchRollToRef(r,t,i,n),n},e.FromEulerVector=function(t){var r=new e;return e.RotationYawPitchRollToRef(t.y,t.x,t.z,r),r},e.FromEulerVectorToRef=function(t,r){return e.RotationYawPitchRollToRef(t.y,t.x,t.z,r),r},e.RotationYawPitchRoll=function(t,r,i){var n=new e;return e.RotationYawPitchRollToRef(t,r,i,n),n},e.RotationYawPitchRollToRef=function(e,t,r,i){var n=.5*r,s=.5*t,o=.5*e,a=Math.sin(n),u=Math.cos(n),h=Math.sin(s),l=Math.cos(s),_=Math.sin(o),c=Math.cos(o);i.x=c*h*u+_*l*a,i.y=_*l*u-c*h*a,i.z=c*l*a-_*h*u,i.w=c*l*u+_*h*a},e.RotationAlphaBetaGamma=function(t,r,i){var n=new e;return e.RotationAlphaBetaGammaToRef(t,r,i,n),n},e.RotationAlphaBetaGammaToRef=function(e,t,r,i){var n=.5*(r+e),s=.5*(r-e),o=.5*t;i.x=Math.cos(s)*Math.sin(o),i.y=Math.sin(s)*Math.sin(o),i.z=Math.sin(n)*Math.cos(o),i.w=Math.cos(n)*Math.cos(o)},e.RotationQuaternionFromAxis=function(t,r,i){var n=new e(0,0,0,0);return e.RotationQuaternionFromAxisToRef(t,r,i,n),n},e.RotationQuaternionFromAxisToRef=function(t,r,i,n){var s=g.Matrix[0];T.FromXYZAxesToRef(t.normalize(),r.normalize(),i.normalize(),s),e.FromRotationMatrixToRef(s,n)},e.Slerp=function(t,r,i){var n=e.Identity();return e.SlerpToRef(t,r,i,n),n},e.SlerpToRef=function(e,t,r,i){var n,s,o=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,a=!1;if(o<0&&(a=!0,o=-o),o>.999999)s=1-r,n=a?-r:r;else{var u=Math.acos(o),h=1/Math.sin(u);s=Math.sin((1-r)*u)*h,n=a?-Math.sin(r*u)*h:Math.sin(r*u)*h}i.x=s*e.x+n*t.x,i.y=s*e.y+n*t.y,i.z=s*e.z+n*t.z,i.w=s*e.w+n*t.w},e.Hermite=function(t,r,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,l=a-2*o+s,_=a-o;return new e(t.x*u+i.x*h+r.x*l+n.x*_,t.y*u+i.y*h+r.y*l+n.y*_,t.z*u+i.z*h+r.z*l+n.z*_,t.w*u+i.w*h+r.w*l+n.w*_)},e}(),T=function(){function e(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,this._m=new Float32Array(16),this._updateIdentityStatus(!1)}return Object.defineProperty(e.prototype,"m",{get:function(){return this._m},enumerable:!0,configurable:!0}),e.prototype._markAsUpdated=function(){this.updateFlag=e._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},e.prototype._updateIdentityStatus=function(t,r,i,n){void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===n&&(n=!0),this.updateFlag=e._updateFlagSeed++,this._isIdentity=t,this._isIdentity3x2=t||i,this._isIdentityDirty=!this._isIdentity&&r,this._isIdentity3x2Dirty=!this._isIdentity3x2&&n},e.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var e=this._m;this._isIdentity=1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]}return this._isIdentity},e.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]?this._isIdentity3x2=!1:0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},e.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var e=this._m,t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],u=e[7],h=e[8],l=e[9],_=e[10],c=e[11],f=e[12],p=e[13],d=e[14],E=e[15],T=_*E-d*c,g=l*E-p*c,R=l*d-p*_,y=h*E-f*c,m=h*d-_*f,A=h*p-f*l;return t*+(o*T-a*g+u*R)+r*-(s*T-a*y+u*m)+i*+(s*g-o*y+u*A)+n*-(s*R-o*m+a*A)},e.prototype.toArray=function(){return this._m},e.prototype.asArray=function(){return this._m},e.prototype.invert=function(){return this.invertToRef(this),this},e.prototype.reset=function(){return e.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},e.prototype.add=function(t){var r=new e;return this.addToRef(t,r),r},e.prototype.addToRef=function(e,t){for(var r=this._m,i=t._m,n=e.m,s=0;s<16;s++)i[s]=r[s]+n[s];return t._markAsUpdated(),this},e.prototype.addToSelf=function(e){for(var t=this._m,r=e.m,i=0;i<16;i++)t[i]+=r[i];return this._markAsUpdated(),this},e.prototype.invertToRef=function(t){if(!0===this._isIdentity)return e.IdentityToRef(t),this;var r=this._m,i=r[0],n=r[1],s=r[2],o=r[3],a=r[4],u=r[5],h=r[6],l=r[7],_=r[8],c=r[9],f=r[10],p=r[11],d=r[12],E=r[13],T=r[14],g=r[15],R=f*g-T*p,y=c*g-E*p,m=c*T-E*f,A=_*g-d*p,b=_*T-f*d,x=_*E-d*c,v=+(u*R-h*y+l*m),S=-(a*R-h*A+l*b),O=+(a*y-u*A+l*x),I=-(a*m-u*b+h*x),F=i*v+n*S+s*O+o*I;if(0===F)return t.copyFrom(this),this;var M=1/F,P=h*g-T*l,L=u*g-E*l,N=u*T-E*h,U=a*g-d*l,C=a*T-d*h,D=a*E-d*u,w=h*p-f*l,B=u*p-c*l,G=u*f-c*h,X=a*p-_*l,z=a*f-_*h,k=a*c-_*u,V=-(n*R-s*y+o*m),H=+(i*R-s*A+o*b),W=-(i*y-n*A+o*x),Y=+(i*m-n*b+s*x),j=+(n*P-s*L+o*N),q=-(i*P-s*U+o*C),Q=+(i*L-n*U+o*D),Z=-(i*N-n*C+s*D),K=-(n*w-s*B+o*G),J=+(i*w-s*X+o*z),$=-(i*B-n*X+o*k),ee=+(i*G-n*z+s*k);return e.FromValuesToRef(v*M,V*M,j*M,K*M,S*M,H*M,q*M,J*M,O*M,W*M,Q*M,$*M,I*M,Y*M,Z*M,ee*M,t),this},e.prototype.addAtIndex=function(e,t){return this._m[e]+=t,this._markAsUpdated(),this},e.prototype.multiplyAtIndex=function(e,t){return this._m[e]*=t,this._markAsUpdated(),this},e.prototype.setTranslationFromFloats=function(e,t,r){return this._m[12]=e,this._m[13]=t,this._m[14]=r,this._markAsUpdated(),this},e.prototype.addTranslationFromFloats=function(e,t,r){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=r,this._markAsUpdated(),this},e.prototype.setTranslation=function(e){return this.setTranslationFromFloats(e.x,e.y,e.z)},e.prototype.getTranslation=function(){return new p(this._m[12],this._m[13],this._m[14])},e.prototype.getTranslationToRef=function(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],this},e.prototype.removeRotationAndScaling=function(){var t=this.m;return e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t[12],t[13],t[14],t[15],this),this._updateIdentityStatus(0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]),this},e.prototype.multiply=function(t){var r=new e;return this.multiplyToRef(t,r),r},e.prototype.copyFrom=function(e){e.copyToArray(this._m);var t=e;return this._updateIdentityStatus(t._isIdentity,t._isIdentityDirty,t._isIdentity3x2,t._isIdentity3x2Dirty),this},e.prototype.copyToArray=function(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)e[t+r]=this._m[r];return this},e.prototype.multiplyToRef=function(e,t){return this._isIdentity?(t.copyFrom(e),this):e._isIdentity?(t.copyFrom(this),this):(this.multiplyToArray(e,t._m,0),t._markAsUpdated(),this)},e.prototype.multiplyToArray=function(e,t,r){var i=this._m,n=e.m,s=i[0],o=i[1],a=i[2],u=i[3],h=i[4],l=i[5],_=i[6],c=i[7],f=i[8],p=i[9],d=i[10],E=i[11],T=i[12],g=i[13],R=i[14],y=i[15],m=n[0],A=n[1],b=n[2],x=n[3],v=n[4],S=n[5],O=n[6],I=n[7],F=n[8],M=n[9],P=n[10],L=n[11],N=n[12],U=n[13],C=n[14],D=n[15];return t[r]=s*m+o*v+a*F+u*N,t[r+1]=s*A+o*S+a*M+u*U,t[r+2]=s*b+o*O+a*P+u*C,t[r+3]=s*x+o*I+a*L+u*D,t[r+4]=h*m+l*v+_*F+c*N,t[r+5]=h*A+l*S+_*M+c*U,t[r+6]=h*b+l*O+_*P+c*C,t[r+7]=h*x+l*I+_*L+c*D,t[r+8]=f*m+p*v+d*F+E*N,t[r+9]=f*A+p*S+d*M+E*U,t[r+10]=f*b+p*O+d*P+E*C,t[r+11]=f*x+p*I+d*L+E*D,t[r+12]=T*m+g*v+R*F+y*N,t[r+13]=T*A+g*S+R*M+y*U,t[r+14]=T*b+g*O+R*P+y*C,t[r+15]=T*x+g*I+R*L+y*D,this},e.prototype.equals=function(e){var t=e;if(!t)return!1;if((this._isIdentity||t._isIdentity)&&!this._isIdentityDirty&&!t._isIdentityDirty)return this._isIdentity&&t._isIdentity;var r=this.m,i=t.m;return r[0]===i[0]&&r[1]===i[1]&&r[2]===i[2]&&r[3]===i[3]&&r[4]===i[4]&&r[5]===i[5]&&r[6]===i[6]&&r[7]===i[7]&&r[8]===i[8]&&r[9]===i[9]&&r[10]===i[10]&&r[11]===i[11]&&r[12]===i[12]&&r[13]===i[13]&&r[14]===i[14]&&r[15]===i[15]},e.prototype.clone=function(){var t=new e;return t.copyFrom(this),t},e.prototype.getClassName=function(){return"Matrix"},e.prototype.getHashCode=function(){for(var e=0|this._m[0],t=1;t<16;t++)e=397*e^(0|this._m[t]);return e},e.prototype.decompose=function(t,r,i){if(this._isIdentity)return i&&i.setAll(0),t&&t.setAll(1),r&&r.copyFromFloats(0,0,0,1),!0;var n=this._m;if(i&&i.copyFromFloats(n[12],n[13],n[14]),(t=t||g.Vector3[0]).x=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),t.y=Math.sqrt(n[4]*n[4]+n[5]*n[5]+n[6]*n[6]),t.z=Math.sqrt(n[8]*n[8]+n[9]*n[9]+n[10]*n[10]),this.determinant()<=0&&(t.y*=-1),0===t.x||0===t.y||0===t.z)return r&&r.copyFromFloats(0,0,0,1),!1;if(r){var s=1/t.x,o=1/t.y,a=1/t.z;e.FromValuesToRef(n[0]*s,n[1]*s,n[2]*s,0,n[4]*o,n[5]*o,n[6]*o,0,n[8]*a,n[9]*a,n[10]*a,0,0,0,0,1,g.Matrix[0]),E.FromRotationMatrixToRef(g.Matrix[0],r)}return!0},e.prototype.getRow=function(e){if(e<0||e>3)return null;var t=4*e;return new d(this._m[t+0],this._m[t+1],this._m[t+2],this._m[t+3])},e.prototype.setRow=function(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)},e.prototype.transpose=function(){return e.Transpose(this)},e.prototype.transposeToRef=function(t){return e.TransposeToRef(this,t),this},e.prototype.setRowFromFloats=function(e,t,r,i,n){if(e<0||e>3)return this;var s=4*e;return this._m[s+0]=t,this._m[s+1]=r,this._m[s+2]=i,this._m[s+3]=n,this._markAsUpdated(),this},e.prototype.scale=function(t){var r=new e;return this.scaleToRef(t,r),r},e.prototype.scaleToRef=function(e,t){for(var r=0;r<16;r++)t._m[r]=this._m[r]*e;return t._markAsUpdated(),this},e.prototype.scaleAndAddToRef=function(e,t){for(var r=0;r<16;r++)t._m[r]+=this._m[r]*e;return t._markAsUpdated(),this},e.prototype.toNormalMatrix=function(t){var r=g.Matrix[0];this.invertToRef(r),r.transposeToRef(t);var i=t._m;e.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,t)},e.prototype.getRotationMatrix=function(){var t=new e;return this.getRotationMatrixToRef(t),t},e.prototype.getRotationMatrixToRef=function(t){var r=g.Vector3[0];if(!this.decompose(r))return e.IdentityToRef(t),this;var i=this._m,n=1/r.x,s=1/r.y,o=1/r.z;return e.FromValuesToRef(i[0]*n,i[1]*n,i[2]*n,0,i[4]*s,i[5]*s,i[6]*s,0,i[8]*o,i[9]*o,i[10]*o,0,0,0,0,1,t),this},e.prototype.toggleModelMatrixHandInPlace=function(){var e=this._m;e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this._markAsUpdated()},e.prototype.toggleProjectionMatrixHandInPlace=function(){var e=this._m;e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this._markAsUpdated()},e.FromArray=function(t,r){void 0===r&&(r=0);var i=new e;return e.FromArrayToRef(t,r,i),i},e.FromArrayToRef=function(e,t,r){for(var i=0;i<16;i++)r._m[i]=e[i+t];r._markAsUpdated()},e.FromFloat32ArrayToRefScaled=function(e,t,r,i){for(var n=0;n<16;n++)i._m[n]=e[n+t]*r;i._markAsUpdated()},Object.defineProperty(e,"IdentityReadOnly",{get:function(){return e._identityReadOnly},enumerable:!0,configurable:!0}),e.FromValuesToRef=function(e,t,r,i,n,s,o,a,u,h,l,_,c,f,p,d,E){var T=E._m;T[0]=e,T[1]=t,T[2]=r,T[3]=i,T[4]=n,T[5]=s,T[6]=o,T[7]=a,T[8]=u,T[9]=h,T[10]=l,T[11]=_,T[12]=c,T[13]=f,T[14]=p,T[15]=d,E._markAsUpdated()},e.FromValues=function(t,r,i,n,s,o,a,u,h,l,_,c,f,p,d,E){var T=new e,g=T._m;return g[0]=t,g[1]=r,g[2]=i,g[3]=n,g[4]=s,g[5]=o,g[6]=a,g[7]=u,g[8]=h,g[9]=l,g[10]=_,g[11]=c,g[12]=f,g[13]=p,g[14]=d,g[15]=E,T._markAsUpdated(),T},e.Compose=function(t,r,i){var n=new e;return e.ComposeToRef(t,r,i,n),n},e.ComposeToRef=function(e,t,r,i){var n=i._m,s=t.x,o=t.y,a=t.z,u=t.w,h=s+s,l=o+o,_=a+a,c=s*h,f=s*l,p=s*_,d=o*l,E=o*_,T=a*_,g=u*h,R=u*l,y=u*_,m=e.x,A=e.y,b=e.z;n[0]=(1-(d+T))*m,n[1]=(f+y)*m,n[2]=(p-R)*m,n[3]=0,n[4]=(f-y)*A,n[5]=(1-(c+T))*A,n[6]=(E+g)*A,n[7]=0,n[8]=(p+R)*b,n[9]=(E-g)*b,n[10]=(1-(c+d))*b,n[11]=0,n[12]=r.x,n[13]=r.y,n[14]=r.z,n[15]=1,i._markAsUpdated()},e.Identity=function(){var t=e.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return t._updateIdentityStatus(!0),t},e.IdentityToRef=function(t){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(!0)},e.Zero=function(){var t=e.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return t._updateIdentityStatus(!1),t},e.RotationX=function(t){var r=new e;return e.RotationXToRef(t,r),r},e.Invert=function(t){var r=new e;return t.invertToRef(r),r},e.RotationXToRef=function(t,r){var i=Math.sin(t),n=Math.cos(t);e.FromValuesToRef(1,0,0,0,0,n,i,0,0,-i,n,0,0,0,0,1,r),r._updateIdentityStatus(1===n&&0===i)},e.RotationY=function(t){var r=new e;return e.RotationYToRef(t,r),r},e.RotationYToRef=function(t,r){var i=Math.sin(t),n=Math.cos(t);e.FromValuesToRef(n,0,-i,0,0,1,0,0,i,0,n,0,0,0,0,1,r),r._updateIdentityStatus(1===n&&0===i)},e.RotationZ=function(t){var r=new e;return e.RotationZToRef(t,r),r},e.RotationZToRef=function(t,r){var i=Math.sin(t),n=Math.cos(t);e.FromValuesToRef(n,i,0,0,-i,n,0,0,0,0,1,0,0,0,0,1,r),r._updateIdentityStatus(1===n&&0===i)},e.RotationAxis=function(t,r){var i=new e;return e.RotationAxisToRef(t,r,i),i},e.RotationAxisToRef=function(e,t,r){var i=Math.sin(-t),n=Math.cos(-t),s=1-n;e.normalize();var o=r._m;o[0]=e.x*e.x*s+n,o[1]=e.x*e.y*s-e.z*i,o[2]=e.x*e.z*s+e.y*i,o[3]=0,o[4]=e.y*e.x*s+e.z*i,o[5]=e.y*e.y*s+n,o[6]=e.y*e.z*s-e.x*i,o[7]=0,o[8]=e.z*e.x*s-e.y*i,o[9]=e.z*e.y*s+e.x*i,o[10]=e.z*e.z*s+n,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,r._markAsUpdated()},e.RotationAlignToRef=function(e,t,r){var i=p.Cross(t,e),n=p.Dot(t,e),s=1/(1+n),o=r._m;o[0]=i.x*i.x*s+n,o[1]=i.y*i.x*s-i.z,o[2]=i.z*i.x*s+i.y,o[3]=0,o[4]=i.x*i.y*s+i.z,o[5]=i.y*i.y*s+n,o[6]=i.z*i.y*s-i.x,o[7]=0,o[8]=i.x*i.z*s-i.y,o[9]=i.y*i.z*s+i.x,o[10]=i.z*i.z*s+n,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,r._markAsUpdated()},e.RotationYawPitchRoll=function(t,r,i){var n=new e;return e.RotationYawPitchRollToRef(t,r,i,n),n},e.RotationYawPitchRollToRef=function(e,t,r,i){E.RotationYawPitchRollToRef(e,t,r,g.Quaternion[0]),g.Quaternion[0].toRotationMatrix(i)},e.Scaling=function(t,r,i){var n=new e;return e.ScalingToRef(t,r,i,n),n},e.ScalingToRef=function(t,r,i,n){e.FromValuesToRef(t,0,0,0,0,r,0,0,0,0,i,0,0,0,0,1,n),n._updateIdentityStatus(1===t&&1===r&&1===i)},e.Translation=function(t,r,i){var n=new e;return e.TranslationToRef(t,r,i,n),n},e.TranslationToRef=function(t,r,i,n){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,r,i,1,n),n._updateIdentityStatus(0===t&&0===r&&0===i)},e.Lerp=function(t,r,i){var n=new e;return e.LerpToRef(t,r,i,n),n},e.LerpToRef=function(e,t,r,i){for(var n=i._m,s=e.m,o=t.m,a=0;a<16;a++)n[a]=s[a]*(1-r)+o[a]*r;i._markAsUpdated()},e.DecomposeLerp=function(t,r,i){var n=new e;return e.DecomposeLerpToRef(t,r,i,n),n},e.DecomposeLerpToRef=function(t,r,i,n){var s=g.Vector3[0],o=g.Quaternion[0],a=g.Vector3[1];t.decompose(s,o,a);var u=g.Vector3[2],h=g.Quaternion[1],l=g.Vector3[3];r.decompose(u,h,l);var _=g.Vector3[4];p.LerpToRef(s,u,i,_);var c=g.Quaternion[2];E.SlerpToRef(o,h,i,c);var f=g.Vector3[5];p.LerpToRef(a,l,i,f),e.ComposeToRef(_,c,f,n)},e.LookAtLH=function(t,r,i){var n=new e;return e.LookAtLHToRef(t,r,i,n),n},e.LookAtLHToRef=function(t,r,i,n){var s=g.Vector3[0],o=g.Vector3[1],a=g.Vector3[2];r.subtractToRef(t,a),a.normalize(),p.CrossToRef(i,a,s);var u=s.lengthSquared();0===u?s.x=1:s.normalizeFromLength(Math.sqrt(u)),p.CrossToRef(a,s,o),o.normalize();var h=-p.Dot(s,t),l=-p.Dot(o,t),_=-p.Dot(a,t);e.FromValuesToRef(s.x,o.x,a.x,0,s.y,o.y,a.y,0,s.z,o.z,a.z,0,h,l,_,1,n)},e.LookAtRH=function(t,r,i){var n=new e;return e.LookAtRHToRef(t,r,i,n),n},e.LookAtRHToRef=function(t,r,i,n){var s=g.Vector3[0],o=g.Vector3[1],a=g.Vector3[2];t.subtractToRef(r,a),a.normalize(),p.CrossToRef(i,a,s);var u=s.lengthSquared();0===u?s.x=1:s.normalizeFromLength(Math.sqrt(u)),p.CrossToRef(a,s,o),o.normalize();var h=-p.Dot(s,t),l=-p.Dot(o,t),_=-p.Dot(a,t);e.FromValuesToRef(s.x,o.x,a.x,0,s.y,o.y,a.y,0,s.z,o.z,a.z,0,h,l,_,1,n)},e.OrthoLH=function(t,r,i,n){var s=new e;return e.OrthoLHToRef(t,r,i,n,s),s},e.OrthoLHToRef=function(t,r,i,n,s){var o=2/t,a=2/r,u=2/(n-i),h=-(n+i)/(n-i);e.FromValuesToRef(o,0,0,0,0,a,0,0,0,0,u,0,0,0,h,1,s),s._updateIdentityStatus(1===o&&1===a&&1===u&&0===h)},e.OrthoOffCenterLH=function(t,r,i,n,s,o){var a=new e;return e.OrthoOffCenterLHToRef(t,r,i,n,s,o,a),a},e.OrthoOffCenterLHToRef=function(t,r,i,n,s,o,a){var u=2/(r-t),h=2/(n-i),l=2/(o-s),_=-(o+s)/(o-s),c=(t+r)/(t-r),f=(n+i)/(i-n);e.FromValuesToRef(u,0,0,0,0,h,0,0,0,0,l,0,c,f,_,1,a),a._markAsUpdated()},e.OrthoOffCenterRH=function(t,r,i,n,s,o){var a=new e;return e.OrthoOffCenterRHToRef(t,r,i,n,s,o,a),a},e.OrthoOffCenterRHToRef=function(t,r,i,n,s,o,a){e.OrthoOffCenterLHToRef(t,r,i,n,s,o,a),a._m[10]*=-1},e.PerspectiveLH=function(t,r,i,n){var s=new e,o=2*i/t,a=2*i/r,u=(n+i)/(n-i),h=-2*n*i/(n-i);return e.FromValuesToRef(o,0,0,0,0,a,0,0,0,0,u,1,0,0,h,0,s),s._updateIdentityStatus(!1),s},e.PerspectiveFovLH=function(t,r,i,n){var s=new e;return e.PerspectiveFovLHToRef(t,r,i,n,s),s},e.PerspectiveFovLHToRef=function(t,r,i,n,s,o){void 0===o&&(o=!0);var a=i,u=n,h=1/Math.tan(.5*t),l=o?h/r:h,_=o?h:h*r,c=(u+a)/(u-a),f=-2*u*a/(u-a);e.FromValuesToRef(l,0,0,0,0,_,0,0,0,0,c,1,0,0,f,0,s),s._updateIdentityStatus(!1)},e.PerspectiveFovRH=function(t,r,i,n){var s=new e;return e.PerspectiveFovRHToRef(t,r,i,n,s),s},e.PerspectiveFovRHToRef=function(t,r,i,n,s,o){void 0===o&&(o=!0);var a=i,u=n,h=1/Math.tan(.5*t),l=o?h/r:h,_=o?h:h*r,c=-(u+a)/(u-a),f=-2*u*a/(u-a);e.FromValuesToRef(l,0,0,0,0,_,0,0,0,0,c,-1,0,0,f,0,s),s._updateIdentityStatus(!1)},e.PerspectiveFovWebVRToRef=function(e,t,r,i,n){void 0===n&&(n=!1);var s=n?-1:1,o=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),u=Math.tan(e.leftDegrees*Math.PI/180),h=Math.tan(e.rightDegrees*Math.PI/180),l=2/(u+h),_=2/(o+a),c=i._m;c[0]=l,c[1]=c[2]=c[3]=c[4]=0,c[5]=_,c[6]=c[7]=0,c[8]=(u-h)*l*.5,c[9]=-(o-a)*_*.5,c[10]=-r/(t-r),c[11]=1*s,c[12]=c[13]=c[15]=0,c[14]=-2*r*t/(r-t),i._markAsUpdated()},e.GetFinalMatrix=function(t,r,i,n,s,o){var a=t.width,u=t.height,h=t.x,l=t.y,_=e.FromValues(a/2,0,0,0,0,-u/2,0,0,0,0,o-s,0,h+a/2,u/2+l,s,1),c=g.Matrix[0];return r.multiplyToRef(i,c),c.multiplyToRef(n,c),c.multiply(_)},e.GetAsMatrix2x2=function(e){var t=e.m;return new Float32Array([t[0],t[1],t[4],t[5]])},e.GetAsMatrix3x3=function(e){var t=e.m;return new Float32Array([t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]])},e.Transpose=function(t){var r=new e;return e.TransposeToRef(t,r),r},e.TransposeToRef=function(e,t){var r=t._m,i=e.m;r[0]=i[0],r[1]=i[4],r[2]=i[8],r[3]=i[12],r[4]=i[1],r[5]=i[5],r[6]=i[9],r[7]=i[13],r[8]=i[2],r[9]=i[6],r[10]=i[10],r[11]=i[14],r[12]=i[3],r[13]=i[7],r[14]=i[11],r[15]=i[15],t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty)},e.Reflection=function(t){var r=new e;return e.ReflectionToRef(t,r),r},e.ReflectionToRef=function(t,r){t.normalize();var i=t.normal.x,n=t.normal.y,s=t.normal.z,o=-2*i,a=-2*n,u=-2*s;e.FromValuesToRef(o*i+1,a*i,u*i,0,o*n,a*n+1,u*n,0,o*s,a*s,u*s+1,0,o*t.d,a*t.d,u*t.d,1,r)},e.FromXYZAxesToRef=function(t,r,i,n){e.FromValuesToRef(t.x,t.y,t.z,0,r.x,r.y,r.z,0,i.x,i.y,i.z,0,0,0,0,1,n)},e.FromQuaternionToRef=function(e,t){var r=e.x*e.x,i=e.y*e.y,n=e.z*e.z,s=e.x*e.y,o=e.z*e.w,a=e.z*e.x,u=e.y*e.w,h=e.y*e.z,l=e.x*e.w;t._m[0]=1-2*(i+n),t._m[1]=2*(s+o),t._m[2]=2*(a-u),t._m[3]=0,t._m[4]=2*(s-o),t._m[5]=1-2*(n+r),t._m[6]=2*(h+l),t._m[7]=0,t._m[8]=2*(a+u),t._m[9]=2*(h-l),t._m[10]=1-2*(i+r),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t._markAsUpdated()},e._updateFlagSeed=0,e._identityReadOnly=e.Identity(),e}(),g=function(){function e(){}return e.Vector3=_.BuildArray(6,p.Zero),e.Matrix=_.BuildArray(2,T.Identity),e.Quaternion=_.BuildArray(3,E.Zero),e}();!function(){function e(){}e.Vector2=_.BuildArray(3,f.Zero),e.Vector3=_.BuildArray(13,p.Zero),e.Vector4=_.BuildArray(3,d.Zero),e.Quaternion=_.BuildArray(2,E.Zero),e.Matrix=_.BuildArray(8,T.Identity)}();c.RegisteredTypes["BABYLON.Vector2"]=f,c.RegisteredTypes["BABYLON.Vector3"]=p,c.RegisteredTypes["BABYLON.Vector4"]=d,c.RegisteredTypes["BABYLON.Matrix"]=T;var R=function(){function e(){}return e.WarnImport=function(e){return e+" needs to be imported before as it contains a side-effect required by your code."},e}(),y=function(){function e(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),this.r=e,this.g=t,this.b=r}return e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},e.prototype.getClassName=function(){return"Color3"},e.prototype.getHashCode=function(){var e=255*this.r|0;return e=397*(e=397*e^(255*this.g|0))^(255*this.b|0)},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this},e.prototype.toColor4=function(e){return void 0===e&&(e=1),new m(this.r,this.g,this.b,e)},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},e.prototype.multiply=function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b)},e.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},e.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},e.prototype.equalsFloats=function(e,t,r){return this.r===e&&this.g===t&&this.b===r},e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t)},e.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,this},e.prototype.clampToRef=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=1),r.r=l.Clamp(this.r,e,t),r.g=l.Clamp(this.g,e,t),r.b=l.Clamp(this.b,e,t),this},e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b)},e.prototype.addToRef=function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b)},e.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},e.prototype.clone=function(){return new e(this.r,this.g,this.b)},e.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},e.prototype.copyFromFloats=function(e,t,r){return this.r=e,this.g=t,this.b=r,this},e.prototype.set=function(e,t,r){return this.copyFromFloats(e,t,r)},e.prototype.toHexString=function(){var e=255*this.r|0,t=255*this.g|0,r=255*this.b|0;return"#"+l.ToHex(e)+l.ToHex(t)+l.ToHex(r)},e.prototype.toLinearSpace=function(){var t=new e;return this.toLinearSpaceToRef(t),t},e.prototype.toHSV=function(){var t=new e;return this.toHSVToRef(t),t},e.prototype.toHSVToRef=function(e){var t=this.r,r=this.g,i=this.b,n=Math.max(t,r,i),s=Math.min(t,r,i),o=0,a=0,u=n,h=n-s;0!==n&&(a=h/n),n!=s&&(n==t?(o=(r-i)/h,r<i&&(o+=6)):n==r?o=(i-t)/h+2:n==i&&(o=(t-r)/h+4),o*=60),e.r=o,e.g=a,e.b=u},e.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,2.2),e.g=Math.pow(this.g,2.2),e.b=Math.pow(this.b,2.2),this},e.prototype.toGammaSpace=function(){var t=new e;return this.toGammaSpaceToRef(t),t},e.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,1/2.2),e.g=Math.pow(this.g,1/2.2),e.b=Math.pow(this.b,1/2.2),this},e.HSVtoRGBToRef=function(e,t,r,i){var n=r*t,s=e/60,o=n*(1-Math.abs(s%2-1)),a=0,u=0,h=0;s>=0&&s<=1?(a=n,u=o):s>=1&&s<=2?(a=o,u=n):s>=2&&s<=3?(u=n,h=o):s>=3&&s<=4?(u=o,h=n):s>=4&&s<=5?(a=o,h=n):s>=5&&s<=6&&(a=n,h=o);var l=r-n;i.set(a+l,u+l,h+l)},e.FromHexString=function(t){if("#"!==t.substring(0,1)||7!==t.length)return new e(0,0,0);var r=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),n=parseInt(t.substring(5,7),16);return e.FromInts(r,i,n)},e.FromArray=function(t,r){return void 0===r&&(r=0),new e(t[r],t[r+1],t[r+2])},e.FromInts=function(t,r,i){return new e(t/255,r/255,i/255)},e.Lerp=function(t,r,i){var n=new e(0,0,0);return e.LerpToRef(t,r,i,n),n},e.LerpToRef=function(e,t,r,i){i.r=e.r+(t.r-e.r)*r,i.g=e.g+(t.g-e.g)*r,i.b=e.b+(t.b-e.b)*r},e.Red=function(){return new e(1,0,0)},e.Green=function(){return new e(0,1,0)},e.Blue=function(){return new e(0,0,1)},e.Black=function(){return new e(0,0,0)},Object.defineProperty(e,"BlackReadOnly",{get:function(){return e._BlackReadOnly},enumerable:!0,configurable:!0}),e.White=function(){return new e(1,1,1)},e.Purple=function(){return new e(.5,0,.5)},e.Magenta=function(){return new e(1,0,1)},e.Yellow=function(){return new e(1,1,0)},e.Gray=function(){return new e(.5,.5,.5)},e.Teal=function(){return new e(0,1,1)},e.Random=function(){return new e(Math.random(),Math.random(),Math.random())},e._BlackReadOnly=e.Black(),e}(),m=function(){function e(e,t,r,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=1),this.r=e,this.g=t,this.b=r,this.a=i}return e.prototype.addInPlace=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this},e.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a},e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)},e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)},e.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)},e.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,this},e.prototype.clampToRef=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=1),r.r=l.Clamp(this.r,e,t),r.g=l.Clamp(this.g,e,t),r.b=l.Clamp(this.b,e,t),r.a=l.Clamp(this.a,e,t),this},e.prototype.multiply=function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)},e.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t},e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},e.prototype.getClassName=function(){return"Color4"},e.prototype.getHashCode=function(){var e=255*this.r|0;return e=397*(e=397*(e=397*e^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.a)},e.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},e.prototype.copyFromFloats=function(e,t,r,i){return this.r=e,this.g=t,this.b=r,this.a=i,this},e.prototype.set=function(e,t,r,i){return this.copyFromFloats(e,t,r,i)},e.prototype.toHexString=function(){var e=255*this.r|0,t=255*this.g|0,r=255*this.b|0,i=255*this.a|0;return"#"+l.ToHex(e)+l.ToHex(t)+l.ToHex(r)+l.ToHex(i)},e.prototype.toLinearSpace=function(){var t=new e;return this.toLinearSpaceToRef(t),t},e.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,2.2),e.g=Math.pow(this.g,2.2),e.b=Math.pow(this.b,2.2),e.a=this.a,this},e.prototype.toGammaSpace=function(){var t=new e;return this.toGammaSpaceToRef(t),t},e.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,1/2.2),e.g=Math.pow(this.g,1/2.2),e.b=Math.pow(this.b,1/2.2),e.a=this.a,this},e.FromHexString=function(t){if("#"!==t.substring(0,1)||9!==t.length)return new e(0,0,0,0);var r=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),n=parseInt(t.substring(5,7),16),s=parseInt(t.substring(7,9),16);return e.FromInts(r,i,n,s)},e.Lerp=function(t,r,i){var n=new e(0,0,0,0);return e.LerpToRef(t,r,i,n),n},e.LerpToRef=function(e,t,r,i){i.r=e.r+(t.r-e.r)*r,i.g=e.g+(t.g-e.g)*r,i.b=e.b+(t.b-e.b)*r,i.a=e.a+(t.a-e.a)*r},e.FromColor3=function(t,r){return void 0===r&&(r=1),new e(t.r,t.g,t.b,r)},e.FromArray=function(t,r){return void 0===r&&(r=0),new e(t[r],t[r+1],t[r+2],t[r+3])},e.FromInts=function(t,r,i,n){return new e(t/255,r/255,i/255,n/255)},e.CheckColors4=function(e,t){if(e.length===3*t){for(var r=[],i=0;i<e.length;i+=3){var n=i/3*4;r[n]=e[i],r[n+1]=e[i+1],r[n+2]=e[i+2],r[n+3]=1}return r}return e},e}();!function(){function e(){}e.Color3=_.BuildArray(3,y.Black),e.Color4=_.BuildArray(3,function(){return new m(0,0,0,0)})}();c.RegisteredTypes["BABYLON.Color3"]=y,c.RegisteredTypes["BABYLON.Color4"]=m;var A={},b={},x=function(e,t,r){var i=e();h&&h.AddTagsTo(i,t.tags);var n=v(i);for(var s in n){var o=n[s],a=t[s],u=o.type;if(null!=a&&"uniqueId"!==s)switch(u){case 0:case 6:case 11:i[s]=a;break;case 1:i[s]=r||a.isRenderTarget?a:a.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:i[s]=r?a:a.clone()}}return i};function v(e){var t=e.getClassName();if(b[t])return b[t];b[t]={};for(var r=b[t],i=e,n=t;n;){var s=A[n];for(var o in s)r[o]=s[o];var a=void 0,u=!1;do{if(!(a=Object.getPrototypeOf(i)).getClassName){u=!0;break}if(a.getClassName()!==n)break;i=a}while(a);if(u)break;n=a.getClassName(),i=a}return r}function S(e,t){return function(r,i){var n=function(e){var t=e.getClassName();return A[t]||(A[t]={}),A[t]}(r);n[i]||(n[i]={type:e,sourceName:t})}}function O(e,t){return void 0===t&&(t=null),function(e,t){return void 0===t&&(t=null),function(r,i){var n=t||"_"+i;Object.defineProperty(r,i,{get:function(){return this[n]},set:function(t){this[n]!==t&&(this[n]=t,r[e].apply(this))},enumerable:!0,configurable:!0})}}(e,t)}function I(e){return S(0,e)}var F,M=function(){function e(){}return e.AppendSerializedAnimations=function(e,t){if(e.animations){t.animations=[];for(var r=0;r<e.animations.length;r++){var i=e.animations[r];t.animations.push(i.serialize())}}},e.Serialize=function(e,t){t||(t={}),h&&(t.tags=h.GetTags(e));var r=v(e);for(var i in r){var n=r[i],s=n.sourceName||i,o=n.type,a=e[i];if(null!=a)switch(o){case 0:t[s]=a;break;case 1:t[s]=a.serialize();break;case 2:t[s]=a.asArray();break;case 3:t[s]=a.serialize();break;case 4:case 5:t[s]=a.asArray();break;case 6:t[s]=a.id;break;case 7:t[s]=a.serialize();break;case 8:t[s]=a.asArray();break;case 9:t[s]=a.serialize();break;case 10:t[s]=a.asArray();break;case 11:t[s]=a.id;case 12:t[s]=a.asArray()}}return t},e.Parse=function(t,r,i,n){void 0===n&&(n=null);var s=t();n||(n=""),h&&h.AddTagsTo(s,r.tags);var o=v(s);for(var a in o){var u=o[a],l=r[u.sourceName||a],_=u.type;if(null!=l){var c=s;switch(_){case 0:c[a]=l;break;case 1:i&&(c[a]=e._TextureParser(l,i,n));break;case 2:c[a]=y.FromArray(l);break;case 3:c[a]=e._FresnelParametersParser(l);break;case 4:c[a]=f.FromArray(l);break;case 5:c[a]=p.FromArray(l);break;case 6:i&&(c[a]=i.getLastMeshByID(l));break;case 7:c[a]=e._ColorCurvesParser(l);break;case 8:c[a]=m.FromArray(l);break;case 9:c[a]=e._ImageProcessingConfigurationParser(l);break;case 10:c[a]=E.FromArray(l);break;case 11:i&&(c[a]=i.getCameraByID(l));case 12:c[a]=T.FromArray(l)}}}return s},e.Clone=function(e,t){return x(e,t,!1)},e.Instanciate=function(e,t){return x(e,t,!0)},e._ImageProcessingConfigurationParser=function(e){throw R.WarnImport("ImageProcessingConfiguration")},e._FresnelParametersParser=function(e){throw R.WarnImport("FresnelParameters")},e._ColorCurvesParser=function(e){throw R.WarnImport("ColorCurves")},e._TextureParser=function(e,t,r){throw R.WarnImport("Texture")},e}(),P=function(){function e(e,t,r,i){void 0===t&&(t=!1),this.initalize(e,t,r,i)}return e.prototype.initalize=function(e,t,r,i){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=r,this.currentTarget=i,this},e}(),L=function(e,t,r){void 0===r&&(r=null),this.callback=e,this.mask=t,this.scope=r,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},N=(function(){function e(){}e.prototype.dispose=function(){if(this._observers&&this._observables)for(var e=0;e<this._observers.length;e++)this._observables[e].remove(this._observers[e]);this._observers=null,this._observables=null},e.Watch=function(t,r,i,n){void 0===i&&(i=-1),void 0===n&&(n=null);var s=new e;s._observers=new Array,s._observables=t;for(var o=0,a=t;o<a.length;o++){var u=a[o].add(r,i,!1,n);u&&s._observers.push(u)}return s}}(),function(){function e(e){this._observers=new Array,this._eventState=new P(0),e&&(this._onObserverAdded=e)}return Object.defineProperty(e.prototype,"observers",{get:function(){return this._observers},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t,r,i,n){if(void 0===t&&(t=-1),void 0===r&&(r=!1),void 0===i&&(i=null),void 0===n&&(n=!1),!e)return null;var s=new L(e,t,i);return s.unregisterOnNextCall=n,r?this._observers.unshift(s):this._observers.push(s),this._onObserverAdded&&this._onObserverAdded(s),s},e.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},e.prototype.remove=function(e){return!!e&&(-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0))},e.prototype.removeCallback=function(e,t){for(var r=0;r<this._observers.length;r++){var i=this._observers[r];if(!i._willBeUnregistered&&(i.callback===e&&(!t||t===i.scope)))return this._deferUnregister(i),!0}return!1},e.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(function(){t._remove(e)},0)},e.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},e.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},e.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},e.prototype.notifyObservers=function(e,t,r,i){if(void 0===t&&(t=-1),!this._observers.length)return!0;var n=this._eventState;n.mask=t,n.target=r,n.currentTarget=i,n.skipNextObservers=!1,n.lastReturnValue=e;for(var s=0,o=this._observers;s<o.length;s++){var a=o[s];if(!a._willBeUnregistered&&(a.mask&t&&(a.scope?n.lastReturnValue=a.callback.apply(a.scope,[e,n]):n.lastReturnValue=a.callback(e,n),a.unregisterOnNextCall&&this._deferUnregister(a)),n.skipNextObservers))return!1}return!0},e.prototype.notifyObserversWithPromise=function(e,t,r,i){var n=this;void 0===t&&(t=-1);var s=Promise.resolve(e);if(!this._observers.length)return s;var o=this._eventState;return o.mask=t,o.target=r,o.currentTarget=i,o.skipNextObservers=!1,this._observers.forEach(function(r){o.skipNextObservers||r._willBeUnregistered||r.mask&t&&(s=r.scope?s.then(function(t){return o.lastReturnValue=t,r.callback.apply(r.scope,[e,o])}):s.then(function(t){return o.lastReturnValue=t,r.callback(e,o)}),r.unregisterOnNextCall&&n._deferUnregister(r))}),s.then(function(){return e})},e.prototype.notifyObserver=function(e,t,r){void 0===r&&(r=-1);var i=this._eventState;i.mask=r,i.skipNextObservers=!1,e.callback(t,i)},e.prototype.hasObservers=function(){return this._observers.length>0},e.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},e.prototype.clone=function(){var t=new e;return t._observers=this._observers.slice(0),t},e.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var t=0,r=this._observers;t<r.length;t++){var i=r[t];if(i.mask&e||i.mask===e)return!0}return!1},e}()),U=function(){function e(){}return Object.defineProperty(e,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!0,configurable:!0}),e.Instances=new Array,e._LastCreatedScene=null,e.UseFallbackTexture=!0,e.FallbackTexture="",e}(),C=function(){function e(){}return e.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e}(),D=function(){function e(e,t){this.width=e,this.height=t}return e.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},e.prototype.getClassName=function(){return"Size"},e.prototype.getHashCode=function(){var e=0|this.width;return e=397*e^(0|this.height)},e.prototype.copyFrom=function(e){this.width=e.width,this.height=e.height},e.prototype.copyFromFloats=function(e,t){return this.width=e,this.height=t,this},e.prototype.set=function(e,t){return this.copyFromFloats(e,t)},e.prototype.multiplyByFloats=function(t,r){return new e(this.width*t,this.height*r)},e.prototype.clone=function(){return new e(this.width,this.height)},e.prototype.equals=function(e){return!!e&&(this.width===e.width&&this.height===e.height)},Object.defineProperty(e.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),e.Zero=function(){return new e(0,0)},e.prototype.add=function(t){return new e(this.width+t.width,this.height+t.height)},e.prototype.subtract=function(t){return new e(this.width-t.width,this.height-t.height)},e.Lerp=function(t,r,i){return new e(t.width+(r.width-t.width)*i,t.height+(r.height-t.height)*i)},e}(),w=function(){function e(t){this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this._coordinatesMode=i.TEXTURE_EXPLICIT_MODE,this.wrapU=i.TEXTURE_WRAP_ADDRESSMODE,this.wrapV=i.TEXTURE_WRAP_ADDRESSMODE,this.wrapR=i.TEXTURE_WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this.gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this.animations=new Array,this.onDisposeObservable=new N,this._onDisposeObserver=null,this.delayLoadState=i.DELAYLOADSTATE_NONE,this._scene=null,this._texture=null,this._uid=null,this._cachedSize=D.Zero(),this._scene=t||U.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this)),this._uid=null}var t;return Object.defineProperty(e.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(i.MATERIAL_TextureDirtyFlag|i.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(i.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(e){this._texture&&(this._texture.isCube=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},set:function(e){this._texture&&(this._texture._isRGBD=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"noMipmap",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(e){this._texture&&(this._texture._lodGenerationOffset=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(e){this._texture&&(this._texture._lodGenerationScale=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(e){this._texture&&(this._texture._linearSpecularLOD=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(e){this._texture&&(this._texture._irradianceTexture=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid||(this._uid=C.RandomId()),this._uid},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this.name},e.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBlocking",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getTextureMatrix=function(){return T.IdentityReadOnly},e.prototype.getReflectionTextureMatrix=function(){return T.IdentityReadOnly},e.prototype.getInternalTexture=function(){return this._texture},e.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},e.prototype.isReady=function(){return this.delayLoadState===i.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},e.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},e.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?new D(this._texture._size,this._texture._size):new D(this._texture.baseWidth,this._texture.baseHeight):D.Zero()},e.prototype.updateSamplingMode=function(e){if(this._texture){var t=this.getScene();t&&t.getEngine().updateTextureSamplingMode(e,this._texture)}},e.prototype.scale=function(e){},Object.defineProperty(e.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype._getFromCache=function(e,t,r,i){if(!this._scene)return null;for(var n=this._scene.getEngine().getLoadedTexturesCache(),s=0;s<n.length;s++){var o=n[s];if(!(void 0!==i&&i!==o.invertY||o.url!==e||o.generateMipMaps!==!t||r&&r!==o.samplingMode))return o.incrementReferences(),o}return null},e.prototype._rebuild=function(){},e.prototype.delayLoad=function(){},e.prototype.clone=function(){return null},Object.defineProperty(e.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:i.TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:i.TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),e.prototype._markAllSubMeshesAsTexturesDirty=function(){var e=this.getScene();e&&e.markAllMaterialsAsDirty(i.MATERIAL_TextureDirtyFlag)},e.prototype.readPixels=function(e,t,r){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=null),!this._texture)return null;var i=this.getSize(),n=i.width,s=i.height,o=this.getScene();if(!o)return null;var a=o.getEngine();return 0!=t&&(n/=Math.pow(2,t),s/=Math.pow(2,t),n=Math.round(n),s=Math.round(s)),this._texture.isCube?a._readTexturePixels(this._texture,n,s,e,t,r):a._readTexturePixels(this._texture,n,s,-1,t,r)},e.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Object.defineProperty(e.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var e=this._scene.textures.indexOf(this);e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())}},e.prototype.serialize=function(){if(!this.name)return null;var e=M.Serialize(this);return M.AppendSerializedAnimations(this,e),e},e.WhenAllReady=function(e,t){var r=e.length;if(0!==r)for(var i,n,s=function(){if((i=e[o]).isReady())0==--r&&t();else{n=i.onLoadObservable;var s=function(){n.removeCallback(s),0==--r&&t()};n.add(s)}},o=0;o<e.length;o++)s();else t()},e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,a([I()],e.prototype,"uniqueId",void 0),a([I()],e.prototype,"name",void 0),a([I()],e.prototype,"metadata",void 0),a([I("hasAlpha")],e.prototype,"_hasAlpha",void 0),a([I()],e.prototype,"getAlphaFromRGB",void 0),a([I()],e.prototype,"level",void 0),a([I()],e.prototype,"coordinatesIndex",void 0),a([I("coordinatesMode")],e.prototype,"_coordinatesMode",void 0),a([I()],e.prototype,"wrapU",void 0),a([I()],e.prototype,"wrapV",void 0),a([I()],e.prototype,"wrapR",void 0),a([I()],e.prototype,"anisotropicFilteringLevel",void 0),a([I()],e.prototype,"isCube",null),a([I()],e.prototype,"is3D",null),a([I(),O("_markAllSubMeshesAsTexturesDirty")],e.prototype,"gammaSpace",void 0),a([I()],e.prototype,"invertZ",void 0),a([I()],e.prototype,"lodLevelInAlpha",void 0),a([I()],e.prototype,"lodGenerationOffset",null),a([I()],e.prototype,"lodGenerationScale",null),a([I()],e.prototype,"linearSpecularLOD",null),a([S(1,t)],e.prototype,"irradianceTexture",null),a([I()],e.prototype,"isRenderTarget",void 0),e}(),B=function(){function e(){}return e.IsWindowObjectExist=function(){return"undefined"!=typeof window},e.IsNavigatorAvailable=function(){return"undefined"!=typeof navigator},e.GetDOMTextContent=function(e){for(var t="",r=e.firstChild;r;)3===r.nodeType&&(t+=r.textContent),r=r.nextSibling;return t},e}(),G=function(){function e(){}return e._AddLogEntry=function(t){e._LogCache=t+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(t)},e._FormatMessage=function(e){var t=function(e){return e<10?"0"+e:""+e},r=new Date;return"["+t(r.getHours())+":"+t(r.getMinutes())+":"+t(r.getSeconds())+"]: "+e},e._LogDisabled=function(e){},e._LogEnabled=function(t){var r=e._FormatMessage(t);console.log("BJS - "+r);var i="<div style='color:white'>"+r+"</div><br>";e._AddLogEntry(i)},e._WarnDisabled=function(e){},e._WarnEnabled=function(t){var r=e._FormatMessage(t);console.warn("BJS - "+r);var i="<div style='color:orange'>"+r+"</div><br>";e._AddLogEntry(i)},e._ErrorDisabled=function(e){},e._ErrorEnabled=function(t){e.errorsCount++;var r=e._FormatMessage(t);console.error("BJS - "+r);var i="<div style='color:red'>"+r+"</div><br>";e._AddLogEntry(i)},Object.defineProperty(e,"LogCache",{get:function(){return e._LogCache},enumerable:!0,configurable:!0}),e.ClearLogCache=function(){e._LogCache="",e.errorsCount=0},Object.defineProperty(e,"LogLevels",{set:function(t){(t&e.MessageLogLevel)===e.MessageLogLevel?e.Log=e._LogEnabled:e.Log=e._LogDisabled,(t&e.WarningLogLevel)===e.WarningLogLevel?e.Warn=e._WarnEnabled:e.Warn=e._WarnDisabled,(t&e.ErrorLogLevel)===e.ErrorLogLevel?e.Error=e._ErrorEnabled:e.Error=e._ErrorDisabled},enumerable:!0,configurable:!0}),e.NoneLogLevel=0,e.MessageLogLevel=1,e.WarningLogLevel=2,e.ErrorLogLevel=4,e.AllLogLevel=7,e._LogCache="",e.errorsCount=0,e.Log=e._LogEnabled,e.Warn=e._WarnEnabled,e.Error=e._ErrorEnabled,e}(),X=function(){function e(){}return e.EndsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},e.StartsWith=function(e,t){return 0===e.indexOf(t)},e}(),z=function(){function e(){this.children=[]}return e.prototype.isValid=function(e){return!0},e.prototype.process=function(e,t){var r="";if(this.line){var i=this.line,n=t.processor;if(n){if(n.lineProcessor&&(i=n.lineProcessor(i,t.isFragment)),n.attributeProcessor&&X.StartsWith(this.line,"attribute"))i=n.attributeProcessor(this.line);else if(n.varyingProcessor&&X.StartsWith(this.line,"varying"))i=n.varyingProcessor(this.line,t.isFragment);else if((n.uniformProcessor||n.uniformBufferProcessor)&&X.StartsWith(this.line,"uniform")){/uniform (.+) (.+)/.test(this.line)?n.uniformProcessor&&(i=n.uniformProcessor(this.line,t.isFragment)):n.uniformBufferProcessor&&(i=n.uniformBufferProcessor(this.line,t.isFragment),t.lookForClosingBracketForUniformBuffer=!0)}n.endOfUniformBufferProcessor&&t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,i=n.endOfUniformBufferProcessor(this.line,t.isFragment))}r+=i+"\r\n"}return this.children.forEach(function(i){r+=i.process(e,t)}),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),r},e}(),k=function(){function e(){}return Object.defineProperty(e.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,r=e;t<r.length;t++){var i=r[t];if("#"!==i[0])for(var n=i.split(";"),s=0;s<n.length;s++){var o=n[s];(o=o.trim())&&this._lines.push(o+(s!==n.length-1?";":""))}else this._lines.push(i)}},enumerable:!0,configurable:!0}),e}(),V=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.process=function(e,t){for(var r=0;r<this.children.length;r++){var i=this.children[r];if(i.isValid(e))return i.process(e,t)}return""},t}(z),H=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.isValid=function(e){return this.testExpression.isTrue(e)},t}(z),W=function(){function e(){}return e.prototype.isTrue=function(e){return!0},e}(),Y=function(e){function t(t,r){void 0===r&&(r=!1);var i=e.call(this)||this;return i.define=t,i.not=r,i}return s(t,e),t.prototype.isTrue=function(e){var t=void 0!==e[this.define];return this.not&&(t=!t),t},t}(W),j=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)},t}(W),q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)},t}(W),Q=function(e){function t(t,r,i){var n=e.call(this)||this;return n.define=t,n.operand=r,n.testValue=i,n}return s(t,e),t.prototype.isTrue=function(e){var t=e[this.define];if(void 0===t)return!1;var r=!1,i=parseInt(t),n=parseInt(this.testValue);switch(this.operand){case">":r=i>n;break;case"<":r=i<n;break;case"<=":r=i<=n;break;case">=":r=i>=n;break;case"==":r=i===n}return r},t}(W),Z=function(){function e(){this._xhr=new XMLHttpRequest}return e.prototype._injectCustomRequestHeaders=function(){for(var t in e.CustomRequestHeaders){var r=e.CustomRequestHeaders[t];r&&this._xhr.setRequestHeader(t,r)}},Object.defineProperty(e.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(e){this._xhr.onprogress=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._xhr.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"response",{get:function(){return this._xhr.response},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(e){this._xhr.responseType=e},enumerable:!0,configurable:!0}),e.prototype.addEventListener=function(e,t,r){this._xhr.addEventListener(e,t,r)},e.prototype.removeEventListener=function(e,t,r){this._xhr.removeEventListener(e,t,r)},e.prototype.abort=function(){this._xhr.abort()},e.prototype.send=function(t){e.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)},e.prototype.open=function(t,r){for(var i=0,n=e.CustomRequestModifiers;i<n.length;i++){(0,n[i])(this._xhr,r)}return r=(r=r.replace("file:http:","http:")).replace("file:https:","https:"),this._xhr.open(t,r,!0)},e.CustomRequestHeaders={},e.CustomRequestModifiers=new Array,e}(),K=function(e){function t(r,i){var n=e.call(this,r)||this;return n.request=i,n.name="LoadFileError",t._setPrototypeOf(n,t.prototype),n}return s(t,e),t._setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t}(Error),J=function(){function e(){}return e.FilesToLoad={},e}(),$=function(){function e(){}return e.ExponentialBackoff=function(e,t){return void 0===e&&(e=3),void 0===t&&(t=500),function(r,i,n){return 0!==i.status||n>=e||-1!==r.indexOf("file:")?-1:Math.pow(2,n)*t}},e}(),ee=function(){function e(){}return e._CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},e.SetCorsBehavior=function(e,t){if((!e||0!==e.indexOf("data:"))&&this.CorsBehavior)if("string"==typeof this.CorsBehavior||this.CorsBehavior instanceof String)t.crossOrigin=this.CorsBehavior;else{var r=this.CorsBehavior(e);r&&(t.crossOrigin=r)}},e.LoadImage=function(e,t,r,i){var n,s=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?(n=URL.createObjectURL(new Blob([e])),s=!0):e instanceof Blob?(n=URL.createObjectURL(e),s=!0):(n=this._CleanUrl(e),n=this.PreprocessUrl(e));var o=new Image;this.SetCorsBehavior(n,o);var a=function(){o.removeEventListener("load",a),o.removeEventListener("error",u),t(o),s&&o.src&&URL.revokeObjectURL(o.src)},u=function(t){o.removeEventListener("load",a),o.removeEventListener("error",u),r&&r("Error while trying to load image: "+e,t),s&&o.src&&URL.revokeObjectURL(o.src)};o.addEventListener("load",a),o.addEventListener("error",u);var h=function(){o.src=n};if("data:"!==n.substr(0,5)&&i&&i.enableTexturesOffline)i.open(function(){i&&i.loadImage(n,o)},h);else{if(-1!==n.indexOf("file:")){var l=decodeURIComponent(n.substring(5).toLowerCase());if(J.FilesToLoad[l]){try{var _;try{_=URL.createObjectURL(J.FilesToLoad[l])}catch(e){_=URL.createObjectURL(J.FilesToLoad[l])}o.src=_,s=!0}catch(e){o.src=""}return o}}h()}return o},e.ReadFile=function(e,t,r,i){var n=new FileReader,s={onCompleteObservable:new N,abort:function(){return n.abort()}};return n.onloadend=function(e){return s.onCompleteObservable.notifyObservers(s)},n.onerror=function(e){t(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},n.onload=function(e){t(e.target.result)},r&&(n.onprogress=r),i?n.readAsArrayBuffer(e):n.readAsText(e),s},e.LoadFile=function(e,t,r,i,n,s){var o=this;if(e=this._CleanUrl(e),-1!==(e=this.PreprocessUrl(e)).indexOf("file:")){var a=decodeURIComponent(e.substring(5).toLowerCase());if(J.FilesToLoad[a])return this.ReadFile(J.FilesToLoad[a],t,r,n)}var u=this.BaseUrl+e,h=!1,l={onCompleteObservable:new N,abort:function(){return h=!0}},_=function(){var e=new Z,i=null;l.abort=function(){h=!0,e.readyState!==(XMLHttpRequest.DONE||4)&&e.abort(),null!==i&&(clearTimeout(i),i=null)};var a=function(_){e.open("GET",u),n&&(e.responseType="arraybuffer"),r&&e.addEventListener("progress",r);var c=function(){e.removeEventListener("loadend",c),l.onCompleteObservable.notifyObservers(l),l.onCompleteObservable.clear()};e.addEventListener("loadend",c);var f=function(){if(!h&&e.readyState===(XMLHttpRequest.DONE||4)){if(e.removeEventListener("readystatechange",f),e.status>=200&&e.status<300||0===e.status&&(!B.IsWindowObjectExist()||o.IsFileURL()))return void t(n?e.response:e.responseText,e.responseURL);var r=o.DefaultRetryStrategy;if(r){var l=r(u,e,_);if(-1!==l)return e.removeEventListener("loadend",c),e=new Z,void(i=setTimeout(function(){return a(_+1)},l))}var p=new K("Error status: "+e.status+" "+e.statusText+" - Unable to load "+u,e);if(!s)throw p;s(e,p)}};e.addEventListener("readystatechange",f),e.send()};a(0)};if(i&&i.enableSceneOffline){var c=function(e){e&&e.status>400?s&&s(e):h||_()};i.open(function(){h||i&&i.loadFile(e,function(e){h||t(e),l.onCompleteObservable.notifyObservers(l)},r?function(e){h||r(e)}:void 0,c,n)},c)}else _();return l},e.IsFileURL=function(){return"file:"===location.protocol},e.DefaultRetryStrategy=$.ExponentialBackoff(),e.BaseUrl="",e.CorsBehavior="anonymous",e.PreprocessUrl=function(e){return e},e}(),te=function(){function e(){}return e.Process=function(e,t,r){var i=this;this._ProcessIncludes(e,t,function(e){var n=i._ProcessShaderConversion(e,t);r(n)})},e._ProcessPrecision=function(e,t){var r=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=r?"precision highp float;\n"+e:"precision mediump float;\n"+e:r||(e=e.replace("precision highp float","precision mediump float")),e},e._ExtractOperation=function(e){var t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new Y(t[1].trim(),"!"===e[0]);for(var r="",i=0,n=0,s=["==",">=","<=","<",">"];n<s.length&&(r=s[n],!((i=e.indexOf(r))>-1));n++);if(-1===i)return new Y(e);var o=e.substring(0,i).trim(),a=e.substring(i+r.length).trim();return new Q(o,r,a)},e._BuildSubExpression=function(e){var t=e.indexOf("||");if(-1===t){var r=e.indexOf("&&");if(r>-1){var i=new q,n=e.substring(0,r).trim(),s=e.substring(r+2).trim();return i.leftOperand=this._BuildSubExpression(n),i.rightOperand=this._BuildSubExpression(s),i}return this._ExtractOperation(e)}var o=new j;n=e.substring(0,t).trim(),s=e.substring(t+2).trim();return o.leftOperand=this._BuildSubExpression(n),o.rightOperand=this._BuildSubExpression(s),o},e._BuildExpression=function(e,t){var r=new H,i=e.substring(0,t),n=e.substring(t).trim();return r.testExpression="#ifdef"===i?new Y(n):"#ifndef"===i?new Y(n,!0):this._BuildSubExpression(n),r},e._MoveCursorWithinIf=function(e,t,r){for(var i=e.currentLine;this._MoveCursor(e,r);){var n=(i=e.currentLine).substring(0,5).toLowerCase();if("#else"===n){var s=new z;return t.children.push(s),void this._MoveCursor(e,s)}if("#elif"===n){var o=this._BuildExpression(i,5);t.children.push(o),r=o}}},e._MoveCursor=function(e,t){for(;e.canRead;){e.lineIndex++;var r=e.currentLine,i=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(r);if(i&&i.length){switch(i[0]){case"#ifdef":var n=new V;t.children.push(n);var s=this._BuildExpression(r,6);n.children.push(s),this._MoveCursorWithinIf(e,n,s);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":n=new V;t.children.push(n);s=this._BuildExpression(r,7);n.children.push(s),this._MoveCursorWithinIf(e,n,s);break;case"#if":n=new V,s=this._BuildExpression(r,3);t.children.push(n),n.children.push(s),this._MoveCursorWithinIf(e,n,s)}}else{var o=new z;if(o.line=r,t.children.push(o),"#"===r[0]&&"d"===r[1]){var a=r.replace(";","").split(" ");o.additionalDefineKey=a[1],3===a.length&&(o.additionalDefineValue=a[2])}}}return!1},e._EvaluatePreProcessors=function(e,t,r){var i=new z,n=new k;return n.lineIndex=-1,n.lines=e.split("\n"),this._MoveCursor(n,i),i.process(t,r)},e._PreparePreProcessors=function(e){for(var t={},r=0,i=e.defines;r<i.length;r++){var n=i[r].replace("#define","").replace(";","").trim().split(" ");t[n[0]]=n.length>1?n[1]:""}return t.GL_ES="true",t.__VERSION__=e.version,t[e.platformName]="true",t},e._ProcessShaderConversion=function(e,t){var r=this._ProcessPrecision(e,t);if(!t.processor)return r;if(-1!==r.indexOf("#version 3"))return r.replace("#version 300 es","");var i=t.defines,n=this._PreparePreProcessors(t);return t.processor.preProcessor&&(r=t.processor.preProcessor(r,i,t.isFragment)),r=this._EvaluatePreProcessors(r,n,t),t.processor.postProcessor&&(r=t.processor.postProcessor(r,i,t.isFragment)),r},e._ProcessIncludes=function(e,t,r){for(var i=this,n=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,s=n.exec(e),o=new String(e);null!=s;){var a=s[1];if(-1!==a.indexOf("__decl__")&&(a=a.replace(/__decl__/,""),t.supportsUniformBuffers&&(a=(a=a.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),a+="Declaration"),!t.includesShadersStore[a]){var u=t.shadersRepository+"ShadersInclude/"+a+".fx";return void ee.LoadFile(u,function(e){t.includesShadersStore[a]=e,i._ProcessIncludes(o,t,r)})}var h=t.includesShadersStore[a];if(s[2])for(var l=s[3].split(","),_=0;_<l.length;_+=2){var c=new RegExp(l[_],"g"),f=l[_+1];h=h.replace(c,f)}if(s[4]){var p=s[5];if(-1!==p.indexOf("..")){var d=p.split(".."),E=parseInt(d[0]),T=parseInt(d[1]),g=h.slice(0);h="",isNaN(T)&&(T=t.indexParameters[d[1]]);for(var R=E;R<T;R++)t.supportsUniformBuffers||(g=g.replace(/light\{X\}.(\w*)/g,function(e,t){return t+"{X}"})),h+=g.replace(/\{X\}/g,R.toString())+"\n"}else t.supportsUniformBuffers||(h=h.replace(/light\{X\}.(\w*)/g,function(e,t){return t+"{X}"})),h=h.replace(/\{X\}/g,p)}o=o.replace(s[0],h),s=n.exec(e)}r(o)},e}(),re=function(){function e(t,r,i,n,s,o,a,u,h,l){var _,c,f=this;if(void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===h&&(h=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new N,this.onErrorObservable=new N,this._onBindObservable=null,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._valueCache={},this.name=t,r.attributes){var p=r;if(this._engine=i,this._attributesNames=p.attributes,this._uniformsNames=p.uniformsNames.concat(p.samplers),this._samplerList=p.samplers.slice(),this.defines=p.defines,this.onError=p.onError,this.onCompiled=p.onCompiled,this._fallbacks=p.fallbacks,this._indexParameters=p.indexParameters,this._transformFeedbackVaryings=p.transformFeedbackVaryings||null,p.uniformBuffersNames)for(var d=0;d<p.uniformBuffersNames.length;d++)this._uniformBuffersNames[p.uniformBuffersNames[d]]=d}else this._engine=s,this.defines=null==o?"":o,this._uniformsNames=i.concat(n),this._samplerList=n?n.slice():[],this._attributesNames=r,this.onError=h,this.onCompiled=u,this._indexParameters=l,this._fallbacks=a;this.uniqueId=e._uniqueIdSeed++,t.vertexSource?_="source:"+t.vertexSource:t.vertexElement?(_=document.getElementById(t.vertexElement))||(_=t.vertexElement):_=t.vertex||t,t.fragmentSource?c="source:"+t.fragmentSource:t.fragmentElement?(c=document.getElementById(t.fragmentElement))||(c=t.fragmentElement):c=t.fragment||t;var E={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:e.ShadersRepository,includesShadersStore:e.IncludesShadersStore,version:(100*this._engine.webGLVersion).toString(),platformName:this._engine.webGLVersion>=2?"WEBGL2":"WEBGL1"};this._loadVertexShader(_,function(e){f._loadFragmentShader(c,function(r){te.Process(e,E,function(e){E.isFragment=!0,te.Process(r,E,function(r){f._useFinalCode(e,r,t)})})})})}return Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new N),this._onBindObservable},enumerable:!0,configurable:!0}),e.prototype._useFinalCode=function(e,t,r){if(r){var i=r.vertexElement||r.vertex||r.spectorName||r,n=r.fragmentElement||r.fragment||r.spectorName||r;this._vertexSourceCode="#define SHADER_NAME vertex:"+i+"\n"+e,this._fragmentSourceCode="#define SHADER_NAME fragment:"+n+"\n"+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()},Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),e.prototype.isReady=function(){try{return this._isReadyInternal()}catch(e){return!1}},e.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},e.prototype.getEngine=function(){return this._engine},e.prototype.getPipelineContext=function(){return this._pipelineContext},e.prototype.getAttributesNames=function(){return this._attributesNames},e.prototype.getAttributeLocation=function(e){return this._attributes[e]},e.prototype.getAttributeLocationByName=function(e){var t=this._attributesNames.indexOf(e);return this._attributes[t]},e.prototype.getAttributesCount=function(){return this._attributes.length},e.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},e.prototype.getUniform=function(e){return this._uniforms[e]},e.prototype.getSamplers=function(){return this._samplerList},e.prototype.getCompilationError=function(){return this._compilationError},e.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},e.prototype.executeWhenCompiled=function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add(function(t){e(t)}),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout(function(){t._checkIsReady()},16))},e.prototype._checkIsReady=function(){var e=this;try{if(this._isReadyInternal())return}catch(e){return void this._processCompilationErrors(e)}setTimeout(function(){e._checkIsReady()},16)},e.prototype._loadVertexShader=function(t,r){var i;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return void r(B.GetDOMTextContent(t));"source:"!==t.substr(0,7)?"base64:"!==t.substr(0,7)?e.ShadersStore[t+"VertexShader"]?r(e.ShadersStore[t+"VertexShader"]):(i="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:e.ShadersRepository+t,this._engine._loadFile(i+".vertex.fx",r)):r(window.atob(t.substr(7))):r(t.substr(7))},e.prototype._loadFragmentShader=function(t,r){var i;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return void r(B.GetDOMTextContent(t));"source:"!==t.substr(0,7)?"base64:"!==t.substr(0,7)?e.ShadersStore[t+"PixelShader"]?r(e.ShadersStore[t+"PixelShader"]):e.ShadersStore[t+"FragmentShader"]?r(e.ShadersStore[t+"FragmentShader"]):(i="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:e.ShadersRepository+t,this._engine._loadFile(i+".fragment.fx",r)):r(window.atob(t.substr(7))):r(t.substr(7))},e.prototype._dumpShadersSource=function(e,t,r){var i=(this._engine.webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"")+(r?r+"\n":"");t=i+t;var n=2,s=/\n/gm,o="\n1\t"+(e=i+e).replace(s,function(){return"\n"+n+++"\t"});n=2;var a="\n1\t"+t.replace(s,function(){return"\n"+n+++"\t"});this.name.vertexElement?(G.Error("Vertex shader: "+this.name.vertexElement+o),G.Error("Fragment shader: "+this.name.fragmentElement+a)):this.name.vertex?(G.Error("Vertex shader: "+this.name.vertex+o),G.Error("Fragment shader: "+this.name.fragment+a)):(G.Error("Vertex shader: "+this.name+o),G.Error("Fragment shader: "+this.name+a))},e.prototype._rebuildProgram=function(e,t,r,n){var s=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){n&&n(t)},this.onCompiled=function(){for(var e=s.getEngine().scenes,t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(i.MATERIAL_AllDirtyFlag);s._pipelineContext._handlesSpectorRebuildCallback(r)},this._fallbacks=null,this._prepareEffect()},e.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,r=this.defines;this._valueCache={};var i=this._pipelineContext;try{var n=this._engine;this._pipelineContext=n.createPipelineContext();var s=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?n._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,s,null,this._transformFeedbackVaryings):n._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,s,r,this._transformFeedbackVaryings),n._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(n.supportsUniformBuffers)for(var r in e._uniformBuffersNames)e.bindUniformBlock(r,e._uniformBuffersNames[r]);var s;for(n.getUniforms(e._pipelineContext,e._uniformsNames).forEach(function(t,r){e._uniforms[e._uniformsNames[r]]=t}),e._attributes=n.getAttributes(e._pipelineContext,t),s=0;s<e._samplerList.length;s++){null==e.getUniform(e._samplerList[s])&&(e._samplerList.splice(s,1),s--)}e._samplerList.forEach(function(t,r){e._samplers[t]=r}),n.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),i&&e.getEngine()._deletePipelineContext(i)}),this._pipelineContext.isAsync&&this._checkIsReady()}catch(e){this._processCompilationErrors(e,i)}},e.prototype._processCompilationErrors=function(e,t){void 0===t&&(t=null),this._compilationError=e.message;var r=this._attributesNames,i=this._fallbacks;G.Error("Unable to compile effect:"),G.Error("Uniforms: "+this._uniformsNames.map(function(e){return" "+e})),G.Error("Attributes: "+r.map(function(e){return" "+e})),G.Error("Defines:\r\n"+this.defines),G.Error("Error: "+this._compilationError),t&&(this._pipelineContext=t,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),i?(this._pipelineContext=null,i.hasMoreFallbacks?(this._allFallbacksProcessed=!1,G.Error("Trying next fallback."),this.defines=i.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(e.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),e.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t)},e.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t)},e.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t)},e.prototype.setTextureArray=function(e,t){var r=e+"Ex";if(-1===this._samplerList.indexOf(r+"0")){for(var i=this._samplerList.indexOf(e),n=1;n<t.length;n++){var s=r+(n-1).toString();this._samplerList.splice(i+n,0,s)}for(var o=0,a=0,u=this._samplerList;a<u.length;a++){var h=u[a];this._samplers[h]=o,o+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t)},e.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t)},e.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t)},e.prototype._cacheMatrix=function(e,t){var r=this._valueCache[e],i=t.updateFlag;return(void 0===r||r!==i)&&(this._valueCache[e]=i,!0)},e.prototype._cacheFloat2=function(e,t,r){var i=this._valueCache[e];if(!i)return i=[t,r],this._valueCache[e]=i,!0;var n=!1;return i[0]!==t&&(i[0]=t,n=!0),i[1]!==r&&(i[1]=r,n=!0),n},e.prototype._cacheFloat3=function(e,t,r,i){var n=this._valueCache[e];if(!n)return n=[t,r,i],this._valueCache[e]=n,!0;var s=!1;return n[0]!==t&&(n[0]=t,s=!0),n[1]!==r&&(n[1]=r,s=!0),n[2]!==i&&(n[2]=i,s=!0),s},e.prototype._cacheFloat4=function(e,t,r,i,n){var s=this._valueCache[e];if(!s)return s=[t,r,i,n],this._valueCache[e]=s,!0;var o=!1;return s[0]!==t&&(s[0]=t,o=!0),s[1]!==r&&(s[1]=r,o=!0),s[2]!==i&&(s[2]=i,o=!0),s[3]!==n&&(s[3]=n,o=!0),o},e.prototype.bindUniformBuffer=function(t,r){var i=this._uniformBuffersNames[r];void 0!==i&&e._baseCache[i]!==t&&(e._baseCache[i]=t,this._engine.bindUniformBufferBase(t,i))},e.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},e.prototype.setInt=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t?this:(this._valueCache[e]=t,this._engine.setInt(this._uniforms[e],t),this)},e.prototype.setIntArray=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray(this._uniforms[e],t),this},e.prototype.setIntArray2=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray2(this._uniforms[e],t),this},e.prototype.setIntArray3=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray3(this._uniforms[e],t),this},e.prototype.setIntArray4=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray4(this._uniforms[e],t),this},e.prototype.setFloatArray=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray(this._uniforms[e],t),this},e.prototype.setFloatArray2=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray2(this._uniforms[e],t),this},e.prototype.setFloatArray3=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray3(this._uniforms[e],t),this},e.prototype.setFloatArray4=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray4(this._uniforms[e],t),this},e.prototype.setArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},e.prototype.setArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},e.prototype.setArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},e.prototype.setArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},e.prototype.setMatrices=function(e,t){return t?(this._valueCache[e]=null,this._engine.setMatrices(this._uniforms[e],t),this):this},e.prototype.setMatrix=function(e,t){return this._cacheMatrix(e,t)&&this._engine.setMatrices(this._uniforms[e],t.toArray()),this},e.prototype.setMatrix3x3=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix3x3(this._uniforms[e],t),this},e.prototype.setMatrix2x2=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix2x2(this._uniforms[e],t),this},e.prototype.setFloat=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t?this:(this._valueCache[e]=t,this._engine.setFloat(this._uniforms[e],t),this)},e.prototype.setBool=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t?this:(this._valueCache[e]=t,this._engine.setBool(this._uniforms[e],t?1:0),this)},e.prototype.setVector2=function(e,t){return this._cacheFloat2(e,t.x,t.y)&&this._engine.setFloat2(this._uniforms[e],t.x,t.y),this},e.prototype.setFloat2=function(e,t,r){return this._cacheFloat2(e,t,r)&&this._engine.setFloat2(this._uniforms[e],t,r),this},e.prototype.setVector3=function(e,t){return this._cacheFloat3(e,t.x,t.y,t.z)&&this._engine.setFloat3(this._uniforms[e],t.x,t.y,t.z),this},e.prototype.setFloat3=function(e,t,r,i){return this._cacheFloat3(e,t,r,i)&&this._engine.setFloat3(this._uniforms[e],t,r,i),this},e.prototype.setVector4=function(e,t){return this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&this._engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w),this},e.prototype.setFloat4=function(e,t,r,i,n){return this._cacheFloat4(e,t,r,i,n)&&this._engine.setFloat4(this._uniforms[e],t,r,i,n),this},e.prototype.setColor3=function(e,t){return this._cacheFloat3(e,t.r,t.g,t.b)&&this._engine.setFloat3(this._uniforms[e],t.r,t.g,t.b),this},e.prototype.setColor4=function(e,t,r){return this._cacheFloat4(e,t.r,t.g,t.b,r)&&this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,r),this},e.prototype.setDirectColor4=function(e,t){return this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&this._engine.setDirectColor4(this._uniforms[e],t),this},e.prototype.dispose=function(){this._engine._releaseEffect(this)},e.RegisterShader=function(t,r,i){r&&(e.ShadersStore[t+"PixelShader"]=r),i&&(e.ShadersStore[t+"VertexShader"]=i)},e.ResetCache=function(){e._baseCache={}},e.ShadersRepository="src/Shaders/",e._uniqueIdSeed=0,e._baseCache={},e.ShadersStore={},e.IncludesShadersStore={},e}(),ie=function(){this.maxMSAASamples=1},ne=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},e}(),se=function(){function e(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(e){this._stencilFunc!==e&&(this._stencilFunc=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(e){this._stencilFuncRef!==e&&(this._stencilFuncRef=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(e){this._stencilFuncMask!==e&&(this._stencilFuncMask=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(e){this._stencilOpStencilFail!==e&&(this._stencilOpStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(e){this._stencilOpDepthFail!==e&&(this._stencilOpDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(e){this._stencilOpStencilDepthPass!==e&&(this._stencilOpStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(e){this._stencilMask!==e&&(this._stencilMask=e,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(e){this._stencilTest!==e&&(this._stencilTest=e,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=e.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=e.KEEP,this._stencilOpDepthFail=e.KEEP,this._stencilOpStencilDepthPass=e.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},e.prototype.apply=function(e){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},e.ALWAYS=i.ALWAYS,e.KEEP=i.KEEP,e.REPLACE=i.REPLACE,e}(),oe=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendConstants=function(e,t,r,i){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===r&&this._blendConstants[3]===i||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=r,this._blendConstants[3]=i,this._isBlendConstantsDirty=!0)},e.prototype.setAlphaBlendFunctionParameters=function(e,t,r,i){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===r&&this._blendFunctionParameters[3]===i||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=r,this._blendFunctionParameters[3]=i,this._isBlendFunctionParametersDirty=!0)},e.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},e}(),ae=function(){};!function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Depth=11]="Depth",e[e.CubeRawRGBD=12]="CubeRawRGBD"}(F||(F={}));var ue=function(){function e(e,t,r){void 0===r&&(r=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new N,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=F.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._webGLTexture=null,this._references=1,this._engine=e,this._source=t,r||(this._webGLTexture=e._createTexture())}return e.prototype.getEngine=function(){return this._engine},Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),e.prototype.incrementReferences=function(){this._references++},e.prototype.updateSize=function(e,t,r){void 0===r&&(r=1),this.width=e,this.height=t,this.depth=r,this.baseWidth=e,this.baseHeight=t,this.baseDepth=r,this._size=e*t*r},e.prototype._rebuild=function(){var t,r=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this.source){case F.Temp:return;case F.Url:return void(t=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){t._swapAndDie(r),r.isReady=!0},null,this._buffer,void 0,this.format));case F.Raw:return(t=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case F.Raw3D:return(t=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case F.Dynamic:return(t=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case F.RenderTarget:var n=new ae;if(n.generateDepthBuffer=this._generateDepthBuffer,n.generateMipMaps=this.generateMipMaps,n.generateStencilBuffer=this._generateStencilBuffer,n.samplingMode=this.samplingMode,n.type=this.type,this.isCube)t=this._engine.createRenderTargetCubeTexture(this.width,n);else{var s={width:this.width,height:this.height};t=this._engine.createRenderTargetTexture(s,n)}return t._swapAndDie(this),void(this.isReady=!0);case F.Depth:var o={bilinearFiltering:this.samplingMode!==i.TEXTURE_BILINEAR_SAMPLINGMODE,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube};return(t=this._engine.createDepthStencilTexture({width:this.width,height:this.height},o))._swapAndDie(this),void(this.isReady=!0);case F.Cube:return void(t=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){t._swapAndDie(r),r.isReady=!0},null,this.format,this._extension));case F.CubeRaw:return(t=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case F.CubeRawRGBD:return t=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void e._UpdateRGBDAsync(t,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){t._swapAndDie(r),r.isReady=!0});case F.CubePrefiltered:return void((t=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(e){e&&e._swapAndDie(r),r.isReady=!0},null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},e.prototype._swapAndDie=function(e){e._webGLTexture=this._webGLTexture,e._isRGBD=this._isRGBD,this._framebuffer&&(e._framebuffer=this._framebuffer),this._depthStencilBuffer&&(e._depthStencilBuffer=this._depthStencilBuffer),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var t,r=this._engine.getLoadedTexturesCache();-1!==(t=r.indexOf(this))&&r.splice(t,1),-1===(t=r.indexOf(e))&&r.push(e)},e.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null))},e._UpdateRGBDAsync=function(e,t,r,i,n){throw R.WarnImport("environmentTextureTools")},e}(),he=function(){function e(){}return e.prototype.attributeProcessor=function(e){return e.replace("attribute","in")},e.prototype.varyingProcessor=function(e,t){return e.replace("varying",t?"in":"out")},e.prototype.postProcessor=function(e,t,r){var i=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),r)e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(i?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;return e},e}(),le=function(e){function t(t){var r=e.call(this)||this;return r._buffer=t,r}return s(t,e),Object.defineProperty(t.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),t}(function(){function e(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return null},enumerable:!0,configurable:!0}),e}()),_e=function(){function e(){}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!0,configurable:!0}),e.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},e}(),ce=function(){},fe=function(){function e(t,r,i,n){var s=this;void 0===n&&(n=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this._windowIsBackground=!1,this._webGLVersion=1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._colorWrite=!0,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new N,this.onContextRestoredObservable=new N,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._depthCullingState=new ne,this._stencilState=new se,this._alphaState=new oe,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._texturesSupported=new Array,this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new N,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={};var o=null;if(t){if(i=i||{},t.getContext){if(o=t,this._renderingCanvas=o,null!=r&&(i.antialias=r),void 0===i.deterministicLockstep&&(i.deterministicLockstep=!1),void 0===i.lockstepMaxSteps&&(i.lockstepMaxSteps=4),void 0===i.preserveDrawingBuffer&&(i.preserveDrawingBuffer=!1),void 0===i.audioEngine&&(i.audioEngine=!0),void 0===i.stencil&&(i.stencil=!0),!1===i.premultipliedAlpha&&(this.premultipliedAlpha=!1),this._doNotHandleContextLost=!!i.doNotHandleContextLost,navigator&&navigator.userAgent)for(var a=navigator.userAgent,u=0,h=e.ExceptionList;u<h.length;u++){var l=h[u],_=l.key,c=l.targets;if(new RegExp(_).test(a)){if(l.capture&&l.captureConstraint){var f=l.capture,p=l.captureConstraint,d=new RegExp(f).exec(a);if(d&&d.length>0)if(parseInt(d[d.length-1])>=p)continue}for(var E=0,T=c;E<T.length;E++){switch(T[E]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),s._contextWasLost=!0,G.Warn("WebGL context lost."),s.onContextLostObservable.notifyObservers(s)},this._onContextRestored=function(){setTimeout(function(){s._initGLContext(),s._rebuildEffects(),s._rebuildInternalTextures(),s._rebuildBuffers(),s.wipeCaches(!0),G.Warn("WebGL context successfully restored."),s.onContextRestoredObservable.notifyObservers(s),s._contextWasLost=!1},0)},o.addEventListener("webglcontextlost",this._onContextLost,!1),o.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference="high-performance"),!i.disableWebGL2Support)try{this._gl=o.getContext("webgl2",i)||o.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(e){}if(!this._gl){if(!o)throw new Error("The provided canvas is null or undefined.");try{this._gl=o.getContext("webgl",i)||o.getContext("experimental-webgl",i)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var g=this._gl.getContextAttributes();g&&(i.stencil=g.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==i.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats);var R=B.IsWindowObjectExist()&&window.devicePixelRatio||1,y=i.limitDeviceRatio||R;this._hardwareScalingLevel=n?1/Math.min(y,R):1,this.resize(),this._isStencilEnable=!!i.stencil,this._initGLContext();for(var m=0;m<this._caps.maxVertexAttribs;m++)this._currentBufferPointers[m]=new ce;this.webGLVersion>1&&(this._shaderProcessor=new he),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),console.log("Babylon.js v"+e.Version+" - "+this.description)}}return Object.defineProperty(e,"NpmPackage",{get:function(){return"babylonjs@4.1.0-alpha.23"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Version",{get:function(){return"4.1.0-alpha.23"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){var e="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShadersRepository",{get:function(){return re.ShadersRepository},set:function(e){re.ShadersRepository=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_shouldUseHighPrecisionShader",{get:function(){return this._caps.highPrecisionShaderSupported&&this._highPrecisionShadersAllowed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,i.TEXTUREFORMAT_RGBA,!1,!1,i.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,i.TEXTUREFORMAT_RGBA,!1,!1,i.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,i.TEXTUREFORMAT_RGBA,i.TEXTURETYPE_UNSIGNED_INT,!1,!1,i.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),e.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++){t[e]._rebuild()}},e.prototype._rebuildEffects=function(){for(var e in this._compiledEffects){this._compiledEffects[e]._prepareEffect()}re.ResetCache()},e.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects){if(!this._compiledEffects[e].isReady())return!1}return!0},e.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++){t[e]._rebuild()}},e.prototype._initGLContext=function(){this._caps=new ie,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxCombinedTexturesImageUnits=this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureImageUnits=this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._caps.maxVertexAttribs=this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),this._caps.maxVaryingVectors=this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),this._caps.maxFragmentUniformVectors=this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxVertexUniformVectors=this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.standardDerivatives=this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.astc=this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._caps.pvrtc=this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this._caps.etc1=this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),this._caps.etc2=this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.uintIndices=this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),this._caps.fragmentDepthSupported=this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),this._caps.highPrecisionShaderSupported=!1,this._caps.timerQuery=this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.colorBufferFloat=this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),this._caps.textureFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._caps.textureLOD=!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),this._caps.multiview=this._gl.getExtension("OVR_multiview2"),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var r=0;r<16;r++)this._gl["COLOR_ATTACHMENT"+r+"_WEBGL"]=t["COLOR_ATTACHMENT"+r+"_WEBGL"]}else this._caps.drawBuffersExtension=!1}if(this._caps.parallelShaderCompile=this._gl.getExtension("KHR_parallel_shader_compile"),this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var i=this._gl.getExtension("WEBGL_depth_texture");null!=i&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=i.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var n=this._gl.getExtension("OES_vertex_array_object");null!=n?(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=n.createVertexArrayOES.bind(n),this._gl.bindVertexArray=n.bindVertexArrayOES.bind(n),this._gl.deleteVertexArray=n.deleteVertexArrayOES.bind(n)):this._caps.vertexArrayObject=!1}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var s=this._gl.getExtension("ANGLE_instanced_arrays");null!=s?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=s.drawArraysInstancedANGLE.bind(s),this._gl.drawElementsInstanced=s.drawElementsInstancedANGLE.bind(s),this._gl.vertexAttribDivisor=s.vertexAttribDivisorANGLE.bind(s)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var o=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),a=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);o&&a&&(this._caps.highPrecisionShaderSupported=0!==o.precision&&0!==a.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var u=this._gl.getExtension("EXT_blend_minmax");null!=u?(this._caps.blendMinMax=!0,this._gl.MAX=u.MAX_EXT,this._gl.MIN=u.MIN_EXT):this._caps.blendMinMax=!1}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var h=0;h<this._maxSimultaneousTextures;h++)this._nextFreeTextureSlots.push(h)},Object.defineProperty(e.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(e.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),e.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=document.createElement("canvas");var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},e.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},e.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},e.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},e.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},e.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},e.prototype.getCaps=function(){return this._caps},e.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},e.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++){(0,this._activeRenderLoops[t])()}this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._bindedRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},e.prototype.getRenderingCanvas=function(){return this._renderingCanvas},e.prototype.getHostWindow=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window},e.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._gl.drawingBufferWidth},e.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._gl.drawingBufferHeight},e.prototype._queueNewFrame=function(t,r){return e.QueueNewFrame(t,r)},e.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._bindedRenderFunction,this.getHostWindow())))},e.prototype.clear=function(e,t,r,i){void 0===i&&(i=!1),this.applyStates();var n=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),n|=this._gl.COLOR_BUFFER_BIT),r&&(this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),i&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)},e.prototype._viewport=function(e,t,r,i){e===this._viewportCached.x&&t===this._viewportCached.y&&r===this._viewportCached.z&&i===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=i,this._gl.viewport(e,t,r,i))},e.prototype.setViewport=function(e,t,r){var i=t||this.getRenderWidth(),n=r||this.getRenderHeight(),s=e.x||0,o=e.y||0;this._cachedViewport=e,this._viewport(s*i,o*n,i*e.width,n*e.height)},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer()},e.prototype.resize=function(){var e=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,t=this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},e.prototype.setSize=function(e,t){this._renderingCanvas&&(e|=0,t|=0,this._renderingCanvas.width===e&&this._renderingCanvas.height===t||(this._renderingCanvas.width=e,this._renderingCanvas.height=t))},e.prototype.bindFramebuffer=function(e,t,r,i,n,s,o){void 0===o&&(o=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var a=this._gl;e.isCube&&(void 0===t&&(t=0),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,e._webGLTexture,o),s&&(s._generateStencilBuffer?a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,s._webGLTexture,o):a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,s._webGLTexture,o))),this._cachedViewport&&!n?this.setViewport(this._cachedViewport,r,i):(r||(r=e.width,o&&(r/=Math.pow(2,o))),i||(i=e.height,o&&(i/=Math.pow(2,o))),this._viewport(0,0,r,i)),this.wipeCaches()},e.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},e.prototype.unBindFramebuffer=function(e,t,r){void 0===t&&(t=!1),this._currentRenderTarget=null;var i=this._gl;e._MSAAFramebuffer&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,e._MSAAFramebuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,e._framebuffer),i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,i.COLOR_BUFFER_BIT,i.NEAREST)),!e.generateMipMaps||t||e.isCube||(this._bindTextureDirectly(i.TEXTURE_2D,e,!0),i.generateMipmap(i.TEXTURE_2D),this._bindTextureDirectly(i.TEXTURE_2D,null)),r&&(e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._framebuffer),r()),this._bindUnboundFramebuffer(null)},e.prototype.flushFramebuffer=function(){this._gl.flush()},e.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},e.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},e.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},e.prototype._createVertexBuffer=function(e,t){var r=this._gl.createBuffer();if(!r)throw new Error("Unable to create vertex buffer");var i=new le(r);return this.bindArrayBuffer(i),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),i.references=1,i},e.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},e.prototype.updateDynamicVertexBuffer=function(e,t,r,i){this.bindArrayBuffer(e),void 0===r&&(r=0),void 0===i?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(r,r+i)):(t=t instanceof ArrayBuffer?new Uint8Array(t,r,i):new Uint8Array(t.buffer,t.byteOffset+r,i),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()},e.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},e.prototype.createIndexBuffer=function(e,t){var r=this._gl.createBuffer(),i=new le(r);if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(i);var n=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),i.references=1,i.is32Bits=4===n.BYTES_PER_ELEMENT,i},e.prototype._normalizeIndexData=function(e){if(e instanceof Uint16Array)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},e.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},e.prototype.bindUniformBlock=function(e,t,r){var i=e.program,n=this._gl.getUniformBlockIndex(i,t);this._gl.uniformBlockBinding(i,n,r)},e.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},e.prototype.bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},e.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},e.prototype._vertexAttribPointer=function(e,t,r,i,n,s,o){var a=this._currentBufferPointers[t],u=!1;a.active?(a.buffer!==e&&(a.buffer=e,u=!0),a.size!==r&&(a.size=r,u=!0),a.type!==i&&(a.type=i,u=!0),a.normalized!==n&&(a.normalized=n,u=!0),a.stride!==s&&(a.stride=s,u=!0),a.offset!==o&&(a.offset=o,u=!0)):(u=!0,a.active=!0,a.index=t,a.size=r,a.type=i,a.normalized=n,a.stride=s,a.offset=o,a.buffer=e),(u||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,r,i,n,s,o))},e.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},e.prototype._bindVertexBuffersAttributes=function(e,t){var r=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var i=0;i<r.length;i++){var n=t.getAttributeLocation(i);if(n>=0){var s=e[r[i]];if(!s)continue;this._gl.enableVertexAttribArray(n),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[n]=!0);var o=s.getBuffer();o&&(this._vertexAttribPointer(o,n,s.getSize(),s.type,s.normalized,s.byteStride,s.byteOffset),s.getIsInstanced()&&(this._gl.vertexAttribDivisor(n,s.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(o))))}}},e.prototype.recordVertexArrayObject=function(e,t,r){var i=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(i),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,r),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),i},e.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},e.prototype.bindBuffersDirectly=function(e,t,r,i,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n;var s=n.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var o=0,a=0;a<s;a++)if(a<r.length){var u=n.getAttributeLocation(a);u>=0&&(this._gl.enableVertexAttribArray(u),this._vertexAttribArraysEnabled[u]=!0,this._vertexAttribPointer(e,u,r[a],this._gl.FLOAT,!1,i,o)),o+=4*r[a]}}this._bindIndexBufferWithCache(t)},e.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},e.prototype.bindBuffers=function(e,t,r){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===r||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,this._bindVertexBuffersAttributes(e,r)),this._bindIndexBufferWithCache(t)},e.prototype.unbindInstanceAttributes=function(){for(var e,t=0,r=this._currentInstanceLocations.length;t<r;t++){var i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i));var n=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},e.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},e.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)},e.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},e.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");var r=new le(t);return r.capacity=e,this.bindArrayBuffer(r),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),r},e.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},e.prototype.updateAndBindInstancesBuffer=function(e,t,r){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==r[0].index){for(var i=0,n=0;n<r.length;n++){i+=4*(s=r[n]).attributeSize}for(n=0;n<r.length;n++){var s=r[n];this._vertexAttribArraysEnabled[s.index]||(this._gl.enableVertexAttribArray(s.index),this._vertexAttribArraysEnabled[s.index]=!0),this._vertexAttribPointer(e,s.index,s.attributeSize,s.attribyteType||this._gl.FLOAT,s.normalized||!1,i,s.offset),this._gl.vertexAttribDivisor(s.index,1),this._currentInstanceLocations.push(s.index),this._currentInstanceBuffers.push(e)}}else for(var o=0;o<4;o++){var a=r[o];this._vertexAttribArraysEnabled[a]||(this._gl.enableVertexAttribArray(a),this._vertexAttribArraysEnabled[a]=!0),this._vertexAttribPointer(e,a,4,this._gl.FLOAT,!1,64,16*o),this._gl.vertexAttribDivisor(a,1),this._currentInstanceLocations.push(a),this._currentInstanceBuffers.push(e)}},e.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl)},e.prototype.draw=function(e,t,r,n){this.drawElementsType(e?i.MATERIAL_TriangleFillMode:i.MATERIAL_WireFrameFillMode,t,r,n)},e.prototype.drawPointClouds=function(e,t,r){this.drawArraysType(i.MATERIAL_PointFillMode,e,t,r)},e.prototype.drawUnIndexed=function(e,t,r,n){this.drawArraysType(e?i.MATERIAL_TriangleFillMode:i.MATERIAL_WireFrameFillMode,t,r,n)},e.prototype.drawElementsType=function(e,t,r,i){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e),s=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;i?this._gl.drawElementsInstanced(n,r,s,t*o,i):this._gl.drawElements(n,r,s,t*o)},e.prototype.drawArraysType=function(e,t,r,i){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e);i?this._gl.drawArraysInstanced(n,t,r,i):this._gl.drawArrays(n,t,r)},e.prototype._drawMode=function(e){switch(e){case i.MATERIAL_TriangleFillMode:return this._gl.TRIANGLES;case i.MATERIAL_PointFillMode:return this._gl.POINTS;case i.MATERIAL_WireFrameFillMode:return this._gl.LINES;case i.MATERIAL_PointListDrawMode:return this._gl.POINTS;case i.MATERIAL_LineListDrawMode:return this._gl.LINES;case i.MATERIAL_LineLoopDrawMode:return this._gl.LINE_LOOP;case i.MATERIAL_LineStripDrawMode:return this._gl.LINE_STRIP;case i.MATERIAL_TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case i.MATERIAL_TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},e.prototype._reportDrawCall=function(){},e.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))},e.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))},e.prototype.createEffect=function(e,t,r,i,n,s,o,a,u){var h=(e.vertexElement||e.vertex||e)+"+"+(e.fragmentElement||e.fragment||e)+"@"+(n||t.defines);if(this._compiledEffects[h]){var l=this._compiledEffects[h];return o&&l.isReady()&&o(l),l}var _=new re(e,t,r,i,this,n,s,o,a,u);return _._key=h,this._compiledEffects[h]=_,_},e._ConcatenateShader=function(e,t,r){return void 0===r&&(r=""),r+(t?t+"\n":"")+e},e.prototype._compileShader=function(t,r,i,n){return this._compileRawShader(e._ConcatenateShader(t,i,n),r)},e.prototype._compileRawShader=function(e,t){var r=this._gl,i=r.createShader("vertex"===t?r.VERTEX_SHADER:r.FRAGMENT_SHADER);if(!i)throw new Error("Something went wrong while compile the shader.");return r.shaderSource(i,e),r.compileShader(i),i},e.prototype.createRawShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null),i=i||this._gl;var s=this._compileRawShader(t,"vertex"),o=this._compileRawShader(r,"fragment");return this._createShaderProgram(e,s,o,i,n)},e.prototype.createShaderProgram=function(e,t,r,i,n,s){void 0===s&&(s=null),n=n||this._gl;var o=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",a=this._compileShader(t,"vertex",i,o),u=this._compileShader(r,"fragment",i,o);return this._createShaderProgram(e,a,u,n,s)},e.prototype.createPipelineContext=function(){var e=new _e;return e.engine=this,this._caps.parallelShaderCompile&&(e.isParallelCompiled=!0),e},e.prototype._createShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null);var s=i.createProgram();if(e.program=s,!s)throw new Error("Unable to create program");return i.attachShader(s,t),i.attachShader(s,r),i.linkProgram(s),e.context=i,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),s},e.prototype._finalizePipelineContext=function(e){var t=e.context,r=e.vertexShader,i=e.fragmentShader,n=e.program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var s,o;if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS))if(s=this._gl.getShaderInfoLog(r))throw new Error("VERTEX SHADER "+s);if(!this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS))if(s=this._gl.getShaderInfoLog(i))throw new Error("FRAGMENT SHADER "+s);if(o=t.getProgramInfoLog(n))throw new Error(o)}if(this.validateShaderPrograms&&(t.validateProgram(n),!t.getProgramParameter(n,t.VALIDATE_STATUS)&&(o=t.getProgramInfoLog(n))))throw new Error(o);t.deleteShader(r),t.deleteShader(i),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},e.prototype._preparePipelineContext=function(e,t,r,i,n,s,o){var a=e;a.program=i?this.createRawShaderProgram(a,t,r,void 0,o):this.createShaderProgram(a,t,r,s,void 0,o),a.program.__SPECTOR_rebuildProgram=n},e.prototype._isRenderingStateCompiled=function(e){var t=e;return!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0)},e.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var r=e;r.isParallelCompiled?r.onCompiled=t:t()},e.prototype.getUniforms=function(e,t){for(var r=new Array,i=e,n=0;n<t.length;n++)r.push(this._gl.getUniformLocation(i.program,t[n]));return r},e.prototype.getAttributes=function(e,t){for(var r=[],i=e,n=0;n<t.length;n++)try{r.push(this._gl.getAttribLocation(i.program,t[n]))}catch(e){r.push(-1)}return r},e.prototype.enableEffect=function(e){e&&e!==this._currentEffect&&(this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},e.prototype.setIntArray=function(e,t){e&&this._gl.uniform1iv(e,t)},e.prototype.setIntArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2iv(e,t)},e.prototype.setIntArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3iv(e,t)},e.prototype.setIntArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4iv(e,t)},e.prototype.setFloatArray=function(e,t){e&&this._gl.uniform1fv(e,t)},e.prototype.setFloatArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},e.prototype.setFloatArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},e.prototype.setFloatArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},e.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},e.prototype.setArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},e.prototype.setArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},e.prototype.setArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},e.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},e.prototype.setMatrix3x3=function(e,t){e&&this._gl.uniformMatrix3fv(e,!1,t)},e.prototype.setMatrix2x2=function(e,t){e&&this._gl.uniformMatrix2fv(e,!1,t)},e.prototype.setInt=function(e,t){e&&this._gl.uniform1i(e,t)},e.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},e.prototype.setFloat2=function(e,t,r){e&&this._gl.uniform2f(e,t,r)},e.prototype.setFloat3=function(e,t,r,i){e&&this._gl.uniform3f(e,t,r,i)},e.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},e.prototype.setFloat4=function(e,t,r,i,n){e&&this._gl.uniform4f(e,t,r,i,n)},e.prototype.setDirectColor4=function(e,t){e&&this._gl.uniform4f(e,t.r,t.g,t.b,t.a)},Object.defineProperty(e.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!0,configurable:!0}),e.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},e.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,e&&(this.resetTextureCache(),this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0)),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this._unbindVertexArrayObject(),this.bindIndexBuffer(null))},e.prototype._getSamplingParameters=function(e,t){var r=this._gl,n=r.NEAREST,s=r.NEAREST;switch(e){case i.TEXTURE_BILINEAR_SAMPLINGMODE:n=r.LINEAR,s=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case i.TEXTURE_TRILINEAR_SAMPLINGMODE:n=r.LINEAR,s=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case i.TEXTURE_NEAREST_SAMPLINGMODE:n=r.NEAREST,s=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case i.TEXTURE_NEAREST_NEAREST_MIPNEAREST:n=r.NEAREST,s=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case i.TEXTURE_NEAREST_LINEAR_MIPNEAREST:n=r.NEAREST,s=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case i.TEXTURE_NEAREST_LINEAR_MIPLINEAR:n=r.NEAREST,s=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case i.TEXTURE_NEAREST_LINEAR:n=r.NEAREST,s=r.LINEAR;break;case i.TEXTURE_NEAREST_NEAREST:n=r.NEAREST,s=r.NEAREST;break;case i.TEXTURE_LINEAR_NEAREST_MIPNEAREST:n=r.LINEAR,s=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case i.TEXTURE_LINEAR_NEAREST_MIPLINEAR:n=r.LINEAR,s=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case i.TEXTURE_LINEAR_LINEAR:n=r.LINEAR,s=r.LINEAR;break;case i.TEXTURE_LINEAR_NEAREST:n=r.LINEAR,s=r.NEAREST}return{min:s,mag:n}},e.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},e.prototype.createTexture=function(t,r,n,s,o,a,u,h,l,_,c,f){var p=this;void 0===o&&(o=i.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===l&&(l=null),void 0===_&&(_=null),void 0===c&&(c=null),void 0===f&&(f=[]);for(var d=String(t),E="data:"===d.substr(0,5),T="blob:"===d.substr(0,5),g=E&&-1!==d.indexOf(";base64,"),R=l||new ue(this,F.Url),y=d.lastIndexOf("."),m=c||(y>-1?d.substring(y).toLowerCase():""),A=null,b=0,x=e._TextureLoaders;b<x.length;b++){var v=x[b];if(-1===f.indexOf(v)&&v.canLoad(m,this._textureFormatInUse,l,g,!!h)){A=v;break}}A&&(d=A.transformUrl(d,this._textureFormatInUse)),s&&s._addPendingData(R),R.url=d,R.generateMipMaps=!r,R.samplingMode=o,R.invertY=n,this._doNotHandleContextLost||(R._buffer=h);var S=null;a&&!l&&(S=R.onLoadedObservable.add(a)),l||this._internalTexturesCache.push(R);var O=function(e,i){s&&s._removePendingData(R);var n=!1;if(A&&A.getFallbackTextureUrl(d,p._textureFormatInUse))return n=!0,f.push(A),void p.createTexture(t,r,R.invertY,s,o,null,u,h,R,void 0,void 0,f);n||(S&&R.onLoadedObservable.remove(S),!U.UseFallbackTexture)?u&&u(e||"Unknown error",i):p.createTexture(U.FallbackTexture,r,R.invertY,s,o,null,u,h,R)};if(A){var I=function(e){A.loadData(e,R,function(e,t,r,i,n,a){a?O("TextureLoader failed to load data"):p._prepareWebGLTexture(R,s,e,t,R.invertY,!r,i,function(){return n(),!1},o)})};h?h instanceof ArrayBuffer?I(h):u&&u("Unable to load: only ArrayBuffer supported here",null):this._loadFile(d,I,void 0,s?s.offlineProvider:void 0,!0,function(e,t){O("Unable to load "+(e&&e.responseURL,t))})}else{var M=function(e){T&&!p._doNotHandleContextLost&&(R._buffer=e),p._prepareWebGLTexture(R,s,e.width,e.height,R.invertY,r,!1,function(t,r,i){var n=p._gl,o=e.width===t&&e.height===r,a=_?p._getInternalFormat(_):".jpg"===m?n.RGB:n.RGBA;if(o)return n.texImage2D(n.TEXTURE_2D,0,a,a,n.UNSIGNED_BYTE,e),!1;var u=p._caps.maxTextureSize;if(e.width>u||e.height>u||!p._supportsHardwareTextureRescaling)return p._prepareWorkingCanvas(),!(!p._workingCanvas||!p._workingContext)&&(p._workingCanvas.width=t,p._workingCanvas.height=r,p._workingContext.drawImage(e,0,0,e.width,e.height,0,0,t,r),n.texImage2D(n.TEXTURE_2D,0,a,a,n.UNSIGNED_BYTE,p._workingCanvas),R.width=t,R.height=r,!1);var h=new ue(p,F.Temp);return p._bindTextureDirectly(n.TEXTURE_2D,h,!0),n.texImage2D(n.TEXTURE_2D,0,a,a,n.UNSIGNED_BYTE,e),p._rescaleTexture(h,R,s,a,function(){p._releaseTexture(h),p._bindTextureDirectly(n.TEXTURE_2D,R,!0),i()}),!0},o)};!E||g?h instanceof HTMLImageElement?M(h):ee.LoadImage(d,M,O,s?s.offlineProvider:null):"string"==typeof h||h instanceof ArrayBuffer||ArrayBuffer.isView(h)||h instanceof Blob?ee.LoadImage(h,M,O,s?s.offlineProvider:null):h&&M(h)}return R},e.prototype._rescaleTexture=function(e,t,r,i,n){},e.prototype.createRawTexture=function(e,t,r,n,s,o,a,u,h){throw void 0===u&&(u=null),void 0===h&&(h=i.TEXTURETYPE_UNSIGNED_INT),R.WarnImport("Engine.RawTexture")},e.prototype.createRawCubeTexture=function(e,t,r,i,n,s,o,a){throw void 0===a&&(a=null),R.WarnImport("Engine.RawTexture")},e.prototype.createRawTexture3D=function(e,t,r,n,s,o,a,u,h,l){throw void 0===h&&(h=null),void 0===l&&(l=i.TEXTURETYPE_UNSIGNED_INT),R.WarnImport("Engine.RawTexture")},e.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},e.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},e.prototype.updateTextureSamplingMode=function(e,t){var r=this._getSamplingParameters(e,t.generateMipMaps);t.isCube?(this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,r.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,r.min),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):t.is3D?(this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,r.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,r.min),this._bindTextureDirectly(this._gl.TEXTURE_3D,null)):(this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,r.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,r.min),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t.samplingMode=e},e.prototype.updateTextureComparisonFunction=function(e,t){if(1!==this.webGLVersion){var r=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,i.LEQUAL),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,t),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,i.LEQUAL),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}else G.Error("WebGL 1 does not support texture comparison.")},e.prototype._setupDepthStencilTexture=function(e,t,r,n,s){var o=t.width||t,a=t.height||t;e.baseWidth=o,e.baseHeight=a,e.width=o,e.height=a,e.isReady=!0,e.samples=1,e.generateMipMaps=!1,e._generateDepthBuffer=!0,e._generateStencilBuffer=r,e.samplingMode=n?i.TEXTURE_BILINEAR_SAMPLINGMODE:i.TEXTURE_NEAREST_SAMPLINGMODE,e.type=i.TEXTURETYPE_UNSIGNED_INT,e._comparisonFunction=s;var u=this._gl,h=e.isCube?u.TEXTURE_CUBE_MAP:u.TEXTURE_2D,l=this._getSamplingParameters(e.samplingMode,!1);u.texParameteri(h,u.TEXTURE_MAG_FILTER,l.mag),u.texParameteri(h,u.TEXTURE_MIN_FILTER,l.min),u.texParameteri(h,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(h,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),0===s?(u.texParameteri(h,u.TEXTURE_COMPARE_FUNC,i.LEQUAL),u.texParameteri(h,u.TEXTURE_COMPARE_MODE,u.NONE)):(u.texParameteri(h,u.TEXTURE_COMPARE_FUNC,s),u.texParameteri(h,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE))},e.prototype.createDepthStencilTexture=function(e,t){if(t.isCube){var r=e.width||e;return this._createDepthStencilCubeTexture(r,t)}return this._createDepthStencilTexture(e,t)},e.prototype._createDepthStencilTexture=function(e,t){var r=new ue(this,F.Depth);if(!this._caps.depthTextureExtension)return G.Error("Depth texture is not supported by your browser or hardware."),r;var i=o({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t),n=this._gl;return this._bindTextureDirectly(n.TEXTURE_2D,r,!0),this._setupDepthStencilTexture(r,e,i.generateStencil,i.bilinearFiltering,i.comparisonFunction),this.webGLVersion>1?i.generateStencil?n.texImage2D(n.TEXTURE_2D,0,n.DEPTH24_STENCIL8,r.width,r.height,0,n.DEPTH_STENCIL,n.UNSIGNED_INT_24_8,null):n.texImage2D(n.TEXTURE_2D,0,n.DEPTH_COMPONENT24,r.width,r.height,0,n.DEPTH_COMPONENT,n.UNSIGNED_INT,null):i.generateStencil?n.texImage2D(n.TEXTURE_2D,0,n.DEPTH_STENCIL,r.width,r.height,0,n.DEPTH_STENCIL,n.UNSIGNED_INT_24_8,null):n.texImage2D(n.TEXTURE_2D,0,n.DEPTH_COMPONENT,r.width,r.height,0,n.DEPTH_COMPONENT,n.UNSIGNED_INT,null),this._bindTextureDirectly(n.TEXTURE_2D,null),r},e.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,i,n,s,o){void 0===s&&(s=0),void 0===o&&(o=0);var a=this._gl,u=a.TEXTURE_2D;e.isCube&&(u=a.TEXTURE_CUBE_MAP_POSITIVE_X+s),this._gl.compressedTexImage2D(u,o,t,r,i,0,n)},e.prototype._uploadDataToTextureDirectly=function(e,t,r,i,n,s){void 0===r&&(r=0),void 0===i&&(i=0),void 0===s&&(s=!1);var o=this._gl,a=this._getWebGLTextureType(e.type),u=this._getInternalFormat(e.format),h=void 0===n?this._getRGBABufferInternalSizedFormat(e.type,u):this._getInternalFormat(n);this._unpackFlipY(e.invertY);var l=o.TEXTURE_2D;e.isCube&&(l=o.TEXTURE_CUBE_MAP_POSITIVE_X+r);var _=Math.round(Math.log(e.width)*Math.LOG2E),c=Math.round(Math.log(e.height)*Math.LOG2E),f=s?e.width:Math.pow(2,Math.max(_-i,0)),p=s?e.height:Math.pow(2,Math.max(c-i,0));o.texImage2D(l,i,h,f,p,0,u,a,t)},e.prototype._uploadArrayBufferViewToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,s=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(s,e,!0),this._uploadDataToTextureDirectly(e,t,r,i),this._bindTextureDirectly(s,null,!0)},e.prototype._uploadImageToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,s=this._getWebGLTextureType(e.type),o=this._getInternalFormat(e.format),a=this._getRGBABufferInternalSizedFormat(e.type,o),u=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(u,e,!0),this._unpackFlipY(e.invertY);var h=n.TEXTURE_2D;e.isCube&&(h=n.TEXTURE_CUBE_MAP_POSITIVE_X+r),n.texImage2D(h,i,a,o,s,t),this._bindTextureDirectly(u,null,!0)},e.prototype._setCubeMapTextureParams=function(e){var t=this._gl;t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,e?t.LINEAR_MIPMAP_LINEAR:t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)},e.prototype._prepareWebGLTextureContinuation=function(e,t,r,i,n){var s=this._gl;if(s){var o=this._getSamplingParameters(n,!r);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o.min),r||i||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},e.prototype._prepareWebGLTexture=function(t,r,n,s,o,a,u,h,l){var _=this;void 0===l&&(l=i.TEXTURE_TRILINEAR_SAMPLINGMODE);var c=this.getCaps().maxTextureSize,f=Math.min(c,this.needPOTTextures?e.GetExponentOfTwo(n,c):n),p=Math.min(c,this.needPOTTextures?e.GetExponentOfTwo(s,c):s),d=this._gl;d&&(t._webGLTexture?(this._bindTextureDirectly(d.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===o||!!o),t.baseWidth=n,t.baseHeight=s,t.width=f,t.height=p,t.isReady=!0,h(f,p,function(){_._prepareWebGLTextureContinuation(t,r,a,u,l)})||this._prepareWebGLTextureContinuation(t,r,a,u,l)):r&&r._removePendingData(t))},e.prototype._setupFramebufferDepthAttachments=function(e,t,r,i,n){void 0===n&&(n=1);var s=null,o=this._gl;return e?(s=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,s),n>1?o.renderbufferStorageMultisample(o.RENDERBUFFER,n,o.DEPTH24_STENCIL8,r,i):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,r,i),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,s)):t&&(s=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,s),n>1?o.renderbufferStorageMultisample(o.RENDERBUFFER,n,o.DEPTH_COMPONENT16,r,i):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,r,i),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,s)),s},e.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},e.prototype._releaseTexture=function(e){this._releaseFramebufferObjects(e),this._deleteTexture(e._webGLTexture),this.unbindAllTextures();var t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()},e.prototype._deleteTexture=function(e){this._gl.deleteTexture(e)},e.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},e.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var r=e.getSamplers(),i=0;i<r.length;i++){var n=e.getUniform(r[i]);n&&(this._boundUniforms[i]=n)}this._currentEffect=null},e.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},e.prototype._bindTextureDirectly=function(e,t,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1);var n=!1,s=t&&t._associatedChannel>-1;return r&&s&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||i?(this._activateCurrentTexture(),t&&t.isMultiview?this._gl.bindTexture(e,t?t._colorTextureArray:null):this._gl.bindTexture(e,t?t._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)):r&&(n=!0,this._activateCurrentTexture()),s&&!r&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),n},e.prototype._bindTexture=function(e,t){void 0!==e&&(t&&(t._associatedChannel=e),this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,t))},e.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)},e.prototype.setTexture=function(e,t,r){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,r))},e.prototype._bindSamplerUniformToChannel=function(e,t){var r=this._boundUniforms[e];r&&r._currentState!==t&&(this._gl.uniform1i(r,t),r._currentState=t)},e.prototype._getTextureWrapMode=function(e){switch(e){case i.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case i.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case i.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},e.prototype._setTexture=function(e,t,r,n){if(void 0===r&&(r=!1),void 0===n&&(n=!1),!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)),!1;if(t.video)this._activeChannel=e,t.update();else if(t.delayLoadState===i.DELAYLOADSTATE_NOTLOADED)return t.delayLoad(),!1;var s;s=n?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:this.emptyTexture,!r&&s&&(s._associatedChannel=e);var o=!0;if(this._boundTexturesCache[e]===s&&(r||this._bindSamplerUniformToChannel(s._associatedChannel,e),o=!1),this._activeChannel=e,s&&s.isMultiview)o&&this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,s,r);else if(s&&s.is3D)o&&this._bindTextureDirectly(this._gl.TEXTURE_3D,s,r),s&&s._cachedWrapU!==t.wrapU&&(s._cachedWrapU=t.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),s)),s&&s._cachedWrapV!==t.wrapV&&(s._cachedWrapV=t.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),s)),s&&s._cachedWrapR!==t.wrapR&&(s._cachedWrapR=t.wrapR,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),s)),this._setAnisotropicLevel(this._gl.TEXTURE_3D,t);else if(s&&s.isCube){if(o&&this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,s,r),s._cachedCoordinatesMode!==t.coordinatesMode){s._cachedCoordinatesMode=t.coordinatesMode;var a=t.coordinatesMode!==i.TEXTURE_CUBIC_MODE&&t.coordinatesMode!==i.TEXTURE_SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,a,s),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,a)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,t)}else o&&this._bindTextureDirectly(this._gl.TEXTURE_2D,s,r),s&&s._cachedWrapU!==t.wrapU&&(s._cachedWrapU=t.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),s)),s&&s._cachedWrapV!==t.wrapV&&(s._cachedWrapV=t.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),s)),this._setAnisotropicLevel(this._gl.TEXTURE_2D,t);return!0},e.prototype.setTextureArray=function(e,t,r){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===r.length||(this._textureUnits=new Int32Array(r.length));for(var i=0;i<r.length;i++){var n=r[i].getInternalTexture();n?(this._textureUnits[i]=e+i,n._associatedChannel=e+i):this._textureUnits[i]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var s=0;s<r.length;s++)this._setTexture(this._textureUnits[s],r[s],!0)}},e.prototype._setAnisotropicLevel=function(e,t){var r=t.getInternalTexture();if(r){var n=this._caps.textureAnisotropicFilterExtension,s=t.anisotropicFilteringLevel;r.samplingMode!==i.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&r.samplingMode!==i.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&r.samplingMode!==i.TEXTURE_LINEAR_LINEAR&&(s=1),n&&r._cachedAnisotropicFilteringLevel!==s&&(this._setTextureParameterFloat(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s,this._caps.maxAnisotropy),r),r._cachedAnisotropicFilteringLevel=s)}},e.prototype._setTextureParameterFloat=function(e,t,r,i){this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameterf(e,t,r)},e.prototype._setTextureParameterInteger=function(e,t,r,i){i&&this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameteri(e,t,r)},e.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||(this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1)}},e.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},e.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],B.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._bindedRenderFunction=null,re.ResetCache();for(var e=0,t=this._activeRequests;e<t.length;e++){t[e].abort()}},e.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},e.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},e.prototype.getError=function(){return this._gl.getError()},e.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(i.TEXTURETYPE_FLOAT)},e.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(i.TEXTURETYPE_HALF_FLOAT)},e.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var r=!0,i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);var s=t.checkFramebufferStatus(t.FRAMEBUFFER);if((r=(r=r&&s===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),r=r&&t.getError()===t.NO_ERROR),r){t.bindFramebuffer(t.FRAMEBUFFER,null);var o=t.RGBA,a=t.UNSIGNED_BYTE,u=new Uint8Array(4);t.readPixels(0,0,1,1,o,a,u),r=r&&t.getError()===t.NO_ERROR}for(t.deleteTexture(i),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!r&&t.getError()!==t.NO_ERROR;);return r},e.prototype._getWebGLTextureType=function(e){if(1===this._webGLVersion){switch(e){case i.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case i.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case i.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case i.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case i.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case i.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case i.TEXTURETYPE_BYTE:return this._gl.BYTE;case i.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case i.TEXTURETYPE_SHORT:return this._gl.SHORT;case i.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case i.TEXTURETYPE_INT:return this._gl.INT;case i.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case i.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case i.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case i.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case i.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case i.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case i.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case i.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case i.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case i.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case i.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},e.prototype._getInternalFormat=function(e){var t=this._gl.RGBA;switch(e){case i.TEXTUREFORMAT_ALPHA:t=this._gl.ALPHA;break;case i.TEXTUREFORMAT_LUMINANCE:t=this._gl.LUMINANCE;break;case i.TEXTUREFORMAT_LUMINANCE_ALPHA:t=this._gl.LUMINANCE_ALPHA;break;case i.TEXTUREFORMAT_RED:t=this._gl.RED;break;case i.TEXTUREFORMAT_RG:t=this._gl.RG;break;case i.TEXTUREFORMAT_RGB:t=this._gl.RGB;break;case i.TEXTUREFORMAT_RGBA:t=this._gl.RGBA}if(this._webGLVersion>1)switch(e){case i.TEXTUREFORMAT_RED_INTEGER:t=this._gl.RED_INTEGER;break;case i.TEXTUREFORMAT_RG_INTEGER:t=this._gl.RG_INTEGER;break;case i.TEXTUREFORMAT_RGB_INTEGER:t=this._gl.RGB_INTEGER;break;case i.TEXTUREFORMAT_RGBA_INTEGER:t=this._gl.RGBA_INTEGER}return t},e.prototype._getRGBABufferInternalSizedFormat=function(e,t){if(1===this._webGLVersion){if(void 0!==t)switch(t){case i.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case i.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case i.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA}return this._gl.RGBA}switch(e){case i.TEXTURETYPE_BYTE:switch(t){case i.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case i.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case i.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case i.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case i.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case i.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case i.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case i.TEXTURETYPE_UNSIGNED_BYTE:switch(t){case i.TEXTUREFORMAT_RED:return this._gl.R8;case i.TEXTUREFORMAT_RG:return this._gl.RG8;case i.TEXTUREFORMAT_RGB:return this._gl.RGB8;case i.TEXTUREFORMAT_RGBA:return this._gl.RGBA8;case i.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case i.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case i.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case i.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;case i.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case i.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case i.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case i.TEXTURETYPE_SHORT:switch(t){case i.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case i.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case i.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case i.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16I}case i.TEXTURETYPE_UNSIGNED_SHORT:switch(t){case i.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case i.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case i.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case i.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16UI}case i.TEXTURETYPE_INT:switch(t){case i.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case i.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case i.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case i.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32I}case i.TEXTURETYPE_UNSIGNED_INTEGER:switch(t){case i.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case i.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case i.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case i.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32UI}case i.TEXTURETYPE_FLOAT:switch(t){case i.TEXTUREFORMAT_RED:return this._gl.R32F;case i.TEXTUREFORMAT_RG:return this._gl.RG32F;case i.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case i.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA32F}case i.TEXTURETYPE_HALF_FLOAT:switch(t){case i.TEXTUREFORMAT_RED:return this._gl.R16F;case i.TEXTUREFORMAT_RG:return this._gl.RG16F;case i.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case i.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA16F}case i.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case i.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case i.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case i.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case i.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case i.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(t){case i.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case i.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},e.prototype._getRGBAMultiSampleBufferFormat=function(e){return e===i.TEXTURETYPE_FLOAT?this._gl.RGBA32F:e===i.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA8},e.prototype._loadFile=function(e,t,r,i,n,s){var o=this,a=ee.LoadFile(e,t,r,i,n,s);return this._activeRequests.push(a),a.onCompleteObservable.add(function(e){o._activeRequests.splice(o._activeRequests.indexOf(e),1)}),a},e.isSupported=function(){try{var e=document.createElement("canvas");return null!=(e.getContext("webgl")||e.getContext("experimental-webgl"))&&!!window.WebGLRenderingContext}catch(e){return!1}},e.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},e.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},e.NearestPOT=function(t){var r=e.CeilingPOT(t),i=e.FloorPOT(t);return r-t>t-i?i:r},e.GetExponentOfTwo=function(t,r,n){var s;switch(void 0===n&&(n=i.SCALEMODE_NEAREST),n){case i.SCALEMODE_FLOOR:s=e.FloorPOT(t);break;case i.SCALEMODE_NEAREST:s=e.NearestPOT(t);break;case i.SCALEMODE_CEILING:default:s=e.CeilingPOT(t)}return Math.min(s,r)},e.QueueNewFrame=function(e,t){return B.IsWindowObjectExist()?(t||(t=window),t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16)):setTimeout(e,16)},e.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],e._TextureLoaders=[],e.CollisionsEpsilon=.001,e}();fe.prototype.createDynamicTexture=function(e,t,r,i){var n=new ue(this,F.Dynamic);return n.baseWidth=e,n.baseHeight=t,r&&(e=this.needPOTTextures?fe.GetExponentOfTwo(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?fe.GetExponentOfTwo(t,this._caps.maxTextureSize):t),n.width=e,n.height=t,n.isReady=!1,n.generateMipMaps=r,n.samplingMode=i,this.updateTextureSamplingMode(i,n),this._internalTexturesCache.push(n),n},fe.prototype.updateDynamicTexture=function(e,t,r,i,n,s){if(void 0===i&&(i=!1),void 0===s&&(s=!1),e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0,s),this._unpackFlipY(r),i&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var o=n?this._getInternalFormat(n):this._gl.RGBA;this._gl.texImage2D(this._gl.TEXTURE_2D,0,o,o,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),i&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.isReady=!0}},fe.prototype.updateVideoTexture=function(e,t,r){if(e&&!e._isDisabled){var i=this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0);this._unpackFlipY(!r);try{if(void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);else{if(!e._workingCanvas){e._workingCanvas=document.createElement("canvas");var n=e._workingCanvas.getContext("2d");if(!n)throw new Error("Unable to get 2d context");e._workingContext=n,e._workingCanvas.width=e.width,e._workingCanvas.height=e.height}e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e.width,e.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)}e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),i||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}catch(t){e._isDisabled=!0}}};var pe=function(e){function t(r,i,n){var s=e.call(this,n.scene)||this;return i&&(n.engine||n.scene)?(n=o({},t.DefaultOptions,n),s._engine=n.engine||n.scene.getEngine(),s._generateMipMaps=n.generateMipMaps,s._samplingMode=n.samplingMode,s._textureMatrix=T.Identity(),s.name=r,s.element=i,s._isVideo=i instanceof HTMLVideoElement,s.anisotropicFilteringLevel=1,s._createInternalTexture(),s):s}return s(t,e),t.prototype._createInternalTexture=function(){var e=0,t=0;this._isVideo?(e=this.element.videoWidth,t=this.element.videoHeight):(e=this.element.width,t=this.element.height),this._texture=this._engine.createDynamicTexture(e,t,this._generateMipMaps,this._samplingMode),this.update()},t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype.update=function(e){if(void 0===e&&(e=null),null!=this._texture)if(this._isVideo){var t=this.element;if(t.readyState<t.HAVE_CURRENT_DATA)return;this._engine.updateVideoTexture(this._texture,t,null===e||e)}else{var r=this.element;this._engine.updateDynamicTexture(this._texture,r,null===e||e,!1)}},t.DefaultOptions={generateMipMaps:!1,samplingMode:i.TEXTURE_BILINEAR_SAMPLINGMODE,engine:null,scene:null},t}(w),de=function(){function e(){}return e.SetImmediate=function(e){B.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)},e}(),Ee=function(){function e(){}return e.Instantiate=function(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];var t=c.GetClass(e);if(t)return t;G.Warn(e+" not found, you may have missed an import.");for(var r=e.split("."),i=window||this,n=0,s=r.length;n<s;n++)i=i[r[n]];return"function"!=typeof i?null:i},e.RegisteredExternalClasses={},e}(),Te=function(){function e(e,t,r,i){this.normal=new p(e,t,r),this.d=i}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.getClassName=function(){return"Plane"},e.prototype.getHashCode=function(){var e=this.normal.getHashCode();return e=397*e^(0|this.d)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var r=e._TmpMatrix;T.TransposeToRef(t,r);var i=r.m,n=this.normal.x,s=this.normal.y,o=this.normal.z,a=this.d;return new e(n*i[0]+s*i[1]+o*i[2]+a*i[3],n*i[4]+s*i[5]+o*i[6]+a*i[7],n*i[8]+s*i[9]+o*i[10]+a*i[11],n*i[12]+s*i[13]+o*i[14]+a*i[15])},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,r){var i,n=t.x-e.x,s=t.y-e.y,o=t.z-e.z,a=r.x-e.x,u=r.y-e.y,h=r.z-e.z,l=s*h-o*u,_=o*a-n*h,c=n*u-s*a,f=Math.sqrt(l*l+_*_+c*c);return i=0!==f?1/f:0,this.normal.x=l*i,this.normal.y=_*i,this.normal.z=c*i,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){return p.Dot(this.normal,e)<=t},e.prototype.signedDistanceTo=function(e){return p.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,r,i){var n=new e(0,0,0,0);return n.copyFromPoints(t,r,i),n},e.FromPositionAndNormal=function(t,r){var i=new e(0,0,0,0);return r.normalize(),i.normal=r,i.d=-(r.x*t.x+r.y*t.y+r.z*t.z),i},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,r){var i=-(t.x*e.x+t.y*e.y+t.z*e.z);return p.Dot(r,t)+i},e._TmpMatrix=T.Identity(),e}(),ge=function(e){function t(r,n,s,o,a,u,h,l,_,c){void 0===s&&(s=!1),void 0===o&&(o=!0),void 0===a&&(a=t.TRILINEAR_SAMPLINGMODE),void 0===u&&(u=null),void 0===h&&(h=null),void 0===l&&(l=null),void 0===_&&(_=!1);var f=e.call(this,n&&"Scene"===n.getClassName()?n:null)||this;f.url=null,f.uOffset=0,f.vOffset=0,f.uScale=1,f.vScale=1,f.uAng=0,f.vAng=0,f.wAng=0,f.uRotationCenter=.5,f.vRotationCenter=.5,f.wRotationCenter=.5,f.inspectableCustomProperties=null,f._noMipmap=!1,f._invertY=!1,f._rowGenerationMatrix=null,f._cachedTextureMatrix=null,f._projectionModeMatrix=null,f._t0=null,f._t1=null,f._t2=null,f._cachedUOffset=-1,f._cachedVOffset=-1,f._cachedUScale=0,f._cachedVScale=0,f._cachedUAng=-1,f._cachedVAng=-1,f._cachedWAng=-1,f._cachedProjectionMatrixId=-1,f._cachedCoordinatesMode=-1,f._initialSamplingMode=t.BILINEAR_SAMPLINGMODE,f._buffer=null,f._deleteBuffer=!1,f._format=null,f._delayedOnLoad=null,f._delayedOnError=null,f.onLoadObservable=new N,f._isBlocking=!0,f.name=r||"",f.url=r,f._noMipmap=s,f._invertY=o,f._initialSamplingMode=a,f._buffer=l,f._deleteBuffer=_,c&&(f._format=c);var p=f.getScene(),d=n&&n.getCaps?n:p?p.getEngine():null;if(!d)return f;d.onBeforeTextureInitObservable.notifyObservers(f);var E=function(){f._texture&&(f._texture._invertVScale&&(f.vScale*=-1,f.vOffset+=1),null!==f._texture._cachedWrapU&&(f.wrapU=f._texture._cachedWrapU,f._texture._cachedWrapU=null),null!==f._texture._cachedWrapV&&(f.wrapV=f._texture._cachedWrapV,f._texture._cachedWrapV=null),null!==f._texture._cachedWrapR&&(f.wrapR=f._texture._cachedWrapR,f._texture._cachedWrapR=null)),f.onLoadObservable.hasObservers()&&f.onLoadObservable.notifyObservers(f),u&&u(),!f.isBlocking&&p&&p.resetCachedMaterial()};return f.url?(f._texture=f._getFromCache(f.url,s,a,o),f._texture?f._texture.isReady?de.SetImmediate(function(){return E()}):f._texture.onLoadedObservable.add(E):p&&p.useDelayedTextureLoading?(f.delayLoadState=i.DELAYLOADSTATE_NOTLOADED,f._delayedOnLoad=E,f._delayedOnError=h):(f._texture=d.createTexture(f.url,s,o,p,a,E,h,f._buffer,void 0,f._format),_&&delete f._buffer),f):(f._delayedOnLoad=E,f._delayedOnError=h,f)}return s(t,e),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"invertY",{get:function(){return this._invertY},enumerable:!0,configurable:!0}),t.prototype.updateURL=function(e,t,r){void 0===t&&(t=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(i.MATERIAL_TextureDirtyFlag)),this.name=e,this.url=e,this._buffer=t,this.delayLoadState=i.DELAYLOADSTATE_NOTLOADED,r&&(this._delayedOnLoad=r),this.delayLoad()},t.prototype.delayLoad=function(){if(this.delayLoadState===i.DELAYLOADSTATE_NOTLOADED){var e=this.getScene();e&&(this.delayLoadState=i.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY),this._texture?this._delayedOnLoad&&(this._texture.isReady?de.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format),this._deleteBuffer&&delete this._buffer),this._delayedOnLoad=null,this._delayedOnError=null)}},t.prototype._prepareRowForTextureGeneration=function(e,t,r,i){e*=this.uScale,t*=this.vScale,e-=this.uRotationCenter*this.uScale,t-=this.vRotationCenter*this.vScale,r-=this.wRotationCenter,p.TransformCoordinatesFromFloatsToRef(e,t,r,this._rowGenerationMatrix,i),i.x+=this.uRotationCenter*this.uScale+this.uOffset,i.y+=this.vRotationCenter*this.vScale+this.vOffset,i.z+=this.wRotationCenter},t.prototype.getTextureMatrix=function(){var e=this;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=T.Zero(),this._rowGenerationMatrix=new T,this._t0=p.Zero(),this._t1=p.Zero(),this._t2=p.Zero()),T.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),T.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix);var t=this.getScene();return t?(t.markAllMaterialsAsDirty(i.MATERIAL_TextureDirtyFlag,function(t){return t.hasTexture(e)}),this._cachedTextureMatrix):this._cachedTextureMatrix},t.prototype.getReflectionTextureMatrix=function(){var e=this,r=this.getScene();if(!r)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==t.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===r.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=T.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=T.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case t.PLANAR_MODE:T.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case t.PROJECTION_MODE:T.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var n=r.getProjectionMatrix();this._cachedProjectionMatrixId=n.updateFlag,n.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:T.IdentityToRef(this._cachedTextureMatrix)}return r.markAllMaterialsAsDirty(i.MATERIAL_TextureDirtyFlag,function(t){return-1!==t.getActiveTextures().indexOf(e)}),this._cachedTextureMatrix},t.prototype.clone=function(){var e=this;return M.Clone(function(){return new t(e._texture?e._texture.url:null,e.getScene(),e._noMipmap,e._invertY,e.samplingMode,void 0,void 0,e._texture?e._texture._buffer:void 0)},this)},t.prototype.serialize=function(){var r=this.name;t.SerializeBuffers||X.StartsWith(this.name,"data:")&&(this.name="");var i=e.prototype.serialize.call(this);return i?(t.SerializeBuffers&&"string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)&&(i.base64String=this._buffer,i.name=i.name.replace("data:","")),i.invertY=this._invertY,i.samplingMode=this.samplingMode,this.name=r,i):null},t.prototype.getClassName=function(){return"Texture"},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},t.Parse=function(e,r,i){if(e.customType){var n=Ee.Instantiate(e.customType).Parse(e,r,i);return e.samplingMode&&n.updateSamplingMode&&n._samplingMode&&n._samplingMode!==e.samplingMode&&n.updateSamplingMode(e.samplingMode),n}if(e.isCube&&!e.isRenderTarget)return t._CubeTextureParser(e,r,i);if(!e.name&&!e.isRenderTarget)return null;var s=M.Parse(function(){var n,s=!0;if(e.noMipmap&&(s=!1),e.mirrorPlane){var o=t._CreateMirror(e.name,e.renderTargetSize,r,s);return o._waitingRenderList=e.renderList,o.mirrorPlane=Te.FromArray(e.mirrorPlane),o}if(e.isRenderTarget){var a=null;if(e.isCube){if(r.reflectionProbes)for(var u=0;u<r.reflectionProbes.length;u++){var h=r.reflectionProbes[u];if(h.name===e.name)return h.cubeTexture}}else(a=t._CreateRenderTargetTexture(e.name,e.renderTargetSize,r,s))._waitingRenderList=e.renderList;return a}if(e.base64String)n=t.CreateFromBase64String(e.base64String,e.name,r,!s);else{var l=i+e.name;t.UseSerializedUrlIfAny&&e.url&&(l=e.url),n=new t(l,r,!s,e.invertY)}return n},e,r);if(s&&s._texture&&(s._texture._cachedWrapU=null,s._texture._cachedWrapV=null,s._texture._cachedWrapR=null),e.samplingMode){var o=e.samplingMode;s&&s.samplingMode!==o&&s.updateSamplingMode(o)}if(s&&e.animations)for(var a=0;a<e.animations.length;a++){var u=e.animations[a],h=c.GetClass("BABYLON.Animation");h&&s.animations.push(h.Parse(u))}return s},t.CreateFromBase64String=function(e,r,n,s,o,a,u,h,l){return void 0===a&&(a=t.TRILINEAR_SAMPLINGMODE),void 0===u&&(u=null),void 0===h&&(h=null),void 0===l&&(l=i.TEXTUREFORMAT_RGBA),new t("data:"+r,n,s,o,a,u,h,e,!1,l)},t.LoadFromDataString=function(e,r,n,s,o,a,u,h,l,_){return void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===a&&(a=!0),void 0===u&&(u=t.TRILINEAR_SAMPLINGMODE),void 0===h&&(h=null),void 0===l&&(l=null),void 0===_&&(_=i.TEXTUREFORMAT_RGBA),"data:"!==e.substr(0,5)&&(e="data:"+e),new t(e,n,o,a,u,h,l,r,s,_)},t.SerializeBuffers=!0,t._CubeTextureParser=function(e,t,r){throw R.WarnImport("CubeTexture")},t._CreateMirror=function(e,t,r,i){throw R.WarnImport("MirrorTexture")},t._CreateRenderTargetTexture=function(e,t,r,i){throw R.WarnImport("RenderTargetTexture")},t.NEAREST_SAMPLINGMODE=i.TEXTURE_NEAREST_SAMPLINGMODE,t.NEAREST_NEAREST_MIPLINEAR=i.TEXTURE_NEAREST_NEAREST_MIPLINEAR,t.BILINEAR_SAMPLINGMODE=i.TEXTURE_BILINEAR_SAMPLINGMODE,t.LINEAR_LINEAR_MIPNEAREST=i.TEXTURE_LINEAR_LINEAR_MIPNEAREST,t.TRILINEAR_SAMPLINGMODE=i.TEXTURE_TRILINEAR_SAMPLINGMODE,t.LINEAR_LINEAR_MIPLINEAR=i.TEXTURE_LINEAR_LINEAR_MIPLINEAR,t.NEAREST_NEAREST_MIPNEAREST=i.TEXTURE_NEAREST_NEAREST_MIPNEAREST,t.NEAREST_LINEAR_MIPNEAREST=i.TEXTURE_NEAREST_LINEAR_MIPNEAREST,t.NEAREST_LINEAR_MIPLINEAR=i.TEXTURE_NEAREST_LINEAR_MIPLINEAR,t.NEAREST_LINEAR=i.TEXTURE_NEAREST_LINEAR,t.NEAREST_NEAREST=i.TEXTURE_NEAREST_NEAREST,t.LINEAR_NEAREST_MIPNEAREST=i.TEXTURE_LINEAR_NEAREST_MIPNEAREST,t.LINEAR_NEAREST_MIPLINEAR=i.TEXTURE_LINEAR_NEAREST_MIPLINEAR,t.LINEAR_LINEAR=i.TEXTURE_LINEAR_LINEAR,t.LINEAR_NEAREST=i.TEXTURE_LINEAR_NEAREST,t.EXPLICIT_MODE=i.TEXTURE_EXPLICIT_MODE,t.SPHERICAL_MODE=i.TEXTURE_SPHERICAL_MODE,t.PLANAR_MODE=i.TEXTURE_PLANAR_MODE,t.CUBIC_MODE=i.TEXTURE_CUBIC_MODE,t.PROJECTION_MODE=i.TEXTURE_PROJECTION_MODE,t.SKYBOX_MODE=i.TEXTURE_SKYBOX_MODE,t.INVCUBIC_MODE=i.TEXTURE_INVCUBIC_MODE,t.EQUIRECTANGULAR_MODE=i.TEXTURE_EQUIRECTANGULAR_MODE,t.FIXED_EQUIRECTANGULAR_MODE=i.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,t.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=i.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,t.CLAMP_ADDRESSMODE=i.TEXTURE_CLAMP_ADDRESSMODE,t.WRAP_ADDRESSMODE=i.TEXTURE_WRAP_ADDRESSMODE,t.MIRROR_ADDRESSMODE=i.TEXTURE_MIRROR_ADDRESSMODE,t.UseSerializedUrlIfAny=!1,a([I()],t.prototype,"url",void 0),a([I()],t.prototype,"uOffset",void 0),a([I()],t.prototype,"vOffset",void 0),a([I()],t.prototype,"uScale",void 0),a([I()],t.prototype,"vScale",void 0),a([I()],t.prototype,"uAng",void 0),a([I()],t.prototype,"vAng",void 0),a([I()],t.prototype,"wAng",void 0),a([I()],t.prototype,"uRotationCenter",void 0),a([I()],t.prototype,"vRotationCenter",void 0),a([I()],t.prototype,"wRotationCenter",void 0),a([I()],t.prototype,"isBlocking",null),t}(w);M._TextureParser=ge.Parse;var Re=function(){function e(e,t,r,i,n,s,o){void 0===i&&(i=0),void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===o&&(o=!1),e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=r,this._instanced=s,this._data=t,this.byteStride=o?i:i*Float32Array.BYTES_PER_ELEMENT,n||this.create()}return e.prototype.createVertexBuffer=function(e,t,r,i,n,s){void 0===s&&(s=!1);var o=s?t:t*Float32Array.BYTES_PER_ELEMENT,a=i?s?i:i*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new ye(this._engine,this,e,this._updatable,!0,a,void 0===n?this._instanced:n,o,r,void 0,void 0,!0)},e.prototype.isUpdatable=function(){return this._updatable},e.prototype.getData=function(){return this._data},e.prototype.getBuffer=function(){return this._buffer},e.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},e.prototype.create=function(e){void 0===e&&(e=null),!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))},e.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},e.prototype.update=function(e){this.create(e)},e.prototype.updateDirectly=function(e,t,r,i){void 0===i&&(i=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,i?t:t*Float32Array.BYTES_PER_ELEMENT,r?r*this.byteStride:void 0),this._data=null)},e.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},e}(),ye=function(){function e(t,r,i,n,s,o,a,u,h,l,_,c){if(void 0===_&&(_=!1),void 0===c&&(c=!1),r instanceof Re?(this._buffer=r,this._ownsBuffer=!1):(this._buffer=new Re(t,r,n,o,s,a,c),this._ownsBuffer=!0),this._kind=i,null==l){var f=this.getData();this.type=e.FLOAT,f instanceof Int8Array?this.type=e.BYTE:f instanceof Uint8Array?this.type=e.UNSIGNED_BYTE:f instanceof Int16Array?this.type=e.SHORT:f instanceof Uint16Array?this.type=e.UNSIGNED_SHORT:f instanceof Int32Array?this.type=e.INT:f instanceof Uint32Array&&(this.type=e.UNSIGNED_INT)}else this.type=l;var p=e.GetTypeByteLength(this.type);c?(this._size=h||(o?o/p:e.DeduceStride(i)),this.byteStride=o||this._buffer.byteStride||this._size*p,this.byteOffset=u||0):(this._size=h||o||e.DeduceStride(i),this.byteStride=o?o*p:this._buffer.byteStride||this._size*p,this.byteOffset=(u||0)*p),this.normalized=_,this._instanced=void 0!==a&&a,this._instanceDivisor=a?1:0}return Object.defineProperty(e.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,this._instanced=0!=e},enumerable:!0,configurable:!0}),e.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},e.prototype.getKind=function(){return this._kind},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},e.prototype.getData=function(){return this._buffer.getData()},e.prototype.getBuffer=function(){return this._buffer.getBuffer()},e.prototype.getStrideSize=function(){return this.byteStride/e.GetTypeByteLength(this.type)},e.prototype.getOffset=function(){return this.byteOffset/e.GetTypeByteLength(this.type)},e.prototype.getSize=function(){return this._size},e.prototype.getIsInstanced=function(){return this._instanced},e.prototype.getInstanceDivisor=function(){return this._instanceDivisor},e.prototype.create=function(e){this._buffer.create(e)},e.prototype.update=function(e){this._buffer.update(e)},e.prototype.updateDirectly=function(e,t,r){void 0===r&&(r=!1),this._buffer.updateDirectly(e,t,void 0,r)},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},e.prototype.forEach=function(t,r){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,r)},e.DeduceStride=function(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}},e.GetTypeByteLength=function(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.UNSIGNED_INT:case e.FLOAT:return 4;default:throw new Error("Invalid type '"+t+"'")}},e.ForEach=function(t,r,i,n,s,o,a,u){if(t instanceof Array)for(var h=r/4,l=i/4,_=0;_<o;_+=n){for(var c=0;c<n;c++)u(t[h+c],_+c);h+=l}else{var f=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),p=e.GetTypeByteLength(s);for(_=0;_<o;_+=n){var d=r;for(c=0;c<n;c++){u(e._GetFloatValue(f,s,d,a),_+c),d+=p}r+=i}}},e._GetFloatValue=function(t,r,i,n){switch(r){case e.BYTE:var s=t.getInt8(i);return n&&(s=Math.max(s/127,-1)),s;case e.UNSIGNED_BYTE:s=t.getUint8(i);return n&&(s/=255),s;case e.SHORT:s=t.getInt16(i,!0);return n&&(s=Math.max(s/32767,-1)),s;case e.UNSIGNED_SHORT:s=t.getUint16(i,!0);return n&&(s/=65535),s;case e.INT:return t.getInt32(i,!0);case e.UNSIGNED_INT:return t.getUint32(i,!0);case e.FLOAT:return t.getFloat32(i,!0);default:throw new Error("Invalid component type "+r)}},e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e}(),me=function(){function e(e,t,r,i){this.x=e,this.y=t,this.width=r,this.height=i}return e.prototype.toGlobal=function(t,r){return new e(this.x*t,this.y*r,this.width*t,this.height*r)},e.prototype.toGlobalToRef=function(e,t,r){return r.x=this.x*e,r.y=this.y*t,r.width=this.width*e,r.height=this.height*t,this},e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e}();fe.prototype.createRenderTargetTexture=function(e,t){var r=new ae;void 0!==t&&"object"==typeof t?(r.generateMipMaps=t.generateMipMaps,r.generateDepthBuffer=void 0===t.generateDepthBuffer||t.generateDepthBuffer,r.generateStencilBuffer=r.generateDepthBuffer&&t.generateStencilBuffer,r.type=void 0===t.type?i.TEXTURETYPE_UNSIGNED_INT:t.type,r.samplingMode=void 0===t.samplingMode?i.TEXTURE_TRILINEAR_SAMPLINGMODE:t.samplingMode,r.format=void 0===t.format?i.TEXTUREFORMAT_RGBA:t.format):(r.generateMipMaps=t,r.generateDepthBuffer=!0,r.generateStencilBuffer=!1,r.type=i.TEXTURETYPE_UNSIGNED_INT,r.samplingMode=i.TEXTURE_TRILINEAR_SAMPLINGMODE,r.format=i.TEXTUREFORMAT_RGBA),(r.type!==i.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(r.type!==i.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(r.samplingMode=i.TEXTURE_NEAREST_SAMPLINGMODE);var n=this._gl,s=new ue(this,F.RenderTarget);this._bindTextureDirectly(n.TEXTURE_2D,s,!0);var o=e.width||e,a=e.height||e,u=this._getSamplingParameters(r.samplingMode,!!r.generateMipMaps);r.type!==i.TEXTURETYPE_FLOAT||this._caps.textureFloat||(r.type=i.TEXTURETYPE_UNSIGNED_INT,G.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,u.mag),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,u.min),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(r.type,r.format),o,a,0,this._getInternalFormat(r.format),this._getWebGLTextureType(r.type),null);var h=this._currentFramebuffer,l=n.createFramebuffer();return this._bindUnboundFramebuffer(l),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s._webGLTexture,0),s._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!r.generateStencilBuffer,r.generateDepthBuffer,o,a),r.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(n.TEXTURE_2D,null),n.bindRenderbuffer(n.RENDERBUFFER,null),this._bindUnboundFramebuffer(h),s._framebuffer=l,s.baseWidth=o,s.baseHeight=a,s.width=o,s.height=a,s.isReady=!0,s.samples=1,s.generateMipMaps=!!r.generateMipMaps,s.samplingMode=r.samplingMode,s.type=r.type,s.format=r.format,s._generateDepthBuffer=r.generateDepthBuffer,s._generateStencilBuffer=!!r.generateStencilBuffer,this._internalTexturesCache.push(s),s};var Ae="\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}";re.ShadersStore.postprocessVertexShader=Ae;var be=function(){function e(t,r){var i;void 0===r&&(r=e._DefaultOptions),this.engine=t,this._ringBufferIndex=0,this._ringScreenBuffer=null,this._fullscreenViewport=new me(0,0,1,1),r=o({},e._DefaultOptions,r),this._vertexBuffers=((i={})[ye.PositionKind]=new ye(t,r.positions,ye.PositionKind,!1,!1,2),i),this._indexBuffer=t.createIndexBuffer(r.indices),t.depthCullingState.depthTest=!1,t.stencilState.stencilTest=!1}return e.prototype._getNextFrameBuffer=function(e){if(void 0===e&&(e=!0),!this._ringScreenBuffer){this._ringScreenBuffer=[];for(var t=0;t<2;t++){var r=this.engine.createRenderTargetTexture({width:this.engine.getRenderWidth(!0),height:this.engine.getRenderHeight(!0)},{generateDepthBuffer:!1,generateStencilBuffer:!1,generateMipMaps:!1,samplingMode:i.TEXTURE_NEAREST_NEAREST}),n=new ge("",null);n._texture=r,this._ringScreenBuffer.push(n)}}var s=this._ringScreenBuffer[this._ringBufferIndex];return e&&(this._ringBufferIndex=(this._ringBufferIndex+1)%2),s},e.prototype.setViewport=function(e){void 0===e&&(e=this._fullscreenViewport),this.engine.setViewport(e)},e.prototype.bindBuffers=function(e){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,e)},e.prototype.applyEffectWrapper=function(e){this.engine.enableEffect(e.effect),this.bindBuffers(e.effect),e.onApplyObservable.notifyObservers({})},e.prototype.draw=function(){this.engine.drawElementsType(i.MATERIAL_TriangleFillMode,0,6)},e.prototype.render=function(e,t){var r=this;void 0===t&&(t=null),Array.isArray(e)||(e=[e]);for(var i=0,n=e;i<n.length;i++){if(!n[i].effect.isReady())return}e.forEach(function(i,n){var s=t;0!==n&&i.effect.onBindObservable.addOnce(function(){i.effect.setTexture("textureSampler",r._getNextFrameBuffer(!1))}),s=e.length>1&&n!=e.length-1?r._getNextFrameBuffer():t,r.setViewport(),r.applyEffectWrapper(i),s&&r.engine.bindFramebuffer(s.getInternalTexture()),r.draw(),s&&r.engine.unBindFramebuffer(s.getInternalTexture())})},e.prototype.dispose=function(){this._ringScreenBuffer&&(this._ringScreenBuffer.forEach(function(e){e.dispose()}),this._ringScreenBuffer=null);var e=this._vertexBuffers[ye.PositionKind];e&&(e.dispose(),delete this._vertexBuffers[ye.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer)},e._DefaultOptions={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]},e}(),xe=function(){function e(e){var t,r=this;this.onApplyObservable=new N;var i=e.uniformNames||[];e.vertexShader?t={fragmentSource:e.fragmentShader,vertexSource:e.vertexShader,spectorName:e.name||"effectWrapper"}:(i.push("scale"),t={fragmentSource:e.fragmentShader,vertex:"postprocess",spectorName:e.name||"effectWrapper"},this.onApplyObservable.add(function(){r.effect.setFloat2("scale",1,1)})),this.effect=new re(t,e.attributeNames||["position"],i,e.samplerNames,e.engine)}return e.prototype.dispose=function(){this.effect.dispose()},e}(),ve=function(){function e(t){this.length=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)},e.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this.data[t])},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0},e.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e.prototype.contains=function(e){return-1!==this.indexOf(e)},e._GlobalId=0,e}(),Se=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._duplicateId=0,t}s(t,e),t.prototype.push=function(t){e.prototype.push.call(this,t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[this._id]=this._duplicateId},t.prototype.pushNoDuplicate=function(e){return(!e.__smartArrayFlags||e.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(e),!0)},t.prototype.reset=function(){e.prototype.reset.call(this),this._duplicateId++},t.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var r=(e.data||e)[t];this.pushNoDuplicate(r)}}}}(ve),function(){function e(){}return Object.defineProperty(e,"Now",{get:function(){return B.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!0,configurable:!0}),e}()),Oe=function(){function e(e){void 0===e&&(e=30),this._enabled=!0,this._rollingFrameTime=new Ie(e)}return e.prototype.sampleFrame=function(e){if(void 0===e&&(e=Se.Now),this._enabled){if(null!=this._lastFrameTimeMs){var t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}},Object.defineProperty(e.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!0,configurable:!0}),e.prototype.enable=function(){this._enabled=!0},e.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},e}(),Ie=function(){function e(e){this._samples=new Array(e),this.reset()}return e.prototype.add=function(e){var t;if(this.isSaturated()){var r=this._samples[this._pos];t=r-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(r-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length},e.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]},e.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},e.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},e.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},e}(),Fe=function(){function e(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!0,configurable:!0}),e.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},e.prototype.addCount=function(t,r){e.Enabled&&(this._current+=t,r&&this._fetchResult())},e.prototype.beginMonitoring=function(){e.Enabled&&(this._startMonitoringTime=Se.Now)},e.prototype.endMonitoring=function(t){if(void 0===t&&(t=!0),e.Enabled){t&&this.fetchNewFrame();var r=Se.Now;this._current=r-this._startMonitoringTime,t&&this._fetchResult()}},e.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=Se.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},e.Enabled=!0,e}(),Me=function(e){function t(r,n,s,o){void 0===o&&(o=!1);var a=e.call(this,r,n,s,o)||this;if(a.enableOfflineSupport=!1,a.disableManifestCheck=!1,a.scenes=new Array,a.onNewSceneAddedObservable=new N,a.postProcesses=new Array,a.isPointerLock=!1,a.onResizeObservable=new N,a.onCanvasBlurObservable=new N,a.onCanvasFocusObservable=new N,a.onCanvasPointerOutObservable=new N,a.onBeginFrameObservable=new N,a.customAnimationFrameRequester=null,a.onEndFrameObservable=new N,a.onBeforeShaderCompilationObservable=new N,a.onAfterShaderCompilationObservable=new N,a._alphaMode=i.ALPHA_ADD,a._alphaEquation=i.ALPHA_DISABLE,a._deterministicLockstep=!1,a._lockstepMaxSteps=4,a._fps=60,a._deltaTime=0,a._drawCalls=new Fe,a.disablePerformanceMonitorInBackground=!1,a._performanceMonitor=new Oe,!r)return a;if(s=s||{},t.Instances.push(a),r.getContext){var u=r;if(a._onCanvasFocus=function(){a.onCanvasFocusObservable.notifyObservers(a)},a._onCanvasBlur=function(){a.onCanvasBlurObservable.notifyObservers(a)},u.addEventListener("focus",a._onCanvasFocus),u.addEventListener("blur",a._onCanvasBlur),a._onBlur=function(){a.disablePerformanceMonitorInBackground&&a._performanceMonitor.disable(),a._windowIsBackground=!0},a._onFocus=function(){a.disablePerformanceMonitorInBackground&&a._performanceMonitor.enable(),a._windowIsBackground=!1},a._onCanvasPointerOut=function(e){a.onCanvasPointerOutObservable.notifyObservers(e)},B.IsWindowObjectExist()){var h=a.getHostWindow();h.addEventListener("blur",a._onBlur),h.addEventListener("focus",a._onFocus)}u.addEventListener("pointerout",a._onCanvasPointerOut);var l=document;a._onFullscreenChange=function(){void 0!==l.fullscreen?a.isFullscreen=l.fullscreen:void 0!==l.mozFullScreen?a.isFullscreen=l.mozFullScreen:void 0!==l.webkitIsFullScreen?a.isFullscreen=l.webkitIsFullScreen:void 0!==l.msIsFullScreen&&(a.isFullscreen=l.msIsFullScreen),a.isFullscreen&&a._pointerLockRequested&&u&&t._RequestPointerlock(u)},document.addEventListener("fullscreenchange",a._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",a._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",a._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",a._onFullscreenChange,!1),a._onPointerLockChange=function(){a.isPointerLock=l.mozPointerLockElement===u||l.webkitPointerLockElement===u||l.msPointerLockElement===u||l.pointerLockElement===u},document.addEventListener("pointerlockchange",a._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",a._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",a._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",a._onPointerLockChange,!1),a._connectVREvents(),!t.audioEngine&&s.audioEngine&&t.AudioEngineFactory&&(t.audioEngine=t.AudioEngineFactory(a.getRenderingCanvas())),a.enableOfflineSupport=void 0!==t.OfflineProviderFactory,s.doNotHandleTouchAction||a._disableTouchAction(),a._deterministicLockstep=!!s.deterministicLockstep,a._lockstepMaxSteps=s.lockstepMaxSteps||0}return a._prepareVRComponent(),s.autoEnableWebVR&&a.initWebVR(),a}return s(t,e),Object.defineProperty(t,"NpmPackage",{get:function(){return fe.NpmPackage},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Version",{get:function(){return fe.Version},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Instances",{get:function(){return U.Instances},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LastCreatedEngine",{get:function(){return U.LastCreatedEngine},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LastCreatedScene",{get:function(){return U.LastCreatedScene},enumerable:!0,configurable:!0}),t.MarkAllMaterialsAsDirty=function(e,r){for(var i=0;i<t.Instances.length;i++)for(var n=t.Instances[i],s=0;s<n.scenes.length;s++)n.scenes[s].markAllMaterialsAsDirty(e,r)},t.DefaultLoadingScreenFactory=function(e){throw R.WarnImport("LoadingScreen")},Object.defineProperty(t.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!t._RescalePostProcessFactory},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),t.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var r=e.viewport;return this.getRenderWidth(t)*r.width/(this.getRenderHeight(t)*r.height)},t.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},t.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},t.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},t.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},t.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},t.prototype.generateMipMapsForCubemap=function(e){if(e.generateMipMaps){var t=this._gl;this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,e,!0),t.generateMipmap(t.TEXTURE_CUBE_MAP),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)}},t.prototype.setState=function(e,t,r,i){void 0===t&&(t=0),void 0===i&&(i=!1),(this._depthCullingState.cull!==e||r)&&(this._depthCullingState.cull=e);var n=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==n||r)&&(this._depthCullingState.cullFace=n),this.setZOffset(t);var s=i?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==s||r)&&(this._depthCullingState.frontFace=s)},t.prototype.setZOffset=function(e){this._depthCullingState.zOffset=e},t.prototype.getZOffset=function(){return this._depthCullingState.zOffset},t.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},t.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},t.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},t.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e),this._colorWrite=e},t.prototype.getColorWrite=function(){return this._colorWrite},t.prototype.setAlphaConstants=function(e,t,r,i){this._alphaState.setAlphaBlendConstants(e,t,r,i)},t.prototype.setAlphaMode=function(e,t){if(void 0===t&&(t=!1),this._alphaMode!==e){switch(e){case i.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case i.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case i.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case i.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case i.ALPHA_ONEONE_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_ALPHATOCOLOR:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case i.ALPHA_REVERSEONEMINUS:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case i.ALPHA_SRC_DSTONEMINUSSRCALPHA:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case i.ALPHA_ONEONE_ONEZERO:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0}t||this.setDepthWrite(e===i.ALPHA_DISABLE),this._alphaMode=e}},t.prototype.getAlphaMode=function(){return this._alphaMode},t.prototype.setAlphaEquation=function(e){if(this._alphaEquation!==e){switch(e){case i.ALPHA_EQUATION_ADD:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_ADD,this._gl.FUNC_ADD);break;case i.ALPHA_EQUATION_SUBSTRACT:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_SUBTRACT,this._gl.FUNC_SUBTRACT);break;case i.ALPHA_EQUATION_REVERSE_SUBTRACT:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_REVERSE_SUBTRACT,this._gl.FUNC_REVERSE_SUBTRACT);break;case i.ALPHA_EQUATION_MAX:this._alphaState.setAlphaEquationParameters(this._gl.MAX,this._gl.MAX);break;case i.ALPHA_EQUATION_MIN:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.MIN);break;case i.ALPHA_EQUATION_DARKEN:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.FUNC_ADD)}this._alphaEquation=e}},t.prototype.getAlphaEquation=function(){return this._alphaEquation},t.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},t.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},t.prototype.getStencilMask=function(){return this._stencilState.stencilMask},t.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},t.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},t.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},t.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},t.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},t.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},t.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},t.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},t.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},t.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},t.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},t.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},t.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},t.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},t.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},t.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},t.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},t.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},t.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},t.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},t.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},t.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},t.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},t.prototype.setDirectViewport=function(e,t,r,i){var n=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,r,i),n},t.prototype.scissorClear=function(e,t,r,i,n){this.enableScissor(e,t,r,i),this.clear(n,!0,!0,!0),this.disableScissor()},t.prototype.enableScissor=function(e,t,r,i){var n=this._gl;n.enable(n.SCISSOR_TEST),n.scissor(e,t,r,i)},t.prototype.disableScissor=function(){var e=this._gl;e.disable(e.SCISSOR_TEST)},t.prototype._reportDrawCall=function(){this._drawCalls.addCount(1,!1)},t.prototype.initWebVR=function(){throw R.WarnImport("WebVRCamera")},t.prototype._prepareVRComponent=function(){},t.prototype._connectVREvents=function(e,t){},t.prototype._submitVRFrame=function(){},t.prototype.disableVR=function(){},t.prototype.isVRPresenting=function(){return!1},t.prototype._requestVRFrame=function(){},t.prototype._loadFileAsync=function(e,t,r){var i=this;return new Promise(function(n,s){i._loadFile(e,function(e){n(e)},void 0,t,r,function(e,t){s(t)})})},t.prototype.getVertexShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null},t.prototype.getFragmentShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null},t.prototype.readPixels=function(e,t,r,i){var n=new Uint8Array(i*r*4);return this._gl.readPixels(e,t,r,i,this._gl.RGBA,this._gl.UNSIGNED_BYTE,n),n},t.prototype.setDepthStencilTexture=function(e,t,r){void 0!==e&&(t&&(this._boundUniforms[e]=t),r&&r.depthStencilTexture?this._setTexture(e,r,!1,!0):this._setTexture(e,null))},t.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t?t._textures.data[t._currentRenderTextureInd]:null)},t.prototype.setTextureFromPostProcessOutput=function(e,t){this._bindTexture(e,t?t._outputTexture:null)},t.prototype._convertRGBtoRGBATextureData=function(e,t,r,n){var s;s=n===i.TEXTURETYPE_FLOAT?new Float32Array(t*r*4):new Uint32Array(t*r*4);for(var o=0;o<t;o++)for(var a=0;a<r;a++){var u=3*(a*t+o),h=4*(a*t+o);s[h+0]=e[u+0],s[h+1]=e[u+1],s[h+2]=e[u+2],s[h+3]=1}return s},t.prototype._rebuildBuffers=function(){for(var t=0,r=this.scenes;t<r.length;t++){var i=r[t];i.resetCachedMaterial(),i._rebuildGeometries(),i._rebuildTextures()}e.prototype._rebuildBuffers.call(this)},t.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++){(0,this._activeRenderLoops[t])()}this.endFrame()}}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._bindedRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._bindedRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},t.prototype.switchFullscreen=function(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)},t.prototype.enterFullscreen=function(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&t._RequestFullscreen(this._renderingCanvas))},t.prototype.exitFullscreen=function(){this.isFullscreen&&t._ExitFullscreen()},t.prototype.enterPointerlock=function(){this._renderingCanvas&&t._RequestPointerlock(this._renderingCanvas)},t.prototype.exitPointerlock=function(){t._ExitPointerlock()},t.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),e.prototype.beginFrame.call(this)},t.prototype.endFrame=function(){e.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},t.prototype.resize=function(){this.isVRPresenting()||e.prototype.resize.call(this)},t.prototype.setTextureFormatToUse=function(e){for(var t=0,r=this.texturesSupported.length;t<r;t++)for(var i=0,n=e.length;i<n;i++)if(this._texturesSupported[t]===e[i].toLowerCase())return this._textureFormatInUse=this._texturesSupported[t];return this._textureFormatInUse=null,null},t.prototype.setSize=function(t,r){if(this._renderingCanvas&&(e.prototype.setSize.call(this,t,r),this.scenes)){for(var i=0;i<this.scenes.length;i++)for(var n=this.scenes[i],s=0;s<n.cameras.length;s++){n.cameras[s]._currentRenderId=0}this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},t.prototype._deletePipelineContext=function(t){var r=t;r&&r.program&&r.transformFeedback&&(this.deleteTransformFeedback(r.transformFeedback),r.transformFeedback=null),e.prototype._deletePipelineContext.call(this,t)},t.prototype.createShaderProgram=function(t,r,i,n,s,o){void 0===o&&(o=null),s=s||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var a=e.prototype.createShaderProgram.call(this,t,r,i,n,s,o);return this.onAfterShaderCompilationObservable.notifyObservers(this),a},t.prototype._createShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null);var s=i.createProgram();if(e.program=s,!s)throw new Error("Unable to create program");if(i.attachShader(s,t),i.attachShader(s,r),this.webGLVersion>1&&n){var o=this.createTransformFeedback();this.bindTransformFeedback(o),this.setTranformFeedbackVaryings(s,n),e.transformFeedback=o}return i.linkProgram(s),this.webGLVersion>1&&n&&this.bindTransformFeedback(null),e.context=i,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),s},t.prototype._releaseTexture=function(t){e.prototype._releaseTexture.call(this,t),this.scenes.forEach(function(e){e.postProcesses.forEach(function(e){e._outputTexture==t&&(e._outputTexture=null)}),e.cameras.forEach(function(e){e._postProcesses.forEach(function(e){e&&e._outputTexture==t&&(e._outputTexture=null)})})})},t.prototype._rescaleTexture=function(e,r,n,s,o){var a=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var u=this.createRenderTargetTexture({width:r.width,height:r.height},{generateMipMaps:!1,type:i.TEXTURETYPE_UNSIGNED_INT,samplingMode:i.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&t._RescalePostProcessFactory&&(this._rescalePostProcess=t._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){a._rescalePostProcess.onApply=function(t){t._bindTexture("textureSampler",e)};var t=n;t||(t=a.scenes[a.scenes.length-1]),t.postProcessManager.directRender([a._rescalePostProcess],u,!0),a._bindTextureDirectly(a._gl.TEXTURE_2D,r,!0),a._gl.copyTexImage2D(a._gl.TEXTURE_2D,0,s,0,0,r.width,r.height,0),a.unBindFramebuffer(u),a._releaseTexture(u),o&&o()})},t.prototype.getFps=function(){return this._fps},t.prototype.getDeltaTime=function(){return this._deltaTime},t.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},t.prototype.setFrameBufferDepthStencilTexture=function(e){var t=e.getInternalTexture();if(t&&t._framebuffer&&e.depthStencilTexture){var r=this._gl,i=e.depthStencilTexture;this._bindUnboundFramebuffer(t._framebuffer),i.isCube?i._generateStencilBuffer?r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_CUBE_MAP_POSITIVE_X,i._webGLTexture,0):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_CUBE_MAP_POSITIVE_X,i._webGLTexture,0):i._generateStencilBuffer?r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,i._webGLTexture,0):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,i._webGLTexture,0),this._bindUnboundFramebuffer(null)}},t.prototype.updateDynamicIndexBuffer=function(e,t,r){var i;void 0===r&&(r=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),i=t instanceof Uint16Array||t instanceof Uint32Array?t:e.is32Bits?new Uint32Array(t):new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},t.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;var r=this._gl;if(t=Math.min(t,this.getCaps().maxMSAASamples),e._depthStencilBuffer&&(r.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(r.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(r.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null),t>1){var i=r.createFramebuffer();if(!i)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=i,this._bindUnboundFramebuffer(e._MSAAFramebuffer);var n=r.createRenderbuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorageMultisample(r.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(e.type),e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n),e._MSAARenderBuffer=n}else this._bindUnboundFramebuffer(e._framebuffer);return e.samples=t,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t),r.bindRenderbuffer(r.RENDERBUFFER,null),this._bindUnboundFramebuffer(null),t},t.prototype._readTexturePixels=function(e,t,r,i,n,s){void 0===i&&(i=-1),void 0===n&&(n=0),void 0===s&&(s=null);var o=this._gl;if(!this._dummyFramebuffer){var a=o.createFramebuffer();if(!a)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=a}o.bindFramebuffer(o.FRAMEBUFFER,this._dummyFramebuffer),i>-1?o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+i,e._webGLTexture,n):o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e._webGLTexture,n);var u=void 0!==e.type?this._getWebGLTextureType(e.type):o.UNSIGNED_BYTE;switch(u){case o.UNSIGNED_BYTE:s||(s=new Uint8Array(4*t*r)),u=o.UNSIGNED_BYTE;break;default:s||(s=new Float32Array(4*t*r)),u=o.FLOAT}return o.readPixels(0,0,t,r,o.RGBA,u,s),o.bindFramebuffer(o.FRAMEBUFFER,this._currentFramebuffer),s},t.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();1===t.Instances.length&&t.audioEngine&&t.audioEngine.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),B.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut)),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)),e.prototype.dispose.call(this);var r=t.Instances.indexOf(this);r>=0&&t.Instances.splice(r,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},t.prototype._disableTouchAction=function(){this._renderingCanvas&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},t.prototype.displayLoadingUI=function(){if(B.IsWindowObjectExist()){var e=this.loadingScreen;e&&e.displayLoadingUI()}},t.prototype.hideLoadingUI=function(){if(B.IsWindowObjectExist()){var e=this._loadingScreen;e&&e.hideLoadingUI()}},Object.defineProperty(t.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=t.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),t._RequestPointerlock=function(e){e.requestPointerLock=e.requestPointerLock||e.msRequestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock&&e.requestPointerLock()},t._ExitPointerlock=function(){var e=document;document.exitPointerLock=document.exitPointerLock||e.msExitPointerLock||e.mozExitPointerLock||e.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},t._RequestFullscreen=function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)},t._ExitFullscreen=function(){var e=document;document.exitFullscreen?document.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msCancelFullScreen&&e.msCancelFullScreen()},t.ALPHA_DISABLE=i.ALPHA_DISABLE,t.ALPHA_ADD=i.ALPHA_ADD,t.ALPHA_COMBINE=i.ALPHA_COMBINE,t.ALPHA_SUBTRACT=i.ALPHA_SUBTRACT,t.ALPHA_MULTIPLY=i.ALPHA_MULTIPLY,t.ALPHA_MAXIMIZED=i.ALPHA_MAXIMIZED,t.ALPHA_ONEONE=i.ALPHA_ONEONE,t.ALPHA_PREMULTIPLIED=i.ALPHA_PREMULTIPLIED,t.ALPHA_PREMULTIPLIED_PORTERDUFF=i.ALPHA_PREMULTIPLIED_PORTERDUFF,t.ALPHA_INTERPOLATE=i.ALPHA_INTERPOLATE,t.ALPHA_SCREENMODE=i.ALPHA_SCREENMODE,t.DELAYLOADSTATE_NONE=i.DELAYLOADSTATE_NONE,t.DELAYLOADSTATE_LOADED=i.DELAYLOADSTATE_LOADED,t.DELAYLOADSTATE_LOADING=i.DELAYLOADSTATE_LOADING,t.DELAYLOADSTATE_NOTLOADED=i.DELAYLOADSTATE_NOTLOADED,t.NEVER=i.NEVER,t.ALWAYS=i.ALWAYS,t.LESS=i.LESS,t.EQUAL=i.EQUAL,t.LEQUAL=i.LEQUAL,t.GREATER=i.GREATER,t.GEQUAL=i.GEQUAL,t.NOTEQUAL=i.NOTEQUAL,t.KEEP=i.KEEP,t.REPLACE=i.REPLACE,t.INCR=i.INCR,t.DECR=i.DECR,t.INVERT=i.INVERT,t.INCR_WRAP=i.INCR_WRAP,t.DECR_WRAP=i.DECR_WRAP,t.TEXTURE_CLAMP_ADDRESSMODE=i.TEXTURE_CLAMP_ADDRESSMODE,t.TEXTURE_WRAP_ADDRESSMODE=i.TEXTURE_WRAP_ADDRESSMODE,t.TEXTURE_MIRROR_ADDRESSMODE=i.TEXTURE_MIRROR_ADDRESSMODE,t.TEXTUREFORMAT_ALPHA=i.TEXTUREFORMAT_ALPHA,t.TEXTUREFORMAT_LUMINANCE=i.TEXTUREFORMAT_LUMINANCE,t.TEXTUREFORMAT_LUMINANCE_ALPHA=i.TEXTUREFORMAT_LUMINANCE_ALPHA,t.TEXTUREFORMAT_RGB=i.TEXTUREFORMAT_RGB,t.TEXTUREFORMAT_RGBA=i.TEXTUREFORMAT_RGBA,t.TEXTUREFORMAT_RED=i.TEXTUREFORMAT_RED,t.TEXTUREFORMAT_R=i.TEXTUREFORMAT_R,t.TEXTUREFORMAT_RG=i.TEXTUREFORMAT_RG,t.TEXTUREFORMAT_RED_INTEGER=i.TEXTUREFORMAT_RED_INTEGER,t.TEXTUREFORMAT_R_INTEGER=i.TEXTUREFORMAT_R_INTEGER,t.TEXTUREFORMAT_RG_INTEGER=i.TEXTUREFORMAT_RG_INTEGER,t.TEXTUREFORMAT_RGB_INTEGER=i.TEXTUREFORMAT_RGB_INTEGER,t.TEXTUREFORMAT_RGBA_INTEGER=i.TEXTUREFORMAT_RGBA_INTEGER,t.TEXTURETYPE_UNSIGNED_BYTE=i.TEXTURETYPE_UNSIGNED_BYTE,t.TEXTURETYPE_UNSIGNED_INT=i.TEXTURETYPE_UNSIGNED_INT,t.TEXTURETYPE_FLOAT=i.TEXTURETYPE_FLOAT,t.TEXTURETYPE_HALF_FLOAT=i.TEXTURETYPE_HALF_FLOAT,t.TEXTURETYPE_BYTE=i.TEXTURETYPE_BYTE,t.TEXTURETYPE_SHORT=i.TEXTURETYPE_SHORT,t.TEXTURETYPE_UNSIGNED_SHORT=i.TEXTURETYPE_UNSIGNED_SHORT,t.TEXTURETYPE_INT=i.TEXTURETYPE_INT,t.TEXTURETYPE_UNSIGNED_INTEGER=i.TEXTURETYPE_UNSIGNED_INTEGER,t.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=i.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4,t.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=i.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1,t.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=i.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,t.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=i.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV,t.TEXTURETYPE_UNSIGNED_INT_24_8=i.TEXTURETYPE_UNSIGNED_INT_24_8,t.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=i.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV,t.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=i.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV,t.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=i.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV,t.TEXTURE_NEAREST_SAMPLINGMODE=i.TEXTURE_NEAREST_SAMPLINGMODE,t.TEXTURE_BILINEAR_SAMPLINGMODE=i.TEXTURE_BILINEAR_SAMPLINGMODE,t.TEXTURE_TRILINEAR_SAMPLINGMODE=i.TEXTURE_TRILINEAR_SAMPLINGMODE,t.TEXTURE_NEAREST_NEAREST_MIPLINEAR=i.TEXTURE_NEAREST_NEAREST_MIPLINEAR,t.TEXTURE_LINEAR_LINEAR_MIPNEAREST=i.TEXTURE_LINEAR_LINEAR_MIPNEAREST,t.TEXTURE_LINEAR_LINEAR_MIPLINEAR=i.TEXTURE_LINEAR_LINEAR_MIPLINEAR,t.TEXTURE_NEAREST_NEAREST_MIPNEAREST=i.TEXTURE_NEAREST_NEAREST_MIPNEAREST,t.TEXTURE_NEAREST_LINEAR_MIPNEAREST=i.TEXTURE_NEAREST_LINEAR_MIPNEAREST,t.TEXTURE_NEAREST_LINEAR_MIPLINEAR=i.TEXTURE_NEAREST_LINEAR_MIPLINEAR,t.TEXTURE_NEAREST_LINEAR=i.TEXTURE_NEAREST_LINEAR,t.TEXTURE_NEAREST_NEAREST=i.TEXTURE_NEAREST_NEAREST,t.TEXTURE_LINEAR_NEAREST_MIPNEAREST=i.TEXTURE_LINEAR_NEAREST_MIPNEAREST,t.TEXTURE_LINEAR_NEAREST_MIPLINEAR=i.TEXTURE_LINEAR_NEAREST_MIPLINEAR,t.TEXTURE_LINEAR_LINEAR=i.TEXTURE_LINEAR_LINEAR,t.TEXTURE_LINEAR_NEAREST=i.TEXTURE_LINEAR_NEAREST,t.TEXTURE_EXPLICIT_MODE=i.TEXTURE_EXPLICIT_MODE,t.TEXTURE_SPHERICAL_MODE=i.TEXTURE_SPHERICAL_MODE,t.TEXTURE_PLANAR_MODE=i.TEXTURE_PLANAR_MODE,t.TEXTURE_CUBIC_MODE=i.TEXTURE_CUBIC_MODE,t.TEXTURE_PROJECTION_MODE=i.TEXTURE_PROJECTION_MODE,t.TEXTURE_SKYBOX_MODE=i.TEXTURE_SKYBOX_MODE,t.TEXTURE_INVCUBIC_MODE=i.TEXTURE_INVCUBIC_MODE,t.TEXTURE_EQUIRECTANGULAR_MODE=i.TEXTURE_EQUIRECTANGULAR_MODE,t.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=i.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,t.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=i.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,t.SCALEMODE_FLOOR=i.SCALEMODE_FLOOR,t.SCALEMODE_NEAREST=i.SCALEMODE_NEAREST,t.SCALEMODE_CEILING=i.SCALEMODE_CEILING,t._RescalePostProcessFactory=null,t}(fe),Pe=function(){function e(e,t,r,n,s,o,a,u,h,l,_,c,p,d){void 0===a&&(a=i.TEXTURE_NEAREST_SAMPLINGMODE),void 0===l&&(l=null),void 0===_&&(_=i.TEXTURETYPE_UNSIGNED_INT),void 0===c&&(c="postprocess"),void 0===d&&(d=!1),this.name=e,this.width=-1,this.height=-1,this._outputTexture=null,this.autoClear=!0,this.alphaMode=i.ALPHA_DISABLE,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=i.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new ve(2),this._currentRenderTextureInd=0,this._scaleRatio=new f(1,1),this._texelSize=f.Zero(),this.onActivateObservable=new N,this.onSizeChangedObservable=new N,this.onApplyObservable=new N,this.onBeforeRenderObservable=new N,this.onAfterRenderObservable=new N,null!=o?(this._camera=o,this._scene=o.getScene(),o.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):u&&(this._engine=u,this._engine.postProcesses.push(this)),this._options=s,this.renderTargetSamplingMode=a||i.TEXTURE_NEAREST_SAMPLINGMODE,this._reusable=h||!1,this._textureType=_,this._samplers=n||[],this._samplers.push("textureSampler"),this._fragmentUrl=t,this._vertexUrl=c,this._parameters=r||[],this._parameters.push("scale"),this._indexParameters=p,d||this.updateEffect(l)}return Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(e){var t=this;this._samples=Math.min(e,this._engine.getCaps().maxMSAASamples),this._textures.forEach(function(e){e.samples!==t._samples&&t._engine.updateRenderTargetTextureSampleCount(e,t._samples)})},enumerable:!0,configurable:!0}),e.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(e.prototype,"onActivate",{set:function(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSizeChanged",{set:function(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onApply",{set:function(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(e){this._forcedOutputTexture=e},enumerable:!0,configurable:!0}),e.prototype.getCamera=function(){return this._camera},Object.defineProperty(e.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"PostProcess"},e.prototype.getEngine=function(){return this._engine},e.prototype.getEffect=function(){return this._effect},e.prototype.shareOutputWith=function(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this},e.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new ve(2)),this._shareOutputWithPostProcess=null},e.prototype.updateEffect=function(e,t,r,i,n,s){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null),this._effect=this._engine.createEffect({vertex:this._vertexUrl,fragment:this._fragmentUrl},["position"],t||this._parameters,r||this._samplers,null!==e?e:"",void 0,n,s,i||this._indexParameters)},e.prototype.isReusable=function(){return this._reusable},e.prototype.markTextureDirty=function(){this.width=-1},e.prototype.activate=function(e,t,r){var n=this;void 0===t&&(t=null);var s=(e=e||this._camera).getScene(),o=s.getEngine(),a=o.getCaps().maxTextureSize,u=(t?t.width:this._engine.getRenderWidth(!0))*this._options|0,h=(t?t.height:this._engine.getRenderHeight(!0))*this._options|0,l=e.parent;!l||l.leftCamera!=e&&l.rightCamera!=e||(u/=2);var _,c=this._options.width||u,f=this._options.height||h;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var p=o.currentViewport;p&&(c*=p.width,f*=p.height)}if((this.renderTargetSamplingMode===i.TEXTURE_TRILINEAR_SAMPLINGMODE||this.alwaysForcePOT)&&(this._options.width||(c=o.needPOTTextures?Me.GetExponentOfTwo(c,a,this.scaleMode):c),this._options.height||(f=o.needPOTTextures?Me.GetExponentOfTwo(f,a,this.scaleMode):f)),this.width!==c||this.height!==f){if(this._textures.length>0){for(var d=0;d<this._textures.length;d++)this._engine._releaseTexture(this._textures.data[d]);this._textures.reset()}this.width=c,this.height=f;var E={width:this.width,height:this.height},T={generateMipMaps:!1,generateDepthBuffer:r||0===e._postProcesses.indexOf(this),generateStencilBuffer:(r||0===e._postProcesses.indexOf(this))&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType};this._textures.push(this._engine.createRenderTargetTexture(E,T)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(E,T)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach(function(e){e.samples!==n.samples&&n._engine.updateRenderTargetTextureSampleCount(e,n.samples)})}return this._shareOutputWithPostProcess?_=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?(_=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):_=this.inputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(u/c,h/f),this._engine.bindFramebuffer(_,0,u,h,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(_,0,void 0,void 0,this.forceFullscreenViewport)),this.onActivateObservable.notifyObservers(e),this.autoClear&&this.alphaMode===i.ALPHA_DISABLE&&this._engine.clear(this.clearColor?this.clearColor:s.clearColor,s._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),_},Object.defineProperty(e.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!0,configurable:!0}),e.prototype.isReady=function(){return this._effect&&this._effect.isReady()},e.prototype.apply=function(){return this._effect&&this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),e=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this._effect._bindTexture("textureSampler",e),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null;var e},e.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this._textures.length>0)for(var e=0;e<this._textures.length;e++)this._engine._releaseTexture(this._textures.data[e]);this._textures.dispose()}},e.prototype.dispose=function(e){if(e=e||this._camera,this._disposeTextures(),this._scene){var t=this._scene.postProcesses.indexOf(this);-1!==t&&this._scene.postProcesses.splice(t,1)}else{var r=this._engine.postProcesses.indexOf(this);-1!==r&&this._engine.postProcesses.splice(r,1)}if(e){if(e.detachPostProcess(this),0===e._postProcesses.indexOf(this)&&e._postProcesses.length>0){var i=this._camera._getFirstPostProcess();i&&i.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},e}();class Le{constructor(e){e instanceof HTMLCanvasElement?(this._canvas=e,this._engine=new fe(this._canvas,!1)):e instanceof fe?(this._canvas=e.getRenderingCanvas(),this._engine=e):(this._canvas=e.canvas,this._engine=e.engine),this._engine.getCaps().parallelShaderCompile=null}get engine(){return this._engine}get canvas(){return this._canvas}dispose(){this.engine.dispose()}}function Ne(e,t,r,n=!1,s=i.TEXTURE_BILINEAR_SAMPLINGMODE,o=!0){let a;if(t instanceof w)a=t;else if("string"==typeof t)a=new ge(t,e,!n,o,s);else{const i=new pe(r,t,{engine:e,generateMipMaps:n,samplingMode:s,scene:null});a=i;const u=()=>{setTimeout(()=>{i.element=null},500)};if(t instanceof HTMLVideoElement&&t.readyState<t.HAVE_ENOUGH_DATA){const r=(()=>{t.readyState<t.HAVE_ENOUGH_DATA||(e.stopRenderLoop(r),i.update(!o),u())}).bind(this);e.runRenderLoop(r)}else t instanceof HTMLVideoElement?(i.update(!o),u()):(i.update(o),u())}return a.wrapU=i.TEXTURE_CLAMP_ADDRESSMODE,a.wrapV=i.TEXTURE_CLAMP_ADDRESSMODE,a.name=r,a}class Ue extends Le{constructor(e,t){super(e),this._options=t||{},void 0===this._options.generateMipMaps&&(this._options.generateMipMaps=!0),void 0===this._options.linearFiltering&&(this._options.linearFiltering=!0),this._generateMipMaps=this._options.generateMipMaps&&this.engine.webGLVersion>1,this._options.linearFiltering?this._textureFiltering=this._generateMipMaps?i.TEXTURE_TRILINEAR_SAMPLINGMODE:i.TEXTURE_BILINEAR_SAMPLINGMODE:this._textureFiltering=this._generateMipMaps?i.TEXTURE_NEAREST_NEAREST_MIPLINEAR:i.TEXTURE_NEAREST_NEAREST,this._initializeRenderer()}filter(e,t){const r=Ne(this.engine,e,"input",this._generateMipMaps,this._textureFiltering);return new Promise((e,i)=>{const n=(()=>{r.isReady()&&(this.engine.stopRenderLoop(n),this.render(r,t),r.dispose(),e())}).bind(this);this.engine.runRenderLoop(n)})}getFilteredTexture(e,t,r){const n=Ne(this.engine,e,"input",this._generateMipMaps,this._textureFiltering),s=this.engine.createRenderTargetTexture(t,{format:i.TEXTUREFORMAT_RGBA,generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:i.TEXTURE_BILINEAR_SAMPLINGMODE,type:i.TEXTURETYPE_UNSIGNED_BYTE});s.isReady=!1;const o=()=>{this.engine.bindFramebuffer(s),this._effectRenderer.setViewport(),this.render(n,r),this.engine.unBindFramebuffer(s),this._effectRenderer.setViewport(),s.isReady=!0,this.engine._releaseFramebufferObjects(s),n.dispose()},a=(()=>{n.isReady()&&(this.engine.stopRenderLoop(a),o())}).bind(this);this.engine.runRenderLoop(a);const u=new w(null);return u._texture=s,u}render(e,t){if(!t)return void G.Error("Please, specify at least a post process or an effectWrapper in the options.");if(!e.isReady())return;let r;t instanceof Pe?(r=t.getEffect(),this._effectRenderer.bindBuffers(r),t.apply()):t instanceof xe&&(r=t.effect,this._effectRenderer.applyEffectWrapper(t)),r.setTexture("textureSampler",e),this._effectRenderer.draw()}resize(){this.engine.resize(),this._effectRenderer.setViewport()}dispose(){this._effectRenderer.dispose(),super.dispose()}_initializeRenderer(){this._effectRenderer=new be(this.engine),this._effectRenderer.setViewport()}}const Ce={name:"resizer",vertexShader:"\n    attribute vec2 position;\n\n    varying vec2 uv;\n\n    const vec2 scale = vec2(0.5, -0.5);\n\n    void main(void) {\n        uv = position * scale + 0.5;\n\n        gl_Position = vec4(position, 0.0, 1.0);\n    }\n",fragmentShader:"\n    varying vec2 uv;\n\n    uniform sampler2D toResize;\n\n    void main(void) {\n        gl_FragColor = texture2D(toResize, uv);\n    }\n",attributeNames:["position"],samplerNames:["toResize"]};class De extends Le{constructor(e){super(e),this._generateMipMaps=this.engine.webGLVersion>1,this._textureFiltering=this._generateMipMaps?i.TEXTURE_TRILINEAR_SAMPLINGMODE:i.TEXTURE_BILINEAR_SAMPLINGMODE,this._initializeRenderer()}dispose(){this._effectWrapper.dispose(),this._effectRenderer.dispose(),super.dispose()}resize(e){const t=Ne(this.engine,e,"input",this._generateMipMaps,this._textureFiltering,!1);return new Promise((e,r)=>{const i=(()=>{t.isReady()&&(this.engine.stopRenderLoop(i),this._render(t),t.dispose(),e())}).bind(this);this.engine.runRenderLoop(i)})}createOffscreenTexture(e,t=i.TEXTURE_BILINEAR_SAMPLINGMODE){const r=this.engine.createRenderTargetTexture(e,{format:i.TEXTUREFORMAT_RGBA,generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:t,type:i.TEXTURETYPE_UNSIGNED_BYTE});r.isReady=!1;const n=new w(null);return n.wrapU=i.TEXTURE_CLAMP_ADDRESSMODE,n.wrapV=i.TEXTURE_CLAMP_ADDRESSMODE,n._texture=r,n}resizeToTexture(e,t){this.engine.bindFramebuffer(t.getInternalTexture()),this._effectRenderer.setViewport(),this._render(e),this.engine.unBindFramebuffer(t.getInternalTexture()),this._effectRenderer.setViewport(),t.getInternalTexture().isReady=!0}getResizedTexture(e,t){const r=Ne(this.engine,e,"input",this._generateMipMaps,this._textureFiltering,!1),i=this.createOffscreenTexture(t),n=()=>{this.resizeToTexture(r,i),this.engine._releaseFramebufferObjects(i.getInternalTexture()),r.dispose()},s=(()=>{r.isReady()&&(this.engine.stopRenderLoop(s),n())}).bind(this);return this.engine.runRenderLoop(s),i}_render(e){this._effectRenderer.applyEffectWrapper(this._effectWrapper),this._effectWrapper.effect.setTexture("toResize",e),this._effectRenderer.draw()}_initializeRenderer(){this._effectRenderer=new be(this.engine),this._effectWrapper=new xe({engine:this.engine,...Ce}),this._effectRenderer.setViewport()}}var we={name:"GameBoy",fragmentShader:"\nvarying vec2 vUV;\n\n// Default Sampler\nuniform sampler2D textureSampler;\n\n// Transform color to luminance.\nfloat getLuminance(vec3 color)\n{\n    return clamp(dot(color, vec3(0.2126, 0.7152, 0.0722)), 0., 1.);\n}\n\n// Returns whether the given fragment position lies on a grid line.\nbool onGridline(float distFrom, float spacing)\n{\n    return mod(floor(distFrom), spacing) == 0.0;\n}\n\nvoid main(void) \n{\n    // Color Palette\n    vec4 palette[4];\n    palette[0] = vec4( 22, 30, 87, 255.)  / 255.;\n    palette[1] = vec4( 78, 109, 90, 255.) / 255.;\n    palette[2] = vec4(106, 149, 50, 255.) / 255.;\n    palette[3] = vec4(115, 161, 43, 255.) / 255.;\n\n    // Luminance adaptation\n    const float lumaOffset = 0.2;\n\n    // Grid lines\n    const vec4 gridLineColor = vec4(vec3(120, 168, 51) / 255. , 1.0);\n    const float gridSize = 8.;\n\n    // Screen Definition\n    const float screenSize = 512.;\n    vec2 tileUV = floor(gl_FragCoord.xy / gridSize) * gridSize / screenSize;\n\n    // Mirror for selfie;\n    tileUV.x = 1. - tileUV.x;\n\n    // Square fetch of luminance\n    vec4 tileColor = texture2D(textureSampler, tileUV);\n    float tileLuminance = getLuminance(tileColor.rgb);\n\n    // Adapt luma to effect and pick from the palette\n    int colorChoice = int(tileLuminance * 3. + lumaOffset);\n    #ifdef WEBGL2\n        vec4 finalColor = palette[colorChoice];\n    #else\n        vec4 finalColor = vec4(0.);\n        if (colorChoice == 0) {\n            finalColor = palette[0];\n        } else if (colorChoice == 1) {\n            finalColor = palette[1];\n        } else if (colorChoice == 2) {\n            finalColor = palette[2];\n        } else {\n            finalColor = palette[3];\n        }\n    #endif\n\n    // Are we on a line.\n    if (onGridline(gl_FragCoord.x, gridSize) || onGridline(gl_FragCoord.y, gridSize))\n    {\n        gl_FragColor = gridLineColor;\n        return;\n    }\n\n    gl_FragColor = finalColor;\n}",samplerNames:["textureSampler"]},Be=function(){return(Be=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Ge=function(e,t,r,i){return new(r||(r=Promise))(function(n,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}u((i=i.apply(e,t||[])).next())})},Xe=function(e,t){var r,i,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},ze=document.getElementById("renderCanvas");function ke(e){return navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!1}).then(function(t){return function(e,t){var r=document.createElement("video");return r.setAttribute("autoplay",""),r.setAttribute("muted","true"),r.setAttribute("playsinline",""),r.muted=!0,void 0!==r.mozSrcObject?r.mozSrcObject=t:"object"==typeof r.srcObject?r.srcObject=t:(window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,r.src=window.URL&&window.URL.createObjectURL(t)),new Promise(function(t){var n=function(){var s=new pe("video",r,{engine:e,scene:null});s.wrapU=i.TEXTURE_CLAMP_ADDRESSMODE,s.wrapV=i.TEXTURE_CLAMP_ADDRESSMODE,r.removeEventListener("playing",n),t(s)};r.addEventListener("playing",n),r.play()})}(e,t)}):Promise.reject("navigator.mediaDevices.getUserMedia is not supported by your browser.")}!function(){Ge(this,void 0,void 0,function(){var e,t,r,n,s,o;return Xe(this,function(a){switch(a.label){case 0:return e=new Ue(ze),t=new De(e),r=e.engine,n=new xe(Be(Be({},we),{engine:r})),[4,ke(r).catch(function(){alert("Please ensure you are running on a Chromium based browser and that your Webcam is plugged in.")})];case 1:return(s=a.sent())?(o=t.createOffscreenTexture({width:Math.floor(s.element.videoWidth/8),height:Math.floor(s.element.videoHeight/8)},i.TEXTURE_NEAREST_NEAREST),r.runRenderLoop(function(){s.update(),t.resizeToTexture(s,o),e.render(o,n)}),[2]):[2]}})})}()}]);